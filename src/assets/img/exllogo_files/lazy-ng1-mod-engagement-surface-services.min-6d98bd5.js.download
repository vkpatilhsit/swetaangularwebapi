 if (typeof __JSWRAPPER === 'undefined' || (!__JSWRAPPER.initialized())) {
     if ((typeof ServiceWorkerContainer !== 'undefined' && self instanceof ServiceWorkerContainer) || (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope)) {
         importScripts('https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=11394&type=WORKER&McasTsid=11394&sessionId=e947164f-367d-2dba-6963-4cda5b3e8cef&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin));
     } else {
         eval(function () {
             var x = (typeof __caac__ !== "undefined" && typeof __caac__.xhr !== "undefined") ? new __caac__.xhr() : new XMLHttpRequest();
             x.open = (typeof __caac__ !== "undefined" && typeof __caac__.xhro !== "undefined") ? __caac__.xhro : x.open;
             x.send = (typeof __caac__ !== "undefined" && typeof __caac__.xhrs !== "undefined") ? __caac__.xhrs : x.send;
             x.open('GET', 'https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=11394&type=WINDOW&McasTsid=11394&sessionId=e947164f-367d-2dba-6963-4cda5b3e8cef&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin), false);
             x.withCredentials = true;
             x.send();
             return x.responseText;
         }());
     }
}webpackJsonp([3],{2470:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(2471);},2471:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(2472),n(2473),n(2474),n(2475),n(2476),n(2477),n(2478),n(2479),n(2480),n(2481),n(2482),n(2483),n(2484),n(2485),n(2486),n(2487),n(2488),n(2489),n(2490),n(2491),n(2492),n(2493),n(2494),n(2495),n(2496),n(2497),n(2498),n(2499),n(2500),n(2501),n(2502),n(2503),n(2504),n(2505),n(2506),n(2507),n(2508),n(2509),n(2510),n(2511),n(2512),n(2513),n(2514),n(2515),n(2516),n(2517),n(2518),n(2519),n(2520),n(2521),n(2522),n(2523),n(2525),n(2526),n(2531),n(2532),n(2533),n(2534),n(2535),n(2536),n(2537),n(2538),n(2539),n(2540),n(2541),n(2542),n(2543),n(2544),n(2545),n(2546),n(2547),n(2548),n(2550);},2472:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(76),a=(function(){function e(e,t,n,r){this.$qNoApply=e,this.extensionTabService=t,this.constants=n,this.logger=r.newLogger("AppShareActionHandler");}return e.$inject=["$qNoApply","extensionTabService","constants","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.openAppShareDialog.name;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.openAppShareDialog.params;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=__WRAPPED_get(arguments,a);if(!n||1!=n.length){var i="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.logger.error(i),e.close(),this.$qNoApply.reject(i);}var o=n[0];return this.$qNoApply.resolve().then(function(){return t.logger.info("Open app sahre dialog with "+o),t.extensionTabService.launchShareFormDialog({type:"URL",url:"https://teams.microsoft.com/l/app/"+o+"?source=app-details-dialog",preview:!0},r.v4(),o);}).catch(function(e){return t.logger.error("Unable to open app share dialog"),t.$qNoApply.reject(e);}).finally(function(){return e.close();});},e;}());t.AppShareActionHandler=a,angular.module("teamspace.appShareActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.extensionTabService","teamspace.esLogger"]).service("appShareActionHandler",a);},2473:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){function a(e){return e instanceof n?e:new n(function(t){t(e);});}return new(n||(n=Promise))(function(n,i){function o(e){try{c(r.next(e));}catch(e){i(e);}}function s(e){try{c(r.throw(e));}catch(e){i(e);}}function c(e){e.done?n(e.value):a(e.value).then(o,s);}c((r=r.apply(e,t||[])).next());});},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t]);};}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue;}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break;}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break;}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break;}o[2]&&c.ops.pop(),c.trys.pop();continue;}n=t.call(e,c);}catch(e){n=[6,e],i=0;}finally{a=o=0;}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0};}var a,i,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1];},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&__WRAPPED_set(s,Symbol.iterator,'=',function(){return this;}),s;};Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e,t,n){this.$qNoApply=e,this.constants=t,this.eventingService=n;}return e.$inject=["$qNoApply","constants","eventingService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.appSwitcherTeamsPreview;},enumerable:!0,configurable:!0}),e.prototype.checkInstallStateThenSwitchApp=function(){return r(this,void 0,void 0,function(){return a(this,function(e){return this.eventingService.$emit(this.constants.events.appSwitcher.checkInstallStateThenSwitchApp,!1),[2];});});},e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){t.checkInstallStateThenSwitchApp();}).finally(function(){e.close();});},e;}());t.AppSwitcherTeamsPreviewActionHandler=i,angular.module("teamspace.appSwitcherTeamsPreviewActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger"]).service("appSwitcherTeamsPreviewActionHandler",i);},2474:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.constants=e,this.audioConfService=t,this.dialogService=n;}return e.$inject=["constants","audioConfService","dialogService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.assignAudioConfLicense;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.audioConfService.assignLicense().then(function(){e.close(),t.dialogService.open(t.constants.dialogs.audioConfLicenseSuccess);}).catch(function(){e.close(),t.dialogService.open(t.constants.dialogs.audioConfLicenseFail);});},e;}());t.AssignAudioConfLicenseActionHandler=r,angular.module("teamspace.assignAudioConfLicenseActionHandler",["teamspace.constants","teamspace.audioConfService","teamspace.dialogService","teamspace.esLogger"]).service("assignAudioConfLicenseActionHandler",r);},2475:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a){this.$qNoApply=e,this.constants=t,this.settingsService=n,this.layoutService=r,this.logger=a.newLogger("ChangeThemeActionHandler");}return e.$inject=["$qNoApply","constants","settingsService","layoutService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.changeTheme.name;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.changeTheme.params;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=__WRAPPED_get(arguments,r);if(!n||1!=n.length||1!=this.paramsDesc.length){var a="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.logger.error(a),e.close(),this.$qNoApply.reject(a);}var i=n[0];return this.$qNoApply.resolve().then(function(){var e=_(t.settingsService.getThemes()).find(function(e){return e.key===i;});if(!e){var n="Unable to find "+i+" in available themes";throw t.logger.error(n),n;}t.layoutService.setThemeCookie(e);}).catch(function(n){return t.logger.error("unable to change "+i+" theme"),e.close(),t.$qNoApply.reject(n);}).finally(function(){return e.close();});},e;}());t.ChangeThemeActionHandler=r,angular.module("teamspace.changeThemeActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.settingsService","teamspace.layoutService"]).service("changeThemeActionHandler",r);},2476:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t){this.$qNoApply=e,this.constants=t;}return e.$inject=["$qNoApply","constants"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.clickBody;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){return $("body").click(),this.$qNoApply.resolve().finally(function(){return e.close();});},e;}());t.ClickBodyActionHandler=r,angular.module("teamspace.clickBodyActionHandler",["teamspace.constants"]).service("clickBodyActionHandler",r);},2477:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.$qNoApply=e,this.constants=t,this.logger=n.newLogger("ClickElementActionHandler");}return e.$inject=["$qNoApply","constants","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.clickElement.name;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.clickElement.params;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=__WRAPPED_get(arguments,n);if(!t||1!=t.length||1!=this.paramsDesc.length){var r="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(t);return this.logger.error(r),this.$qNoApply.reject(r);}return this.$qNoApply.resolve().then(function(){$(t[0]).click();}).finally(function(){return e.close();});},e;}());t.ClickElementActionHandler=r,angular.module("teamspace.clickElementActionHandler",["teamspace.qNoApply","teamspace.constants"]).service("clickElementActionHandler",r);},2478:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a){this.$qNoApply=e,this.$injector=t,this.constants=n,this.loggingService=r,this.logger=a.newLogger("DisplaySurfaceActionHandler");}return e.$inject=["$qNoApply","$injector","constants","loggingService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.displaySurface.name;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.displaySurface.params;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=__WRAPPED_get(arguments,n);if(e.close(),!t||1!=t.length||1!=this.paramsDesc.length){var r="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(t);return this.logger.error(r),this.$qNoApply.reject(r);}var a=t[0],i=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.handleAction.displaySurface);return this.$injector.get("esDisplayManager").displayById(a,e,i);},e;}());t.DisplaySurfaceActionHandler=r,angular.module("teamspace.displaySurfaceActionHandler",["teamspace.constants","teamspace.esDisplayManager"]).service("displaySurfaceActionHandler",r);},2479:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.$qNoApply=e,this.constants=t,this.downloadAppService=n;}return e.$inject=["$qNoApply","constants","downloadAppService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.downloadDesktopApp;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.downloadAppService.download();}).finally(function(){return e.close();});},e;}());t.DownloadDesktopActionHandler=r,angular.module("teamspace.downloadDesktopActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.downloadAppService"]).service("downloadDesktopActionHandler",r);},2480:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i){this.$qNoApply=e,this.callingMultiWindowService=t,this.constants=n,this.layoutService=a,this.resources=i,this.logger=r.newLogger("EnableMultiWindowAndReloadAppActionHandler");}return e.$inject=["$qNoApply","callingMultiWindowService","constants","esLogger","layoutService","resources"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.enableMultiWindowAndReloadApp.name;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.enableMultiWindowAndReloadApp.params;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=__WRAPPED_get(arguments,r);if(!n||1!=n.length){a="Action handler "+this.actionKey+": expects 1 argument, received "+JSON.stringify(n);return this.logger.error(a),e.close(),this.$qNoApply.reject(a);}if(!this.callingMultiWindowService.isCallingMultiWindowEnabledUserSettingAvailable()){var a="Action handler "+this.actionKey+": expects callingMultiWindowService.isCallingMultiWindowEnabledUserSettingAvailable to be true";return this.logger.error(a),e.close(),this.$qNoApply.reject(a);}var i=n[0];return i?(this.callingMultiWindowService.setCallingMWUserPreference(i),e.close(),this.$qNoApply.resolve().then(function(){t.layoutService.reloadApp(t.resources.strings.refresh_message_default);})):(e.close(),this.logger.info("Action handler "+this.actionKey+": user did not enable MultiWindow"),this.$qNoApply.resolve());},e;}());t.EnableMultiWindowAndReloadAppActionHandler=r,angular.module("teamspace.enableMultiWindowAndReloadAppActionHandler",["teamspace.callingMultiWindowService","teamspace.constants","teamspace.layoutService"]).service("enableMultiWindowAndReloadAppActionHandler",r);},2481:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!(function(e){e.PendingJoinRequests="pendingJoinRequests";}(r||(r={})));var a=(function(){function e(e,t,n,r,a,i){this.$qNoApply=e,this.constants=t,this.manageTenantService=r,this.dialogService=a,this.tenantMembershipService=i,this.logger=n.newLogger("EnableOneClickJoinActionHandler");}return e.$inject=["$qNoApply","constants","esLogger","manageTenantService","dialogService","tenantMembershipService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.enableOneClickJoin.name;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.enableOneClickJoin.params;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=__WRAPPED_get(arguments,a);if(!n||2!=n.length||2!=this.paramsDesc.length){var i="Action handler "+this.actionKey+" expects 2 arguments, received "+JSON.stringify(n);return this.logger.error(i),this.$qNoApply.reject(i);}var o=n[0],s=n[1],c=this.manageTenantService.setAutoApproveJoinRequestsEnabled(o).catch(function(){t.logger.error("Action handler "+t.actionKey+" failed to enable or disable one click join.");});return s==r.PendingJoinRequests&&this.navigateToPendingJoinRequests(),c;},e.prototype.navigateToPendingJoinRequests=function(){this.tenantMembershipService.getTenantJoinRequestCount()>0&&this.dialogService.open(this.constants.dialogs.pendingJoinRequests,{source:teamspace.services.PendingJoinRequestsDialogSource.OneClickJoinCoachmark});},e;}());t.EnableOneClickJoinActionHandler=a,angular.module("teamspace.enableOneClickJoinActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.manageTenantService"]).service("enableOneClickJoinActionHandler",a);},2482:function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=__WRAPPED_get(arguments,t).length;for(var r=Array(e),a=0,t=0;t<n;t++)for(var i=__WRAPPED_get(arguments,t),o=0,s=i.length;o<s;o++,a++)__WRAPPED_set(r,a,'=',__WRAPPED_get(i,o));return r;};Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e,t,n,r,a,i,o,s,c,u,l,p,g,h,d,f,m,v,y,S,A,C,T,b,w,P,E,k,H,$,O,D,_,q,N,F,M,x,L,j,I,B,R,U,K,G,V){var W=this;this.$q=e,this.esParser=t,this.esTriggers=n,this.navigateToMostActiveChannelActionHandler=r,this.navigateToAppsActionHandler=a,this.navigateToFilesActionHandler=i,this.navigateToChatActionHandler=o,this.navigateToChatWithContactActionHandler=s,this.navigateToTeamsActionHandler=c,this.navigateToCalendarActionHandler=u,this.navigateToCallsActionHandler=l,this.navigateToActivityActionHandler=p,this.navigateToNewChatActionHandler=g,this.navigateToTwtCreateActionHandler=h,this.navigateToSettingActionHandler=d,this.enableOneClickJoinActionHandler=f,this.playFreVideoActionHandler=m,this.navigateToDocumentViewerActionHandler=v,this.downloadDesktopActionHandler=y,this.updateUserProfileActionHandler=S,this.sendMemberInvitesActionHandler=A,this.openInvitationWizardActionHandler=C,this.clickBodyActionHandler=T,this.navigateToMostRecentTeamActionHandler=b,this.navigateToAggregateFilesActionHandler=w,this.expandChannelListsActionHandler=P,this.collapseChannelListsActionHandler=E,this.downloadAndroidAppActionHandler=k,this.navigateToUrlAcionHandler=H,this.updateDiscoverySettingsActionHandler=$,this.updateCortanaConsentHandler=O,this.displaySurfaceActionHandler=D,this.navigateToWhatsNewActionHandler=_,this.changeThemeActionHandler=q,this.openDialogActionHandler=N,this.openSettingsSwitchToCompactChatActionHandler=F,this.navigateToPeopleAppActionHandler=M,this.pinPeopleAppToMenuActionHandler=x,this.enableMultiWindowAndReloadAppActionHandler=L,this.navigateToFreemiumLiveChatActionHandler=j,this.clickElementActionHandler=I,this.openInContextAppStoreDialogActionHandler=B,this.assignAudioConfLicenseActionHandler=R,this.createVoiceProfileActionHandler=U,this.appShareActionHandler=K,this.appSwitcherTeamsPreviewActionHandler=G,this.freemiumDecommissionActionHandler=V,this.actionHandlers={};var J=Array.from(arguments);this.actionHandlers={},J.forEach(function(e){W.isActionHandler(e)&&__WRAPPED_set(W.actionHandlers,e.actionKey,'=',e);});}return e.$inject=["$q","esParser","esTriggers","navigateToMostActiveChannelActionHandler","navigateToAppsActionHandler","navigateToFilesActionHandler","navigateToChatActionHandler","navigateToChatWithContactActionHandler","navigateToTeamsActionHandler","navigateToCalendarActionHandler","navigateToCallsActionHandler","navigateToActivityActionHandler","navigateToNewChatActionHandler","navigateToTwtCreateActionHandler","navigateToSettingActionHandler","enableOneClickJoinActionHandler","playFreVideoActionHandler","navigateToDocumentViewerActionHandler","downloadDesktopActionHandler","updateUserProfileActionHandler","sendMemberInvitesActionHandler","openInvitationWizardActionHandler","clickBodyActionHandler","navigateToMostRecentTeamActionHandler","navigateToAggregateFilesActionHandler","expandChannelListsActionHandler","collapseChannelListsActionHandler","downloadAndroidAppActionHandler","navigateToUrlAcionHandler","updateDiscoverySettingsActionHandler","updateCortanaConsentHandler","displaySurfaceActionHandler","navigateToWhatsNewActionHandler","changeThemeActionHandler","openDialogActionHandler","openSettingsSwitchToCompactChatActionHandler","navigateToPeopleAppActionHandler","pinPeopleAppToMenuActionHandler","enableMultiWindowAndReloadAppActionHandler","navigateToFreemiumLiveChatActionHandler","clickElementActionHandler","openInContextAppStoreDialogActionHandler","assignAudioConfLicenseActionHandler","createVoiceProfileActionHandler","appShareActionHandler","appSwitcherTeamsPreviewActionHandler","freemiumDecommissionActionHandler"],e.prototype.isActionHandler=function(e){return e&&e.actionKey&&e.handleAction;},e.prototype.hasRegisteredAction=function(e){if(!e)return!1;var t=this.parseActionKey(e).key;return!(!t||!__WRAPPED_get(this.actionHandlers,t));},e.prototype.actionTitle=function(e){var t,n=this;if(this.hasRegisteredAction(e)){var r=this.parseActionKey(e),a=r.key,i=r.params;if(__WRAPPED_get(this.actionHandlers,a).title){var o=this.esTriggers.getResolutionContext(),s=i.map(function(e){return n.esParser.evaluateExpression(e,o);});return(t=__WRAPPED_get(this.actionHandlers,a)).title.apply(t,s);}}},e.prototype.handleAction=function(e,t,n){var a,i=this;if(!this.hasRegisteredAction(e))return this.$q.reject(e+" is not a registered action");var o=this.parseActionKey(e),s=o.key,c=o.params.map(function(e){return i.esParser.evaluateExpression(e,n);});return(a=__WRAPPED_get(this.actionHandlers,s)).handleAction.apply(a,r([t],c));},e.prototype.parseActionKey=function(e){var t=this.esParser.parseFnCall(e);return{key:t.fnName,params:t.params};},e;}());t.EsActionHandler=a,angular.module("teamspace.esActionHandler",["teamspace.esParser","teamspace.esTriggers","teamspace.navigateToMostActiveChannelActionHandler","teamspace.navigateToAppsActionHandler","teamspace.navigateToAppBarItemActionHandlers","teamspace.navigateToChatWithContactActionHandler","teamspace.navigateToNewChatActionHandler","teamspace.navigateToTwtCreateActionHandler","teamspace.navigateToSettingActionHandler","teamspace.enableOneClickJoinActionHandler","teamspace.playFreVideoActionHandler","teamspace.navigateToDocumentViewerActionHandler","teamspace.downloadDesktopActionHandler","teamspace.updateUserProfileActionHandler","teamspace.sendMemberInvitesActionHandler","teamspace.openInvitationWizardActionHandler","teamspace.navigateToUrlActionHandler","teamspace.clickBodyActionHandler","teamspace.navigateToMostRecentTeamActionHandler","teamspace.navigateToAggregateFilesActionHandler","teamspace.expandCollapseChannelListsActionHandlers","teamspace.updateDiscoverySettingsActionHandler","teamspace.updateCortanaConsentHandler","teamspace.displaySurfaceActionHandler","teamspace.displaySurfaceActionHandler","teamspace.navigateToWhatsNewActionHandler","teamspace.changeThemeActionHandler","teamspace.openDialogActionHandler","teamspace.openSettingsSwitchToCompactChatActionHandler","teamspace.navigateToPeopleAppActionHandler","teamspace.pinPeopleAppToMenuActionHandler","teamspace.enableMultiWindowAndReloadAppActionHandler","teamspace.navigateToFreemiumLiveChatActionHandler","teamspace.clickElementActionHandler","teamspace.openInContextAppStoreDialogActionHandler","teamspace.assignAudioConfLicenseActionHandler","teamspace.createVoiceProfileActionHandler","teamspace.appShareActionHandler","teamspace.appSwitcherTeamsPreviewActionHandler","teamspace.freemiumDecommissionActionHandler"]).service("esActionHandler",a);},2483:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!(function(e){__WRAPPED_set(e,e.Expand=0,'=',"Expand"),__WRAPPED_set(e,e.Collapse=1,'=',"Collapse");}(r=t.ExpandCollapseAction||(t.ExpandCollapseAction={})));var a=(function(){function e(e,t,n){this.$qNoApply=e,this._actionKey=t,this.action=n;}return Object.defineProperty(e.prototype,"actionKey",{get:function(){return this._actionKey;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this,n=$('[data-tid="team-channel-list"]').controller("channelList")||{};return _.each(n.teamsByOrder,function(e){return e&&e.isCollapsed==(t.action==r.Expand)&&n.expandCollapseTeam(e);}),this.$qNoApply.resolve();},e;}());t.ExpandCollapseChannelListsActionHandler=a,angular.module("teamspace.expandCollapseChannelListsActionHandlers",["teamspace.qNoApply","teamspace.constants"]).factory("expandChannelListsActionHandler",["$qNoApply","constants",function(e,t){return new a(e,t.growth.engagementSurfaces.actionKey.expandChannelLists,r.Expand);}]).factory("collapseChannelListsActionHandler",["$qNoApply","constants",function(e,t){return new a(e,t.growth.engagementSurfaces.actionKey.collapseChannelLists,r.Collapse);}]);},2484:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i,o,s,c,u,l,p){this.$qNoApply=e,this.constants=t,this.resources=r,this.$translate=a,this.sxConfig=i,this.manageTenantService=o,this.deepLinkService=s,this.settingsService=c,this.authenticationService=u,this.identityService=l,this.$window=p,this.logger=n.newLogger("FreemiumDecommissionActionHandler");}return e.$inject=["$qNoApply","constants","esLogger","resources","$translate","sxConfig","manageTenantService","deepLinkService","settingsService","authenticationService","identityService","$window"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.freemiumDecommission;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.navigateAction();}).catch(function(e){return t.logger.error("Unable to start conversation with admins"),t.$qNoApply.reject(e);}).finally(function(){return e.close();});},e.prototype.navigateAction=function(){var e=this;this.authenticationService.getUserInformation().then(function(t){e.decideUserAction(t.profile.tid);}).catch(function(){e.logger.error("unable to get user tenantId"),e.decideUserAction();});},e.prototype.navigateToUrl=function(e){this.$window.open(e,"_blank"),this.logger.info("User successfully navigated to "+e);},e.prototype.decideUserAction=function(e){var t=this,n=this.settingsService.valueAsObject(this.constants.settings.names.freemiumDecommissionConfig),r=this.identityService.isFreemiumTenantMixedModeUser(),a=this.identityService.isTenantAdmin(),i=n.upgradeUrl;return e&&(i+="&tenantId="+encodeURIComponent(e)),a?this.$qNoApply.resolve().then(function(){return t.navigateToUrl(i);}):!a&&r?this.$qNoApply.resolve().then(function(){return t.navigateToUrl(n.learnMoreUrl);}):this.manageTenantService.getAllTenantAdmins().then(function(e){var r=e.find(function(e){return!!e.mri;});if(r){var a=moment(n.decommissionDate).format("MMM Do, YYYY"),o=t.$translate.instant(t.resources.strings.es_freemium_decommission_user_to_admin_message_draft,{decommissionDate:a}),s=t.sxConfig.getCurrentSkypeMri();o+=" "+i;var c="https://teams.microsoft.com/l/chat/0/0?users="+encodeURIComponent(r.mri+","+s)+"&topicName=ChatWithAdmin&message="+encodeURIComponent(o);return t.deepLinkService.resolveURL(c).catch(function(){t.logger.error("unable to navigate to deeplink url with admin"),t.navigateToUrl(n.learnMoreUrl);});}t.navigateToUrl(n.learnMoreUrl);}).catch(function(){t.logger.error("unable to find admin"),t.navigateToUrl(n.learnMoreUrl);});},e;}());t.FreemiumDecommissionActionHandler=r,angular.module("teamspace.freemiumDecommissionActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.locales","teamspace.deepLinkService","teamspace.manageTenantService","teamspace.settingsService","teamspace.identityService"]).service("freemiumDecommissionActionHandler",r);},2485:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),a=(function(){function e(e,t,n,r,a,i,o){this.esTranslate=e,this.constants=t,this.loggingService=n,this.resources=r,this.localizationService=a,this.mobileDownloadEmailService=i,this.mobileDownloadSmsService=o;}return e.$inject=["esTranslate","constants","loggingService","resources","localizationService","mobileDownloadEmailService","mobileDownloadSmsService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.mobileUpsell;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.handleAction.mobileUpsell);if(e)if(e.getIsLoading())t.incomplete({message:"action is currently on-going"});else{var n=_(e.getUiControls()).filter(function(e){return r.IsUserInterfaceEmailSms(e.control);}).first();if(n)if(n.isValid){e.setIsLoading(!0),e.setErrorText(""),n.isLoading=!0,(validator.isEmail(n.value)?this.sendEmail(n.value,e,t):this.sendSms(n.phoneNumber,e,t)).finally(function(){e.setIsLoading(!1),n.isLoading=!1;});}else t.incomplete({message:"user input is not valid"});else t.fail({message:"unable to find input context for mobile upsell"});}else t.fail({message:"controller is a required argument to handleAction!"});},e.prototype.sendEmail=function(e,t,n){var r=this;return this.mobileDownloadEmailService.sendDownloadMail(e,this.localizationService.getLocale()).then(function(){n.stop({message:"success sending email"}),r.setIsCompleted(r.esTranslate.instant(r.resources.strings.download_mobile_dialog_send_completed,{sendTo:"email"},{email:e}),t);}).catch(function(e){var a=(e||{}).statusCode;n.fail({message:"unable to send mobile download email. statusCode="+a}),t.setErrorText(r.esTranslate.instant(r.resources.strings.download_mobile_dialog_error_message));});},e.prototype.sendSms=function(e,t,n){var r=this,a=libphonenumber.PhoneNumberUtil.getInstance();return this.mobileDownloadSmsService.sendSms(e).then(function(){n.stop({message:"success sending sms"}),r.setIsCompleted(r.esTranslate.instant(r.resources.strings.download_mobile_dialog_send_completed,{sendTo:"phoneNo"},{phoneNo:a.format(e,libphonenumber.PhoneNumberFormat.NATIONAL)}),t);}).catch(function(e){var a=(e||{}).statusCode;n.fail({message:"unable to send mobile download sms. statusCode="+a}),t.setErrorText(r.esTranslate.instant(r.resources.strings.download_mobile_dialog_sms_error_message));});},e.prototype.setIsCompleted=function(e,t){t.getUiControls().forEach(function(e){var t=r.IsUserInterfaceControlImage(e.control),n=r.IsUserInterfaceControlQrCodeImage(e.control),a=r.IsUserInterfaceControlBoldText(e.control);e.isHidden=!t&&!a||n;}),t.setIsCompleted(e,this.esTranslate.instant(this.resources.strings.mobile_upsell_dialog_send_another_link));},e;}());t.MobileUpsellActionHandler=a,angular.module("teamspace.mobileUpsellActionHandler",["teamspace.constants","teamspace.loggingService","teamspace.localizationService","teamspace.esTranslate","teamspace.mobileDownloadEmailService","teamspace.mobileDownloadSmsService"]).service("mobileUpsellActionHandler",a);},2486:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r){this.$qNoApply=e,this.constants=t,this.navigationService=n,this.esLogger=r;}return e.$inject=["$qNoApply","constants","navigationService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToAggregateFiles;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.navigationService.navigateToAggregateFiles();}).catch(function(e){return t.esLogger.error("unable to navigate to aggregate files"),t.$qNoApply.reject(e);}).finally(function(){return e.close();});},e;}());t.NavigateToAggregateFilesActionHandler=r,angular.module("teamspace.navigateToAggregateFilesActionHandler",["teamspace.qNoApply","teamspace.navigationService","teamspace.esLogger","teamspace.constants"]).service("navigateToAggregateFilesActionHandler",r);},2487:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i,o,s,c,u,l){this.$rootScope=e,this.$qNoApply=t,this.esLogger=n,this._actionKey=r,this.appId=a,this.appBarItemType=i,this.layoutService=o,this.userAppsStore=s,this.appBarService=c,this.settingsService=u,this.constants=l;}return Object.defineProperty(e.prototype,"enableDynamicAppBarRendering",{get:function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableDynamicAppBarRendering);},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionKey",{get:function(){return this._actionKey;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.userAppsStore.waitForPinnedAndCoreAppsToInitialize().then(function(){if(t.enableDynamicAppBarRendering)return(e=t.appBarService.getAppBarItem(t.appId))?t.appBarService.onAppSelected(t.$rootScope,e,services.AppSelectionSource.EngagementSurface):t.$qNoApply.reject("app bar item not found");var e=t.layoutService.getAppBarItem(t.appBarItemType);if(!e)return t.$qNoApply.reject("app bar item not found");t.layoutService.onAppBarItemClick(e),e.clicked(e);}).catch(function(e){var n=__WRAPPED_get(teamspace.services.AppBarItemType,t.appBarItemType);return t.esLogger.error("unable to navigate to app bar item: "+n+" "+t.appId+"-"+t.enableDynamicAppBarRendering),t.$qNoApply.reject(e);}).finally(function(){return e.close();});},e;}());t.NavigateToAppBarItemActionHandler=r,angular.module("teamspace.navigateToAppBarItemActionHandlers",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.userAppsStore","teamspace.appBarService","teamspace.layoutService","teamspace.userAppsStore","teamspace.settingsService","teamspace.activityUtilityService"]).factory("navigateToFilesActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,a,i,o,s,c,u){return new r(e,t,a.newLogger("navigateToFilesActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToFiles,n.appId.files,teamspace.services.AppBarItemType.Files,i,o,s,c,n);}]).factory("navigateToChatActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,a,i,o,s,c,u){return new r(e,t,a.newLogger("navigateToChatActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToChat,n.appId.chat,teamspace.services.AppBarItemType.Chat,i,o,s,c,n);}]).factory("navigateToTeamsActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,a,i,o,s,c,u){return new r(e,t,a.newLogger("navigateToTeamsActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToTeams,n.appId.teamsAndChannel,teamspace.services.AppBarItemType.Teams,i,o,s,c,n);}]).factory("navigateToCalendarActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,a,i,o,s,c,u){return new r(e,t,a.newLogger("navigateToCalendarActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToCalendar,n.appId.calendar,teamspace.services.AppBarItemType.Calendar,i,o,s,c,n);}]).factory("navigateToCallsActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,a,i,o,s,c,u){return new r(e,t,a.newLogger("navigateToCallsActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToCalls,n.appId.calling,teamspace.services.AppBarItemType.Call,i,o,s,c,n);}]).factory("navigateToActivityActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService","activityUtilityService",function(e,t,n,a,i,o,s,c,u,l){return new r(e,t,a.newLogger("navigateToActivityActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToActivity,l.activityAppId,teamspace.services.AppBarItemType.Alerts,i,o,s,c,n);}]);},2488:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r){this.$qNoApply=e,this.constants=t,this.navigationService=r,this.logger=n.newLogger("NavigateToAppsActionHandler");}return e.$inject=["$qNoApply","constants","loggingService","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToApps;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.navigationService.navigateToAppsView();}).catch(function(e){return t.logger.error("unable to navigate to apps"),t.$qNoApply.reject(e);}).finally(function(){return e.close();});},e;}());t.NavigateToAppsActionHandler=r,angular.module("teamspace.navigateToAppsActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.loggingService","teamspace.navigationService"]).service("navigateToAppsActionHandler",r);},2489:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i){this.$q=e,this.constants=t,this.conversationsService=r,this.peopleService=a,this.navigationService=i,this.logger=n.newLogger("NavigateToChatWithContactActionHandler");}return e.$inject=["$q","constants","esLogger","conversationsService","peopleService","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToConversationWithContact.name;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToConversationWithContact.params;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=__WRAPPED_get(arguments,r);if(!n||1!=n.length||1!=this.paramsDesc.length){var a="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.logger.error(a),e.close(),this.$q.reject(a);}var i=n[0];return i&&i.email&&!i.mri?this.peopleService.getAllShortPeopleProfileFromAAD([i.email],"navigate-to-conversation-with-contact",!0).then(function(n){if(!n||!n.length){var r="Could not find any contact with that email";return t.logger.error(r),e.close(),t.$q.reject(r);}var a=n[0];return t.navigateToContactWithConversation(e,a);}):this.navigateToContactWithConversation(e,i);},e.prototype.navigateToContactWithConversation=function(e,t){var n=this,r=t&&this.conversationsService.getConversationWith(t.mri);if(!r||!r.id){var a="Unable to create conversation with "+JSON.stringify(t);return this.logger.error(a),e.close(),this.$q.reject(a);}return this.navigationService.navigateToChat(r.id,"esp_"+this.actionKey).catch(function(e){n.logger.error("Unable to navigate to contact"),n.$q.reject(e);}).finally(function(){return e.close();});},e;}());t.NavigateToChatWithContactActionHandler=r,angular.module("teamspace.navigateToChatWithContactActionHandler",["teamspace.constants","teamspace.esLogger","teamspace.conversationsService","teamspace.peopleService","teamspace.navigationService"]).service("navigateToChatWithContactActionHandler",r);},2490:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r){this.$q=e,this.constants=t,this.navigationService=r,this.logger=n.newLogger("NavigateToDocumentViewerActionHandler");}return e.$inject=["$q","constants","esLogger","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToDocumentViewer.name;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToDocumentViewer.params;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=__WRAPPED_get(arguments,r);if(!n||n.length<1||1!=this.paramsDesc.length){var a="Action handler "+this.actionKey+" expects 1 or more arguments, received "+JSON.stringify(n);return this.logger.error(a),e.close(),this.$q.reject(a);}var i=n[0];if(i){var o={documentViewerParams:{fileType:i.type,objectUrl:i.objectUrl,baseUrl:i.siteUrl,fileId:i.objectId,serviceName:this.constants.files.serviceName.aggregate,threadId:i.teamId,viewerAction:this.constants.files.fileActions.viewer.view},viewerState:this.constants.states.appDocumentViewer};return this.navigationService.navigateToFileViewer(o).catch(function(e){t.logger.error("Unable to navigate to file viewer"),t.$q.reject(e);}).finally(function(){return e.close();});}return e.close(),this.logger.error("AggregateDto is undefined"),this.$q.reject("No selected aggregateDto");},e;}());t.NavigateToDocumentViewerActionHandler=r,angular.module("teamspace.navigateToDocumentViewerActionHandler",["teamspace.constants","teamspace.esLogger","teamspace.navigationService"]).service("navigateToDocumentViewerActionHandler",r);},2491:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.$qNoApply=e,this.constants=t,this.freemiumUtilities=n;}return e.$inject=["$qNoApply","constants","freemiumUtilities"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToFreemiumLiveChat;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=__WRAPPED_get(arguments,r);return this.$qNoApply.resolve().then(function(){t.freemiumUtilities.openFreemiumLiveChatUrl();}).finally(function(){return e.close();});},e;}());t.NavigateToFreemiumLiveChatActionHandler=r,angular.module("teamspace.navigateToFreemiumLiveChatActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.freemiumUtilities"]).service("navigateToFreemiumLiveChatActionHandler",r);},2492:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r){this.constants=e,this.channelService=n,this.navigationService=r,this.logger=t.newLogger("NavigateToMostActiveChannelActionHandler");}return e.$inject=["constants","loggingService","channelService","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToMostActiveChannel;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"navCtx",{get:function(){return"nav-to-most-active-channel";},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.channelService.getTeams().then(function(e){var n=e.reduce(function(e,t){return e.concat(t.channels);},[]),r=_(n).map(function(e){return{lastSeen:e.lastSeen||"0",unreadCount:e.unreadCount||0,objectId:e.objectId};}).orderBy(["unreadCount","lastSeen"],["desc","desc"]).first();r?t.navigationService.navigateToChannel(r.objectId,t.navCtx):t.navigationService.navigateToDefaultTeamState(t.navCtx);}).catch(function(){t.logger.error("unable to navigate to most active channel");}).finally(function(){e.close();});},e;}());t.NavigateToMostActiveChannelActionHandler=r,angular.module("teamspace.navigateToMostActiveChannelActionHandler",["teamspace.constants","teamspace.loggingService","teamspace.channelService","teamspace.navigationService"]).service("navigateToMostActiveChannelActionHandler",r);},2493:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t){this.constants=e,this.navigationService=t;}return e.$inject=["constants","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToMostRecentTeam;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){return this.navigationService.navigateToLastTeamState("engagement-surfaces").then(function(){}).finally(function(){return e.close();});},e;}());t.NavigateToMostRecentTeamActionHandler=r,angular.module("teamspace.navigateToMostRecentTeamActionHandler",["teamspace.navigationService","teamspace.constants"]).service("navigateToMostRecentTeamActionHandler",r);},2494:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r){this.$qNoApply=e,this.constants=t,this.newChatService=r,this.logger=n.newLogger("NavigateToNewChatActionHandler");}return e.$inject=["$qNoApply","constants","loggingService","newChatService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToNewChat;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.newChatService.navigateToNewChat("navigate-to-new-chat-action-handler");}).catch(function(e){return t.logger.error("unable to navigate to new chat"),t.$qNoApply.reject(e);}).finally(function(){return e.close();});},e;}());t.NavigateToNewChatActionHandler=r,angular.module("teamspace.navigateToNewChatActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.loggingService","teamspace.newChatService"]).service("navigateToNewChatActionHandler",r);},2495:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i,o,s,c){this.$qNoApply=e,this.$rootScope=t,this.esLogger=n,this.layoutService=r,this.$q=a,this.appBarService=i,this.constants=o,this.settingsService=s,this.userAppsStore=c;}return Object.defineProperty(e.prototype,"enableDynamicAppBarRendering",{get:function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableDynamicAppBarRendering);},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToPeopleApp.name;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToPeopleApp.params;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=__WRAPPED_get(arguments,r);return n&&n[0]?this.userAppsStore.waitForPinnedAndCoreAppsToInitialize().then(function(){if(t.enableDynamicAppBarRendering){var e=t.appBarService.getAppBarItem(t.constants.appId.peopleApp);return e?t.appBarService.onAppSelected(t.$rootScope,e,services.AppSelectionSource.EngagementSurface):t.$qNoApply.reject("people app not found");}var n=t.layoutService.getAppBarItem(teamspace.services.AppBarItemType.PeopleApp);if(!n)return t.$qNoApply.reject("app bar people item not found");t.layoutService.onAppBarItemClick(n),n.clicked(n);}).catch(function(e){var n=__WRAPPED_get(teamspace.services.AppBarItemType,teamspace.services.AppBarItemType.PeopleApp);return t.esLogger.error("unable to navigate to app bar item: "+n+" "+t.constants.appId.peopleApp+"-"+t.enableDynamicAppBarRendering),t.$qNoApply.reject(e);}).finally(function(){return e.close();}):(this.esLogger.error("navigate to people app param missing"),e.close(),this.$q.resolve());},e;}());t.NavigateToPeopleAppActionHandler=r,angular.module("teamspace.navigateToPeopleAppActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.userAppsStore","teamspace.appBarService","teamspace.layoutService","teamspace.userAppsStore","teamspace.settingsService"]).factory("navigateToPeopleAppActionHandler",["$qNoApply","$rootScope","esLogger","layoutService","$q","appBarService","constants","settingsService","userAppsStore",function(e,t,n,a,i,o,s,c,u){return new r(e,t,n.newLogger("navigateToPeopleAppActionHandler"),a,i,o,s,c,u);}]);},2496:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r){this.$qNoApply=e,this.constants=t,this.dialogService=r,this.logger=n.newLogger("NavigateToSettingActionHandler");}return e.$inject=["$qNoApply","constants","esLogger","dialogService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToSetting;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.dialogService.open(t.constants.dialogs.optionsSettingsDialog,{tabItemId:"Privacy"});}).catch(function(e){return t.logger.error("unable to navigate to setting"),t.$qNoApply.reject(e);}).finally(function(){return e.close();});},e;}());t.NavigateToSettingActionHandler=r,angular.module("teamspace.navigateToSettingActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.dialogService"]).service("navigateToSettingActionHandler",r);},2497:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r){this.$qNoApply=e,this.constants=t,this.teamActionDialogUtilityService=r,this.logger=n.newLogger("NavigateToMostActiveChannelActionHandler");}return e.$inject=["$qNoApply","constants","loggingService","teamActionDialogUtilityService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToTwtCreateStep;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return e.close();}).then(function(){return t.teamActionDialogUtilityService.openCreateTeamDialog(0,!0);}).catch(function(e){return t.logger.error("unable to navigate to create team wizard"),t.$qNoApply.reject(e);});},e;}());t.NavigateToTwtCreateActionHandler=r,angular.module("teamspace.navigateToTwtCreateActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.loggingService","teamspace.teamActionDialogUtilityService"]).service("navigateToTwtCreateActionHandler",r);},2498:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a){this.$qNoApply=e,this.esLogger=t,this.$window=n,this._actionKey=r,this.url=a;}return Object.defineProperty(e.prototype,"actionKey",{get:function(){return this._actionKey;},enumerable:!0,configurable:!0}),e.prototype.title=function(){return this.url;},e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){t.$window.open(t.url,"_blank"),t.esLogger.info("User successfully navigated to "+t.url);}).finally(function(){return e.close();});},e;}());t.NavigateToUrlLegacyActionHandler=r;var a=(function(){function e(e,t,n,r,a){this.$qNoApply=e,this.$window=t,this.constants=n,this.deepLinkService=a,this.logger=r.newLogger("NavigateToUrlActionHandler");}return e.$inject=["$qNoApply","$window","constants","esLogger","deepLinkService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToUrl.name;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToUrl.params;},enumerable:!0,configurable:!0}),e.prototype.title=function(){for(var e=[],t=0;t<arguments.length;t++)__WRAPPED_set(e,t,'=',__WRAPPED_get(arguments,t));return e?e[0]:void 0;},e.prototype.handleAction=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=__WRAPPED_get(arguments,r);if(!n||1!=n.length||1!=this.paramsDesc.length){var a="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.logger.error(a),e.close(),this.$qNoApply.reject(a);}var i=n[0];return i.startsWith("https://teams.microsoft.com/l/")?this.$qNoApply.resolve().then(function(){return t.deepLinkService.resolveURL(i);}).catch(function(e){return t.logger.error("unable to navigate to deeplink url"),t.$qNoApply.reject(e);}).finally(function(){return e.close();}):this.$qNoApply.resolve().then(function(){t.$window.open(i,"_blank"),t.logger.info("User successfully navigated to "+i);}).finally(function(){return e.close();});},e;}());t.NavigateToUrlActionHandler=a,angular.module("teamspace.navigateToUrlActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.deepLinkService"]).service("navigateToUrlAcionHandler",a).factory("downloadAndroidAppActionHandler",["$qNoApply","constants","$window","esLogger",function(e,t,n,a){return new r(e,a.newLogger("downloadAndroidAppActionHandler"),n,t.growth.engagementSurfaces.actionKey.downloadAndroidApp,t.growth.engagementSurfaces.externalUrls.androidAppStoreUrl);}]);},2499:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r){this.$qNoApply=e,this.constants=t,this.esLogger=n,this.navigationService=r;}return e.$inject=["$qNoApply","constants","esLogger","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToWhatsNew;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.navigationService.navigateToHelpAppWhatsNew();}).catch(function(e){return t.esLogger.error("unable to navigate to whats new"),t.$qNoApply.reject(e);}).finally(function(){return e.close();});},e;}());t.NavigateToWhatsNewActionHandler=r,angular.module("teamspace.navigateToWhatsNewActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.navigationService"]).service("navigateToWhatsNewActionHandler",r);},2500:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r){this.$qNoApply=e,this.constants=t,this.dialogService=n,this.logger=r.newLogger("OpenDialogActionHandler");}return e.$inject=["$qNoApply","constants","dialogService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.openDialog.name;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.openDialog.params;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=__WRAPPED_get(arguments,r);if(!n||1!==n.length||1!==this.paramsDesc.length){var a="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.returnFailure(a,e);}var i=n[0];return i in this.constants.dialogs?this.$qNoApply.resolve().then(function(){return t.dialogService.open(i);}).catch(function(){return t.returnFailure("Unable to open dialog "+i,e);}).finally(function(){return e.close();}):this.returnFailure("Dialog "+i+" does not exist",e);},e.prototype.returnFailure=function(e,t){return this.logger.error(e),t.close(),this.$qNoApply.reject(e);},e;}());t.OpenDialogActionHandler=r,angular.module("teamspace.openDialogActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.dialogService","teamspace.esLogger"]).service("openDialogActionHandler",r);},2501:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a){this.$qNoApply=e,this.constants=t,this.routeUtilityService=n,this.dialogService=r,this.logger=a.newLogger("OpenInContextAppStoreDialogActionHandler");}return e.$inject=["$qNoApply","constants","routeUtilityService","dialogService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.openInContextAppStore;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this,n=this.routeUtilityService.getRootRouteParams().threadId||null;this.logger.info("Handling OpenInContextAppStoreDialogActionHandler action for treatment: "+e.treatment+" in threadId: "+n);var r=this.constants.lazyDialogs.inContextAppStore;return this.$qNoApply.resolve().then(function(){return n?t.dialogService.openLazyDialog(r,t.constants.lazyModules.extensibilityDialogs,{threadId:n,selectedCapability:teamspace.services.AppsServiceCategoryFilter.Tabs}):t.$qNoApply.reject("threadId is null");}).then(function(e){t.logger.info("Handled OpenInContextAppStoreDialogActionHandler with dialog: "+(e&&e.id));}).catch(function(n){return t.returnFailure("Unable to open dialog "+r+" with reason: "+n,e);}).finally(function(){return e.close();});},e.prototype.returnFailure=function(e,t){return this.logger.error(e),this.$qNoApply.reject(e);},e;}());t.OpenInContextAppStoreDialogActionHandler=r,angular.module("teamspace.openInContextAppStoreDialogActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.routeUtilityService","teamspace.dialogService","teamspace.esLogger"]).service("openInContextAppStoreDialogActionHandler",r);},2502:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),a=(function(){function e(e,t){this.$q=e,this.constants=t;}return e.$inject=["$q","constants"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.openInvitationWizard;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){return _(e.getUiControls()).filter(function(e){return r.IsUserInterfaceControlPendingJoinRequests(e.control);}).first().openInvitationWizard(),this.$q.resolve();},e;}());t.OpenInvitationWizardActionHandler=a,angular.module("teamspace.openInvitationWizardActionHandler",["teamspace.constants"]).service("openInvitationWizardActionHandler",a);},2503:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a){this.constants=e,this.dialogService=t,this.layoutService=r,this.$qNoApply=a,this.logger=n.newLogger("OpenSettingsSwitchToCompactChatActionHandler");}return e.$inject=["constants","dialogService","esLogger","layoutService","$qNoApply"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.openSettingsSwitchToCompactChat;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){t.dialogService.open(t.constants.dialogs.optionsSettingsDialog),t.layoutService.setChatDensity("compact");}).catch(function(e){return t.logger.error("unable to open settings and switch density"),t.$qNoApply.reject(e);}).finally(function(){return e.close();});},e;}());t.OpenSettingsSwitchToCompactChatActionHandler=r,angular.module("teamspace.openSettingsSwitchToCompactChatActionHandler",["teamspace.constants","teamspace.dialogService","teamspace.esLogger","teamspace.layoutService","teamspace.qNoApply"]).service("openSettingsSwitchToCompactChatActionHandler",r);},2504:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r){this.$qNoApply=e,this.appBarService=t,this.constants=n,this.logger=r.newLogger("PinPeopleAppToMenuActionHandler");}return e.$inject=["$qNoApply","appBarService","constants","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.pinPeopleAppToMenu;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this.appBarService.getAppBarItem(this.constants.appId.peopleApp);if(t)return this.appBarService.togglePinApp(t),this.$qNoApply.resolve();var n="people app not found";return this.logger.warn(n),this.$qNoApply.reject(n);},e;}());t.PinPeopleAppToMenuActionHandler=r,angular.module("teamspace.pinPeopleAppToMenuActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.appBarService","teamspace.esLogger"]).service("pinPeopleAppToMenuActionHandler",r);},2505:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i){this.$qNoApply=e,this.constants=t,this.dialogService=n,this.loggingService=r,this.videoUrl=i.fre.videos.base+__WRAPPED_get(t.azureVideos.freemiumFiveThingsVideo,a.getSupportedVideoLocale())+i.fre.videos.videoParams;}return e.$inject=["$qNoApply","constants","dialogService","loggingService","localizationService","appConfig"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.playFreVideo;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this,n=this.loggingService.newScenario(this.constants.scenarios.freemium.freemiumFreVideoCoachmarkPlayVideo);return this.$qNoApply.resolve().then(function(){t.showVideo(),n.stop();}).catch(function(){n.fail({message:"Error playing freemium fre video"});}).finally(function(){e.close();});},e.prototype.showVideo=function(){this.dialogService.open(this.constants.dialogs.displayVideo,{videoSrc:this.videoUrl,videoType:"video/mp4",videoCallerId:"freemium-fre-video-coachmark"});},e;}());t.PlayFreVideoActionHandler=r,angular.module("teamspace.playFreVideoActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.config","teamspace.videoIframeDialog","teamspace.dialogService","teamspace.loggingService","teamspace.localizationService"]).service("playFreVideoActionHandler",r);},2506:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),a=(function(){function e(e,t){this.$q=e,this.constants=t;}return e.$inject=["$q","constants"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.sendMemberInvites;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){return _(e.getUiControls()).filter(function(e){return r.IsUserInterfaceControlMemberInvite(e.control);}).first().sendInvitations(),this.$q.resolve();},e;}());t.SendMemberInvitesActionHandler=a,angular.module("teamspace.sendMemberInvitesActionHandler",["teamspace.constants"]).service("sendMemberInvitesActionHandler",a);},2507:function(e,t,n){"use strict";var r=this&&this.__extends||(function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&__WRAPPED_set(e,n,'=',__WRAPPED_get(t,n));})(t,n);};return function(t,n){function r(){this.constructor=t;}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r());};}());Object.defineProperty(t,"__esModule",{value:!0});var a=teamspace.services.CortanaServiceEvents,i=(function(e){function t(t,n,r,a,i){var o=e.call(this)||this;return o.$q=t,o.constants=n,o.cortanaFREService=r,o.cortanaEventingService=a,o.cortanaConfigurationService=i,o;}return r(t,e),t.$inject=["$q","constants","cortanaFREService","cortanaEventingService","cortanaConfigurationService"],Object.defineProperty(t.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.updateCortanaConsent.name;},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.updateCortanaConsent.params;},enumerable:!0,configurable:!0}),t.prototype.handleAction=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=__WRAPPED_get(arguments,r);return n&&2==n.length&&(n[0]||this.cortanaEventingService.triggerEvent(a.consentUpdated,!1,{showPopup:!1}),n[1]?this.cortanaConfigurationService.setUserConsent(teamspace.services.ConsentType.Long,n[0]).then(function(){t.cortanaFREService.isConsentModalRequired()||t.cortanaEventingService.triggerEvent(a.consentUpdated,!0,{showPopup:!0});}):this.cortanaConfigurationService.setUserConsent(teamspace.services.ConsentType.Short,n[0]).then(function(){t.cortanaFREService.isConsentModalRequired()?n[0]&&t.cortanaFREService.showConsentModal():t.cortanaEventingService.triggerEvent(a.consentUpdated,!0,{showPopup:!0});})),e.close(),this.$q.resolve();},t;}(SkypeX.Services.ObservableBase));t.UpdateCortanaConsentHandler=i,angular.module("teamspace.updateCortanaConsentHandler",["teamspace.constants","teamspace.cortanaFREService","teamspace.cortanaEventingService","teamspace.cortanaConfigurationService"]).service("updateCortanaConsentHandler",i);},2508:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),a=(function(){function e(e,t,n,r,a){this.$q=e,this.constants=t,this.loggingService=n,this.channelService=r,this.conversationsAsyncService=a;}return e.$inject=["$q","constants","loggingService","channelService","conversationsAsyncService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.updateDiscoverySettings;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this,n=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.handleAction.discoverySettings);if(e)if(e.getIsLoading())n.incomplete({message:"loading is currently on-going"});else{var a=_(e.getUiControls()).filter(function(e){return r.IsUserInterfaceDiscoverySettings(e.control);}).first();if(a)if(a.isPending)n.incomplete({message:"action is currently on-going"});else{a.isPending=!0;var i=void 0!==a.erroredSettings&&a.erroredSettings.length>0,o=i?a.erroredSettings:a.discoverySettings.filter(function(e){return e.isDiscoverable;});if(0!==o.length){var s=_.map(o,function(e){var n=t.$q.defer();return t.conversationsAsyncService.getConversation(e.team.objectId).then(function(e){return e||n.reject(),t.channelService.setTeamIsDiscoverable(e.groupId,!0);}).then(function(t){if(i){var r=a.erroredSettings.indexOf(e,0);r>-1&&a.erroredSettings.splice(r,1);}n.resolve();}).catch(function(t){e.retryFailed=i,i||a.erroredSettings.push(e),n.reject();}),n.promise;});return this.$q.all(s).then(function(e){n.stop({message:"success updating discovery settings"}),a.isPending=!1,a.isSuccess=!0,a.handleSuccess();}).catch(function(e){n.fail({message:"unable to update discovery setting for one or more teams"}),a.isPending=!1,a.handleError();});}}else n.fail({message:"unable to find input context for discovery settings"});}else n.fail({message:"controller is a required argument to handleAction!"});},e;}());t.UpdateDiscoverySettingsActionHandler=a,angular.module("teamspace.updateDiscoverySettingsActionHandler",["teamspace.constants","teamspace.loggingService","teamspace.channelService","teamspace.conversationsAsyncService"]).service("updateDiscoverySettingsActionHandler",a);},2509:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),a=(function(){function e(e,t,n){this.$q=e,this.constants=t,this.logger=n.newLogger("UpdateUserProfileActionHandler");}return e.$inject=["$q","constants","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.updateUserProfile;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=_(e.getUiControls()).filter(function(e){return r.IsUserInterfaceUpdateUserProfile(e.control)||r.IsUserInterfaceUpdateUserProfileV2(e.control);}).first();return t?(t.onSave(),this.$q.resolve()):(this.logger.error("unable to find input context for update user profile"),e.close(),this.$q.reject());},e;}());t.UpdateUserProfileActionHandler=a,angular.module("teamspace.updateUserProfileActionHandler",["teamspace.constants","teamspace.esLogger"]).service("updateUserProfileActionHandler",a);},2510:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a){this.$qNoApply=e,this.constants=t,this.hybridContentVisibilityManager=n,this.utilityService=r,this.logger=a.newLogger("CreateVoiceProfileActionHandler");}return e.$inject=["$qNoApply","constants","hybridContentVisibilityManager","utilityService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.createVoiceProfile;},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){t.updateVoiceEnrollment();}).catch(function(e){return t.logger.error("Failed to update voice enrollment: "+e),t.$qNoApply.reject(e);}).finally(function(){return e.close();});},e.prototype.updateVoiceEnrollment=function(){var e=this;this.logger.info("Updating voice enrollment... ");var t,n;t={id:null,type:"voiceenrollment",action:"view"},n="ExternalCommand-"+this.constants.events.multiWindow.entryPoints.biometricVoiceEnrollment;var r=this.utilityService.generateUUID(),a={entity:t,command:{visibilityState:"show",stateTransition:"new",correlation:{id:r,startTimestamp:Date.now(),source:n}}};return this.hybridContentVisibilityManager.enqueueEntityCommand(a).then(function(){e.logger.info("biometric enrollment app popping out with command: "+a.entity.type+", action: "+a.entity.action+", correlationId: "+r);}).catch(function(t){e.logger.error("Error popping out biometric enrollment window: "+JSON.stringify(t)+". CorrelationId: "+r);});},e;}());t.CreateVoiceProfileActionHandler=r,angular.module("teamspace.createVoiceProfileActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.hybridContentVisibilityManager","teamspace.utilityService","teamspace.esLogger"]).service("createVoiceProfileActionHandler",r);},2511:function(e,t,n){"use strict";var r=this&&this.__extends||(function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&__WRAPPED_set(e,n,'=',__WRAPPED_get(t,n));})(t,n);};return function(t,n){function r(){this.constructor=t;}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r());};}());Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(t,n,r,a,i,o,s,c,u){var l=e.call(this,c.middleTierConstants.newEndpointAddress,a,o,n,t,r,s,i)||this;return l.$q=t,l.$http=n,l.$qNoApply=r,l.settingsService=a,l.appStateService=i,l.constants=o,l.authenticationService=s,l.appConfig=c,l.esTranslate=u,l;}return r(t,e),t.$inject=["$q","$http","$qNoApply","settingsService","appStateService","constants","authenticationService","appConfig","esTranslate"],Object.defineProperty(t.prototype,"activityParamsDataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.activityParams;},enumerable:!0,configurable:!0}),t.prototype.postActivityFeed=function(e,n,r){var a=this,i=e.params;if(!i||!i.activityType||!i.topic){p="Invalid pararameters for generating activity feed.";return n.fail({errorMessage:p}),this.$q.reject(p);}var o="text"===i.topic.source?{source:i.topic.source,value:this.esTranslate.instant(i.topic.resxKey,i.topic.resxParams,r,this.constants.translation.interpolationIds.messageformat),webUrl:i.topic.deeplink?i.topic.deeplink:__WRAPPED_get(r,this.activityParamsDataKey).deeplink}:{source:i.topic.source,value:i.topic.value},s=void 0;i.previewText&&(s={content:this.esTranslate.instant(i.previewText.resxKey,i.previewText.resxParams,r,this.constants.translation.interpolationIds.messageformat)});var c={topic:o,activityType:i.activityType,previewText:s,recipient:i.recipient};i.templateParameters&&i.templateParameters.length?c.templateParameters=i.templateParameters:__WRAPPED_get(r,this.activityParamsDataKey)&&__WRAPPED_get(r,this.activityParamsDataKey).templateParameters&&__WRAPPED_get(r,this.activityParamsDataKey).templateParameters.length&&(c.templateParameters=__WRAPPED_get(r,this.activityParamsDataKey).templateParameters);for(var u=0;c.templateParameters&&u<c.templateParameters.length;u++){var l=__WRAPPED_get(c.templateParameters,u);if(!l.name||!l.value){var p="Bad templateParameters for synthetic notification with activity type '"+c.activityType+"'";return n.fail({errorMessage:p}),this.$q.reject(p);}}var g={retryOn:["5xx","404","429"],maxRetries:3};return this.withRetry(function(){return a.performApiPost(t.API_ENDPOINT,{callType:t.CALL_TYPE},c).toNgPromise(a.$qNoApply);},null,g.retryOn,g.maxRetries).then(function(){return n.stop();}).catch(function(e){var t=e.errorCode,r=e.statusCode;return n.fail({errorMessage:"Failed to post activity feed.",errorCode:t,statusCode:r}),a.$q.reject({errorMessage:"Failed to post activity feed."});});},t.prototype._getAuthHeaders=function(e,t){return void 0===e&&(e=!1),this.authenticationService.getAuthHeaders({},void 0,[t]);},t.prototype.getAuthConfig=function(){return{};},t.prototype.withRetry=function(e,t,n,r,a){void 0===t&&(t=null),void 0===n&&(n=["5xx","404"]),void 0===r&&(r=3),void 0===a&&(a=1e3);var i=this.$q.defer(),o=function(s){void 0===s&&(s=0),t&&t.resume(),e().then(i.resolve).catch(function(e){var c=(e||{}).statusCode;if(!n.map(function(e){return new RegExp(e.replace(/x/gi,"\\d"));}).some(function(e){return e.test(c);}))return i.reject(e);s<r?(s++,t&&t.pause({reason:"failed. will retry after delay. status="+c+" count="+s}),setTimeout(function(){return o(s);},Math.pow(s,2)*a)):i.reject(e);});};return o(0),i.promise;},t.CALL_TYPE="synthetic_notifications",t.API_ENDPOINT="/me/syntheticnotifications/generate",t;}(SkypeX.Services.GenericRestClient));t.EsActivityService=a,angular.module("teamspace.esActivityService",["teamspace.constants","teamspace.authenticationService"]).service("esActivityService",a);},2512:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t){this.banner=t,this.id=e.id,this.treatment=e.treatment;}return e.prototype.close=function(){this.banner.hide();},e;}()),a=(function(){function e(e,t,n,r,a,i,o,s,c,u){this.$rootScope=e,this.$q=t,this.constants=n,this.esTranslate=a,this.esActionHandler=i,this.esSurfaceStack=o,this.appStateAdapter=s,this.analyticsService=c,this.eventingService=u;}return e.$inject=["$rootScope","$q","constants","loggingService","esTranslate","esActionHandler","esSurfaceStack","appStateAdapter","analyticsService","eventingService"],e.prototype.displayBanner=function(e,t,n){var r,a=this,i=this.$q.defer(),o=e.params,s=o.actionCssClass||"",c=function(){r&&r.hide(),i.resolve();},u=(o.actions||[]).map(function(t,i){return{message:a.esTranslate.instant(t.resxKey,t.resxParams,n),icon:t.icon,title:a.esActionHandler.actionTitle(t.actionKey),run:function(){a.esSurfaceStack.setCurrentAction(t.actionKey);var i=a.createBannerActionContext(e,r);a.esActionHandler.handleAction(t.actionKey,i,n).catch(function(){return i.close();});},telemetryOptions:{moduleName:teamspace.components.PanelModuleName.engagementSurfaceBannerButton,moduleType:teamspace.components.PanelModuleType.button,scenario:teamspace.components.PanelActionScenario.engagementSurfaceBannerButton,scenarioType:teamspace.components.PanelActionScenarioType.engagementSurface,moduleSummary:"engagment surface banner button resx="+t.resxKey,gesture:teamspace.components.PanelActionGesture.click,dataBag:{id:e.id,currIndex:i,treatment:e.treatment,actionKey:a.esActionHandler.parseActionKey(t.actionKey).key}}};});r=this.appStateAdapter.mainNotificationBannerStore.showBanner(teamspace.services.Severity.Promo,this.esTranslate.instant(o.resxKey,o.resxParams,n),e.id+"-"+e.treatment,{countdownInSeconds:-1,autoHideTimer:o.autoCloseInSeconds||0,action:u,hideAction:function(t){a.setActionFromBannerHideSource(e,t),i.resolve();},cssClass:"engagement-surface",bannerIcon:o.icon,actionCssClass:s,telemetryOptions:{panelRegion:teamspace.PanelRegion.banner,panelType:teamspace.PanelType.engagementSurfaceBanner,moduleName:teamspace.components.PanelModuleName.notificationBanner,closeGesture:teamspace.components.PanelActionGesture.click,closeModuleType:teamspace.components.PanelModuleType.button,closeScenario:teamspace.components.PanelActionScenario.engagementSurfaceBannerButton,scenarioType:teamspace.components.PanelActionScenarioType.engagementSurface,closeOutcome:teamspace.components.PanelActionOutcome.dismiss,closeModuleSummary:"close engagement surface banner",dataBag:{id:e.id,treatment:e.treatment}}}),t.stop();var l=this.eventingService.$on(this.$rootScope,this.constants.events.engagementSurfaces.killActive,function(){return c();});return i.promise.finally(function(){return l();}),i.promise;},e.prototype.setActionFromBannerHideSource=function(e,t){var n,r=this,a=__WRAPPED_get((n={},__WRAPPED_set(n,teamspace.services.BannerHideSource.Close,'=',this.constants.growth.engagementSurfaces.actionKey.xClose),__WRAPPED_set(n,teamspace.services.BannerHideSource.Timeout,'=',this.constants.growth.engagementSurfaces.actionKey.timeout),n),t);if(a){if(a===this.constants.growth.engagementSurfaces.actionKey.timeout){var i={panelType:teamspace.PanelType.engagementSurfaceBanner,dataBag:{id:e.id,treatment:e.treatment,actionKey:a}};_.defer(function(){return r.analyticsService.sendPseudoPanelView(i);});}this.esSurfaceStack.setCurrentAction(a);}},e.prototype.createBannerActionContext=function(e,t){return new r(e,t);},e;}());t.EsBannerService=a,angular.module("teamspace.esBannerService",["teamspace.esTranslate","teamspace.loggingService","teamspace.appStateAdapter","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.constants","teamspace.analyticsService","teamspace.eventingService"]).service("esBannerService",a);},2513:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i){this.$q=e,this.constants=t,this.esParser=n,this.esSurfaceStack=r,this.dialogService=a,this.analyticsService=i;}return e.$inject=["$q","constants","esParser","esSurfaceStack","dialogService","analyticsService"],e.prototype.displayCards=function(e,t,n){var r=this,a=this.$q.defer(),i=e.params,o=i.map(function(t){return r.transform(e,t,n);}),s=i.find(function(e){return e&&!1===e.closeByDocument;}),c={cards:o,scenario:t,preCloseCallback:function(e){var t=[r.constants.promptCards.eventSource.overlayClick,r.constants.promptCards.eventSource.escape];if(_.includes(t,e)){var n=angular.element(".prompt-cards-holder"),a=n&&n.scope();a&&r.sendDismissPanelAction(a);}return!0;},closeByDocument:s&&s.closeByDocument},u=function(){return r.dialogService.open(r.constants.dialogs.promptCardsHolder,c).closePromise.then(function(e){var t,n=(t={},__WRAPPED_set(t,r.constants.promptCards.eventSource.doneBtn,'=',r.constants.growth.engagementSurfaces.actionKey.completedClose),__WRAPPED_set(t,r.constants.promptCards.eventSource.xClose,'=',r.constants.growth.engagementSurfaces.actionKey.xClose),__WRAPPED_set(t,r.constants.promptCards.eventSource.overlayClick,'=',r.constants.growth.engagementSurfaces.actionKey.xClose),__WRAPPED_set(t,r.constants.promptCards.eventSource.escape,'=',r.constants.growth.engagementSurfaces.actionKey.xClose),t);r.esSurfaceStack.setCurrentAction(__WRAPPED_get(n,e.value)),a.resolve();}).catch(a.reject);};return this.dialogService.isAnyDialogOpen()?(t.pause({reason:"waiting for existing dialog to close before showing swipe cards modal"}),this.dialogService.onAllDialogsClosed().then(function(){t.resume(),u();})):u(),a.promise;},e.prototype.transform=function(e,t,n){return t.text=t.text||{},{image:t.imageSrc,heading:t.headingResxKey,scenarioStepName:t.name,customClass:t.customClass,hideCloseBtn:t.hideCloseBtn,translationContext:{id:t.text.resxKey,values:this.getResxParamsForPromptCard(t.text.resxParams,n)},video:t.video&&t.video.text&&{hasTranslations:!1,translationContext:{id:t.video.text.resxKey,values:this.getResxParamsForPromptCard(t.video.text.resxParams,n)},videoOnMainImage:t.video.videoOnMainImage,videoSource:t.video.videoSource,playScenarioMarker:t.name+"-playVideo",doneScenarioMarker:t.name+"-closeVideo"},panelType:teamspace.PanelType.engagementSurfaceCarousel,trackData:{id:e.id,treatment:e.treatment,card:t.name}};},e.prototype.getResxParamsForPromptCard=function(e,t){var n=e;return e&&(n=this.esParser.evaluateExpressions(e,t)),n?JSON.stringify(n):void 0;},e.prototype.sendDismissPanelAction=function(e){this.analyticsService.onPanelAction(e,{action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.components.PanelActionOutcome.dismiss,scenario:teamspace.components.PanelActionScenario.closeFreCard,scenarioType:teamspace.components.PanelActionScenarioType.quitFRE},module:{name:teamspace.components.PanelModuleName.promptCardHolder.toString(),type:teamspace.components.PanelModuleType.closeDialog,summary:"Close FRE Card"}});},e;}());t.EsCarouselService=r,angular.module("teamspace.esCarouselService",["teamspace.esTranslate","teamspace.loggingService","teamspace.appStateAdapter","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.esParser","teamspace.constants"]).service("esCarouselService",r);},2514:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),a=(function(){function e(e,t,n,r,a,i,o,s,c,u,l,p,g,h,d,f,m){this.$window=e,this.$rootScope=t,this.$q=n,this.constants=r,this.coachmarksService=a,this.esActionHandler=i,this.esSurfaceStack=o,this.esTranslate=s,this.$sce=c,this.analyticsService=u,this.eventingService=l,this.esTriggers=p,this.resources=g,this.ariaLiveService=h,this.utilityService=d,this.esParseService=f,this.platformDetectService=m;}return e.$inject=["$window","$rootScope","$q","constants","coachmarksService","esActionHandler","esSurfaceStack","esTranslate","$sce","analyticsService","eventingService","esTriggers","resources","ariaLiveService","utilityService","esParseService","platformDetectService"],e.prototype.displayCoachmark=function(e,t,n){var a=this,i=this.$q.defer(),o=e.params,s=e.id,c=e.treatment,u=$.noop,l=function(){a.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),i.resolve(!0);},p=o.primaryAction&&{title:this.esTranslate.instant(o.primaryAction.resxKey,o.primaryAction.resxParams,n),tooltip:this.esActionHandler.actionTitle(o.primaryAction.actionKey),onClick:function(){a.esSurfaceStack.setCurrentAction(o.primaryAction.actionKey),a.esActionHandler.handleAction(o.primaryAction.actionKey,{id:s,treatment:c,close:function(){}},n);},trackScenario:teamspace.components.PanelActionScenario.engagementSurfaceCoachmarkPrimaryButton,trackSummary:"engagement surface coachmark primary button",trackOutcome:teamspace.components.PanelActionOutcome.primary,trackData:{id:e.id,treatment:e.treatment,actionKey:this.esActionHandler.parseActionKey(o.primaryAction.actionKey).key}},g=o.secondaryAction&&{title:this.esTranslate.instant(o.secondaryAction.resxKey,o.secondaryAction.resxParams,n),tooltip:this.esActionHandler.actionTitle(o.secondaryAction.actionKey),onClick:function(){a.esSurfaceStack.setCurrentAction(o.secondaryAction.actionKey),a.esActionHandler.handleAction(o.secondaryAction.actionKey,{id:s,treatment:c,close:function(){}},n);},trackScenario:teamspace.components.PanelActionScenario.engagementSurfaceCoachmarkSecondaryButton,trackSummary:"engagement surface coachmark secondary button",trackOutcome:teamspace.components.PanelActionOutcome.secondary,trackData:{id:e.id,treatment:e.treatment,actionKey:this.esActionHandler.parseActionKey(o.secondaryAction.actionKey).key}},h=o.img||{src:void 0},d=o.element,f=o.placement,m=0;_.isArray(d)&&(d=_.find(d,function(e){return $(e).is(":visible");})||_.first(d),m=_.indexOf(o.element,d)),_.isArray(f)&&(f=__WRAPPED_get(f,m));var v=function(){_.defer(function(){var e=$("#coachmark-tooltip").find("[tabbable]:not([data-tid=coachmark-close-button]):visible:not(.invisible):first");e.length||(e=$("#coachmark-tooltip").find("[tabbable]:visible:not(.invisible):first")),e.focus();});},y=function(){u(),o.closeOnBiEvent&&(u=a.esTriggers.subscribe(r.Trigger.BIEvent,o.closeOnBiEvent,a.esParseService,function(){a.esSurfaceStack.setCurrentAction(a.constants.growth.engagementSurfaces.actionKey.biEvent);var t={panelType:teamspace.PanelType.engagementSurfaceCoachmark,dataBag:{id:e.id,treatment:e.treatment,actionKey:a.constants.growth.engagementSurfaces.actionKey.biEvent}};return _.defer(function(){return a.analyticsService.sendPseudoPanelView(t);}),a.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),a.$q.resolve();}));},S=function(e){var t=e.which||e.keyCode;e.ctrlKey&&e.altKey&&e.shiftKey&&t===a.constants.keyCodes.p&&v();},A=this.esTranslate.instant(o.resxKey,o.resxParams,n),C=p||g||o.isSticky&&o.showStickyClose;this.coachmarksService.showAdHocCoachmark({element:d,content:this.$sce.trustAsHtml(A),placement:f,className:o.className,viewport:o.viewport,containedIn:o.containedIn,panelType:teamspace.PanelType.engagementSurfaceCoachmark,asModal:o.asModal,isSticky:o.isSticky,showStickyClose:o.showStickyClose,onClose:function(){return a.esSurfaceStack.setCurrentAction(a.constants.growth.engagementSurfaces.actionKey.xClose);},onTimeout:function(){var t={panelType:teamspace.PanelType.engagementSurfaceCoachmark,dataBag:{id:e.id,treatment:e.treatment,actionKey:a.constants.growth.engagementSurfaces.actionKey.timeout}};_.defer(function(){return a.analyticsService.sendPseudoPanelView(t);}),a.esSurfaceStack.setCurrentAction(a.constants.growth.engagementSurfaces.actionKey.timeout);},autoCloseInSeconds:o.autoCloseInSeconds,hideArrow:o.hideArrow,appendTo:o.appendTo,primaryAction:p,secondaryAction:g,img:{src:h.src,altResxKey:h.altResxKey,headerContent:h.headerResxKey&&this.$sce.trustAsHtml(this.esTranslate.instant(h.headerResxKey,h.headerResxParams,n))},markDisplayedOnTargetMove:o.markDisplayedOnTargetMove,trackData:{id:e.id,treatment:e.treatment}},t).then(i.resolve,i.reject,function(e){var t;if(C){var n=a.utilityService.stripHtml(A),r=a.esTranslate.instant(a.resources.strings.shift),s=a.esTranslate.instant(a.resources.strings.ctrl),c=a.esTranslate.instant(a.resources.strings.alt),u=a.esTranslate.instant(a.resources.strings.cmd_short),l=a.esTranslate.instant(a.resources.strings.option),p=a.platformDetectService.getOS()===a.constants.os.mac?u+"+"+l+"+"+r:s+"+"+c+"+"+r;a.ariaLiveService.update(a.esTranslate.instant(a.resources.strings.esp_actionable_coachmark_aria_anouncement,{description:"description",key:"key"},(t={},t.description=n,t.key=p,t)),!1),a.$window.addEventListener("keydown",S,!0);}o.closeOnBiEvent&&y(),i.notify(e);});var T=[this.eventingService.$on(this.$rootScope,this.constants.events.engagementSurfaces.killActive,function(){return l();}),function(){return o.closeOnBiEvent&&u();},function(){return a.$window.removeEventListener("keydown",S,!0);}];return i.promise.finally(function(){return T.forEach(function(e){return e();});}),i.promise.then(function(e){if(!e)return a.$q.reject();});},e;}());t.EsCoachmarkService=a,angular.module("teamspace.esCoachmarkService",["teamspace.esTranslate","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.coachmarksService","teamspace.analyticsService","teamspace.eventingService","teamspace.esTriggers","teamspace.utilityService","teamspace.ariaLiveService","teamspace.locales","teamspace.esParseService"]).service("esCoachmarkService",a);},2515:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),a=(function(){function e(){}return e.Action={Gesture:"Action.Gesture",Outcome:"Action.Outcome",Scenario:"Action.Scenario",ScenarioType:"Action.ScenarioType"},e.App={Name:"App.Name"},e.DataBag={id:"DataBag.id",currIndex:"DataBag.currIndex",messageType:"DataBag.messageType",atmentions:"DataBag.atmentions",attachments:"DataBag.attachments",slashCommand:"DataBag.slashCommand",value:"DataBag.value"},e.Tab={Ordinal:"Tab.Ordinal"},e.Module={Name:"Module.Name",State:"Module.State"},e.Panel={Type:"Panel.Type",LaunchMethod:"Panel.LaunchMethod"},e.Thread={Type:"Thread.Type"},e;}()),i=(function(){function e(){}return e.PanelView="panelView",e.PanelAction="panelAction",e;}()),o=(function(){function e(){}return e.Scenario={composeSendMessage:"composeSendMessage",addChannel:"addChannel",addMember:"addMember",chatStartAudioCall:"chatStartAudioCall",chatStartAudioCallSFB:"chatStartAudioCallSFB",chatStartVideoCall:"chatStartVideoCall",chatStartVideoCallSFB:"chatStartVideoCallSFB",chatListFavoriteConversation:"chatListFavoriteConversation",composeExpandComposer:"composeExpandComposer",sendInvites:"sendInvites",executeSlashCommand:"executeSlashCommand",teamCreate:"teamCreate",remindMeLater:"remindMeLater",teamDiscoverJoin:"teamDiscoverJoin",activityFeedClick:"activityFeedClick",cortanaInvoke:"cortanaInvoke",channelNavTab:"channelNavTab",composeSelectExtension:"composeSelectExtension",channelComposeFocus:"channelComposeFocus",channelNewPost:"channelNewPost",messageReply:"messageReply",changeTheme:"changeTheme",changeChatDensity:"changeChatDensity",hasUsedLeftRailFilter:"hasUsedLeftRailFilter",manageTenantSettings:"manageTenantSettings",chnlSetSaved:"chnlSetSaved",newGroupChatToggle:"newGroupChatToggle",channelAddTab:"channelAddTab",navInContextAppStoreDialog:"navInContextAppStoreDialog",callingMWEnabledUserPreference:"callingMWEnabledUserPreference"},e.ScenarioType={admin:"admin",inviteMembers:"inviteMembers",cortana:"cortana",manageLink:"manageLink",tabs:"tabs",select:"select"},e.Gesture={click:"click"},e.Module={Name:{addMember:"addMember",sendInvites:"sendInvites",reviewTeamDiscoverySettings:"reviewTeamDiscoverySettings",leftRailFilter:"leftRailFilter",toggleJoinTenantByUrl:"toggleJoinTenantByUrl",newChatGroupNameToggle:"newChatGroupNameToggle",inContextAppStoreDialog:"inContextAppStoreDialog",callingMeetingMWUserSetting:"callingMeetingMWUserSetting"},State:{multiWindow:"MultiWindow"}},e.Outcome={submit:"submit",select:"select",closeDialog:"closeDialog",openDialog:"openDialog",checked:"checked",unchecked:"unchecked"},e.DataBag={newConversation:"newConversation",replyConversation:"replyConversation",newP2PMessage:"newP2PMessage",atMentionCommand:"atMention"},e.Panel={Type:{tflFreProfileCard:"tflFreProfileCard",channel:"channel",activity:"activity",appsFlyoutPopover:"appsFlyoutPopover",messagingExtensionFlyout:"messagingExtensionFlyout"},LaunchMethod:{nav:"nav"}},e.Thread={Type:{Channel:"Channel",OneOnOneChat:"OneOnOneChat",GroupChat:"GroupChat"}},e;}()),s=(function(){function e(e,t,n,r,a){this.$rootScope=e,this.constants=t,this.eventingService=n,this.esRepository=r,this.matchers=this.getDataMatchRegistrants(),a.registerForMtma(this),this.initializeOnAppLaunchAndReinit();}return e.$inject=["$rootScope","constants","eventingService","esRepository","orchestrationService"],e.prototype.isPanelAction=function(e){return(e.eventType||"").toLowerCase()===i.PanelAction.toLowerCase();},e.prototype.isPanelView=function(e){return(e.eventType||"").toLowerCase()===i.PanelView.toLowerCase();},e.prototype.propEqual=function(e,t,n){return __WRAPPED_get(e.properties,t)&&__WRAPPED_get(e.properties,t).value==n;},e.prototype.propGreaterThan=function(e,t,n){return __WRAPPED_get(e.properties,t)&&__WRAPPED_get(e.properties,t).value>n;},e.prototype.getDataMatchRegistrants=function(){var e=this;return[{action:r.EngagementSurfaceAction.ComposeChannelMessage,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.composeSendMessage)&&e.propEqual(t,a.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,a.DataBag.messageType,o.DataBag.newConversation)&&e.propEqual(t,a.Thread.Type,o.Thread.Type.Channel);}},{action:r.EngagementSurfaceAction.ComposeChannelReply,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.composeSendMessage)&&e.propEqual(t,a.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,a.DataBag.messageType,o.DataBag.replyConversation)&&e.propEqual(t,a.Thread.Type,o.Thread.Type.Channel);}},{action:r.EngagementSurfaceAction.AddMention,match:function(t){return e.propGreaterThan(t,a.DataBag.atmentions,0);}},{action:r.EngagementSurfaceAction.ComposeOneOnOneChatMessage,match:function(t){return e.propEqual(t,a.DataBag.messageType,o.DataBag.newP2PMessage)&&e.propEqual(t,a.Thread.Type,o.Thread.Type.OneOnOneChat);}},{action:r.EngagementSurfaceAction.ShareFile,match:function(t){return e.propGreaterThan(t,a.DataBag.attachments,0)&&e.propEqual(t,a.Panel.Type,o.Panel.Type.channel);}},{action:r.EngagementSurfaceAction.AddChannel,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.addChannel)&&e.propEqual(t,a.Action.Outcome,o.Outcome.submit);}},{action:r.EngagementSurfaceAction.AddMember,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,a.Action.Scenario,o.Scenario.addMember)&&e.propEqual(t,a.Action.ScenarioType,o.ScenarioType.admin)&&e.propEqual(t,a.Module.Name,o.Module.Name.addMember);}},{action:r.EngagementSurfaceAction.ComposeOneOnManyChatMessage,match:function(t){return e.propEqual(t,a.DataBag.messageType,o.DataBag.newP2PMessage)&&e.propEqual(t,a.Thread.Type,o.Thread.Type.GroupChat);}},{action:r.EngagementSurfaceAction.StartAudioCall,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.chatStartAudioCall)||e.propEqual(t,a.Action.Scenario,o.Scenario.chatStartAudioCallSFB);}},{action:r.EngagementSurfaceAction.StartVideoCall,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.chatStartVideoCall)||e.propEqual(t,a.Action.Scenario,o.Scenario.chatStartVideoCallSFB);}},{action:r.EngagementSurfaceAction.FavoriteConversation,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.chatListFavoriteConversation);}},{action:r.EngagementSurfaceAction.ExpandComposer,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.composeExpandComposer);}},{action:r.EngagementSurfaceAction.InviteTenantMember,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.Action.Outcome,o.Outcome.select)&&e.propEqual(t,a.Action.Scenario,o.Scenario.sendInvites)&&e.propEqual(t,a.Action.ScenarioType,o.ScenarioType.inviteMembers)&&e.propEqual(t,a.Module.Name,o.Module.Name.sendInvites);}},{action:r.EngagementSurfaceAction.SendMessageWithAtCommand,match:function(t){return e.propEqual(t,a.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,a.Action.Scenario,o.Scenario.executeSlashCommand)&&e.propEqual(t,a.DataBag.slashCommand,o.DataBag.atMentionCommand);}},{action:r.EngagementSurfaceAction.CreateTeam,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.teamCreate)&&e.propEqual(t,a.Action.Outcome,o.Outcome.submit);}},{action:r.EngagementSurfaceAction.SetDiscoverySettingModalReminder,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.remindMeLater)&&e.propEqual(t,a.Action.Outcome,o.Outcome.closeDialog)&&e.propEqual(t,a.Module.Name,o.Module.Name.reviewTeamDiscoverySettings);}},{action:r.EngagementSurfaceAction.LearnTheBasicsTask1,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.DataBag.id,"learnTheBasicsMenu->viewActivityQuickGuide->complete")||e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.Action.Scenario,o.Scenario.activityFeedClick);}},{action:r.EngagementSurfaceAction.LearnTheBasicsTask2,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.DataBag.id,"learnTheBasicsMenu->newChatInteractiveGuide->complete")||e.propEqual(t,a.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,a.DataBag.messageType,o.DataBag.newP2PMessage);}},{action:r.EngagementSurfaceAction.LearnTheBasicsTask3,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.DataBag.id,"learnTheBasicsMenu->sendChannelMessageInteractiveGuide->complete")||e.propEqual(t,a.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,a.DataBag.messageType,o.DataBag.newConversation)&&e.propEqual(t,a.Thread.Type,o.Thread.Type.Channel);}},{action:r.EngagementSurfaceAction.LearnTheBasicsTask4,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.DataBag.id,"learnTheBasicsMenu->joinATeamInteractiveGuide->complete")||e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.Action.Scenario,o.Scenario.teamDiscoverJoin);}},{action:r.EngagementSurfaceAction.CortanaInvoke,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.Action.Scenario,o.Scenario.cortanaInvoke)&&e.propEqual(t,a.Action.ScenarioType,o.ScenarioType.cortana);}},{action:r.EngagementSurfaceAction.ChannelNavTab,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.channelNavTab)&&e.propGreaterThan(t,a.Tab.Ordinal,3);}},{action:r.EngagementSurfaceAction.ComposeSelectExtension,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.composeSelectExtension);}},{action:r.EngagementSurfaceAction.ChannelComposeFocus,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.channelComposeFocus)||e.propEqual(t,a.Action.Scenario,o.Scenario.channelNewPost)||e.propEqual(t,a.Action.Scenario,o.Scenario.messageReply);}},{action:r.EngagementSurfaceAction.ChangeChatDensity,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.changeChatDensity);}},{action:r.EngagementSurfaceAction.ChangeTheme,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.changeTheme);}},{action:r.EngagementSurfaceAction.HasUsedLeftRailFilter,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.hasUsedLeftRailFilter)&&e.propEqual(t,a.Module.Name,o.Module.Name.leftRailFilter);}},{action:r.EngagementSurfaceAction.ManageLinkSettings,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.Action.Scenario,o.Scenario.manageTenantSettings)&&e.propEqual(t,a.Action.ScenarioType,o.ScenarioType.manageLink)&&e.propEqual(t,a.Module.Name,o.Module.Name.toggleJoinTenantByUrl);}},{action:r.EngagementSurfaceAction.FollowChannel,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,a.Action.Scenario,o.Scenario.chnlSetSaved)&&(e.propEqual(t,a.DataBag.value,"BannerAndFeed|false|BannerAndFeed")||e.propEqual(t,a.DataBag.value,"BannerAndFeed|true|BannerAndFeed"));}},{action:r.EngagementSurfaceAction.RenameNewGroupChat,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.Action.Outcome,o.Outcome.select)&&e.propEqual(t,a.Action.Scenario,o.Scenario.newGroupChatToggle)&&e.propEqual(t,a.Module.Name,o.Module.Name.newChatGroupNameToggle);}},{action:r.EngagementSurfaceAction.AddTab,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.Action.Outcome,o.Outcome.openDialog)&&e.propEqual(t,a.Action.Scenario,o.Scenario.channelAddTab);}},{action:r.EngagementSurfaceAction.OpenPersonalFlyout,match:function(t){return e.propEqual(t,a.Panel.Type,o.Panel.Type.appsFlyoutPopover)&&e.propEqual(t,a.Panel.LaunchMethod,o.Panel.LaunchMethod.nav);}},{action:r.EngagementSurfaceAction.AddChatTab,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.navInContextAppStoreDialog)&&e.propEqual(t,a.Action.ScenarioType,o.ScenarioType.tabs)&&(e.propEqual(t,a.Thread.Type,o.Thread.Type.OneOnOneChat)||e.propEqual(t,a.Thread.Type,o.Thread.Type.GroupChat));}},{action:r.EngagementSurfaceAction.OpenMessagingExtensionFlyout,match:function(t){return e.propEqual(t,a.Panel.LaunchMethod,o.Panel.LaunchMethod.nav)&&e.propEqual(t,a.Panel.Type,o.Panel.Type.messagingExtensionFlyout);}},{action:r.EngagementSurfaceAction.EnableMultiWindow,match:function(t){return e.propEqual(t,a.Action.Scenario,o.Scenario.callingMWEnabledUserPreference)&&e.propEqual(t,a.Action.ScenarioType,o.ScenarioType.select)&&e.propEqual(t,a.Module.State,o.Module.State.multiWindow)&&e.propEqual(t,a.Action.Outcome,o.Outcome.checked)||e.propEqual(t,a.Action.Outcome,o.Outcome.unchecked);}},{action:r.EngagementSurfaceAction.LearnTheBasicsTask6,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.DataBag.id,"learnTheBasicsV2->viewActivityQuickGuide->complete");}},{action:r.EngagementSurfaceAction.LearnTheBasicsTask7,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.DataBag.id,"learnTheBasicsV2->newChatInteractiveGuide->complete")||e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.DataBag.id,"learnTheBasicsV2->newChatHybridArchitectureInteractiveGuide->complete");}},{action:r.EngagementSurfaceAction.LearnTheBasicsTask8,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.DataBag.id,"learnTheBasicsV2->sendChannelMessageInteractiveGuide->complete");}},{action:r.EngagementSurfaceAction.LearnTheBasicsTask9,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.DataBag.id,"learnTheBasicsV2->joinATeamInteractiveGuide->complete");}},{action:r.EngagementSurfaceAction.PowerAppsBannerAction,match:function(t){return e.propEqual(t,a.Action.Gesture,o.Gesture.click)&&e.propEqual(t,a.DataBag.id,"tabViewPowerAppsLinkCoachmark");}},{action:r.EngagementSurfaceAction.SeeTflFreProfileCard,match:function(t){return e.propEqual(t,a.Panel.Type,o.Panel.Type.tflFreProfileCard);}}];},e.prototype.cleanupOnAppTeardown=function(){this.unbindActionEventFn&&this.unbindActionEventFn(),this.unbindBiEventFn&&this.unbindBiEventFn(),this._hasStarted=!1,this.unbindActionEventFn=void 0,this.unbindBiEventFn=void 0;},e.prototype.initializeOnAppLaunchAndReinit=function(){},e.prototype.mtmaTelemetryIdentifier=function(){return"EsDataCollector";},e.prototype.startUp=function(){var e=this;this._hasStarted||(this._hasStarted=!0,this.unbindActionEventFn=this.eventingService.$onWithTenantScope(this.$rootScope,this.constants.events.engagementSurfaces.onAction,function(t,n){for(var r=0,a=n||[];r<a.length;r++)!(function(t){_.remove(e.matchers,function(e){return e.action===t;});}(__WRAPPED_get(a,r)));!e.matchers.length&&e.unbindBiEventFn&&e.unbindBiEventFn();}),this.unbindBiEventFn=this.eventingService.$onWithTenantScope(this.$rootScope,this.constants.events.logging.biEvent,function(t,n){_.defer(function(){var t=_(e.matchers).filter(function(e){return e.match(n);}).map(function(e){return e.action;}).value();e.esRepository.addEngagemetSurfaceActions(t);});}));},e;}());t.EsDataCollector=s,angular.module("teamspace.esDataCollector",["teamspace.constants","teamspace.eventingService","teamspace.esRepository","teamspace.orchestrationService"]).service("esDataCollector",s);},2516:function(e,t,n){"use strict";var r,a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=__WRAPPED_get(arguments,n);for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&__WRAPPED_set(e,a,'=',__WRAPPED_get(t,a));}return e;}).apply(this,arguments);},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=__WRAPPED_get(arguments,t).length;for(var r=Array(e),a=0,t=0;t<n;t++)for(var i=__WRAPPED_get(arguments,t),o=0,s=i.length;o<s;o++,a++)__WRAPPED_set(r,a,'=',__WRAPPED_get(i,o));return r;};Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),s=(function(){function e(e,t,n,r,a,i,o,s,c,u,l,p,g,h,d,f,m,v,y,S,A,C,T,b){this.$q=e,this.constants=t,this.esRepository=n,this.dialogService=r,this.settingsService=a,this.loggingService=i,this.analyticsService=o,this.$state=s,this.utilityService=c,this.esTriggers=u,this.esSurfaceStack=l,this.esBannerService=p,this.esHelpBotService=g,this.esCarouselService=h,this.esCoachmarkService=d,this.esQuickGuideService=f,this.esMenuService=m,this.esActivityService=v,this.esActionHandler=y,this.esFetchDataHandler=S,this.esParser=A,this.firstRunService=C,this.hybridContentVisibilityManager=T,this.logger=b.newLogger("EsDisplayManger"),this.queue=[];}return e.$inject=["$q","constants","esRepository","dialogService","settingsService","loggingService","analyticsService","$state","utilityService","esTriggers","esSurfaceStack","esBannerService","esHelpBotService","esCarouselService","esCoachmarkService","esQuickGuideService","esMenuService","esActivityService","esActionHandler","esFetchDataHandler","esParser","firstRunService","hybridContentVisibilityManager","esLogger"],e.prototype.initialize=function(e){this.esConfig=e,this.queue.forEach(function(e){e.scenario.incomplete({message:"re-initializing display manager after updated esConfig"});}),this.queue=[];},e.prototype.enqueue=function(e,t,n){var r=this;if(this.logger.info("enqueuing surface "+e.id+" "+e.treatment),this.settingsService.valueAsBoolean(this.constants.settings.names.sendPanelViewOnEngagementSurfaceQueued)&&this.sendPanelView(e,teamspace.PanelType.enqueuedEngagementSurface),e.trigger===o.Trigger.SurfaceShown)return this.displaySurface(e,t,n);this.queue.push({esSurfaceConfig:e,scenario:t,context:n});var a=this.$q.defer();return _.defer(function(){return r.processQueue().then(a.resolve,a.reject);}),a.promise;},e.prototype.display=function(t,n){var r=__WRAPPED_get(e.onDemandSurfaceEcsMap,t),a=this.settingsService.valueFor(r),i=this.esTriggers.getResolutionContext();if(!_.isNil(a)){var o=this.esRepository.expandOnDemandSurfaceConfig(a,r);return this.displaySurface(o,n,i);}return this.$q.reject("on-demand surface is not configured");},e.prototype.displayById=function(e,t,n){var r=this.esConfig.engagementSurfaces.find(function(t){return t.id===e;}),a=this.esTriggers.getResolutionContext();if(r){var i=this.esRepository.convertToProgrammaticSurface(r,t.id);return this.displaySurface(i,n,a);}return this.$q.reject("surface id is not defined");},e.prototype.getDateUntilNextPriority=function(e){if(e.trigger===o.Trigger.FirstRun)return moment(new Date(0));var t=e.priority,n=__WRAPPED_get(this.esConfig.priorityThrottlesInMinutes,t),r=this.esConfig.engagementSurfaces.reduce(function(e,t){return i(e,t.displayed);},[]);if(!r.length)return moment(new Date(0));var a=moment.max(r).clone();return a.add(n,this.constants.momentjs.unitOfTime.minutes),a;},e.prototype.processQueue=function(){var e=this;return this.processingQueuePromise||(this.processingQueuePromise=this._processQueue().finally(function(){return e.processingQueuePromise=void 0;})),this.processingQueuePromise;},e.prototype._processQueue=function(){var e=this,t=this.$q.resolve(),n=_.partition(this.queue,function(e){return-1===e.esSurfaceConfig.recur||e.esSurfaceConfig.displayed.length<e.esSurfaceConfig.recur;}),r=n[0];if(n[1].forEach(function(t){var n="not showing surface "+t.esSurfaceConfig.id+". already shown "+t.esSurfaceConfig.displayed.length+" times";e.logger.warn(n),t.scenario.stop({message:n});}),this.queue=r,!this.queue.length)return t;this.queue=_.sortBy(this.queue,[function(e){return e.esSurfaceConfig.displayed.length;},function(e){return e.esSurfaceConfig.priority;},function(e){return e.esSurfaceConfig.isSettled;},function(e){return e.esSurfaceConfig.order;}]);var a=!!this.esSurfaceStack.getSurfaceState().curr,i=moment(new Date()),s=_.find(this.queue,function(t){var n=t.esSurfaceConfig,r=t.context;return e.esMenuService.isMenuInProgress(n,r,e.esConfig);})||_.find(this.queue,function(t){var n=t.esSurfaceConfig,r=t.context;if(-1===n.priority)return!0;var o=e.getDateUntilNextPriority(n),s=i.isAfter(o)&&!a,c=e.esMenuService.isMenuComplete(n,r,e.esConfig);return s&&!c;});if(s){_.remove(this.queue,function(e){return e.esSurfaceConfig.id===s.esSurfaceConfig.id;});var c=s.esSurfaceConfig,u=s.scenario,l=s.context;if(t=this.displaySurface(c,u,l),c.trigger===o.Trigger.FirstRun){var p=_.partition(this.queue,function(e){return e.esSurfaceConfig.trigger===o.Trigger.FirstRun;}),g=p[0];return p[1].forEach(function(t){var n="not showing surface "+t.esSurfaceConfig.id+". does not meet display requirements";t.scenario.stop({message:n}),e.logger.info(n);}),this.queue=g,t=this.queue.length?t.finally(function(){return e._processQueue();}):t.finally(function(){e.firstRunService.setFreComplete(),e.esTriggers.onFirstRunComplete(),e.esTriggers.fire(o.Trigger.AppReady);});}if(this.queue.length)return t.catch(function(t){t.unsatisfiedDataCondition&&e._processQueue();}),t;}else this.logger.info("not showing "+this.queue.length+" surface(s) due to time-based throttling."),a&&this.logger.error("not showing surface. the surface "+this.esSurfaceStack.getSurfaceState().curr.id+" is currently showing");return this.queue.forEach(function(e){e.scenario.stop({message:"not showing surface. does not meet display requirements"});}),this.queue=[],t;},e.prototype.getSurfaceDisplayAction=function(e,t,n){var r,a=this,i=(r={},__WRAPPED_set(r,o.EngagementSurface.Modal,'=',this.displayModal),__WRAPPED_set(r,o.EngagementSurface.Coachmark,'=',this.displayCoachmark),__WRAPPED_set(r,o.EngagementSurface.Banner,'=',this.displayBanner),__WRAPPED_set(r,o.EngagementSurface.HelpBot,'=',this.postProactiveMessage),__WRAPPED_set(r,o.EngagementSurface.Carousel,'=',this.displayCarousel),__WRAPPED_set(r,o.EngagementSurface.QuickGuide,'=',this.displayQuickGuide),__WRAPPED_set(r,o.EngagementSurface.Menu,'=',this.displayMenu),__WRAPPED_set(r,o.EngagementSurface.Activity,'=',this.postActivityFeed),__WRAPPED_set(r,o.EngagementSurface.Iris,'=',this.displayIrisSurface),r);return function(){return __WRAPPED_get(i,e.surface).bind(a)(e,t,n);};},e.prototype.executePreActions=function(e,t,n){var r,a=this,i=this.$q.resolve(),o=e.id,s=e.treatment;return(e.preActionKeys||[]).forEach(function(e){i=i.then(function(){return r=e,a.esActionHandler.handleAction(e,{id:o,treatment:s,close:$.noop},n);}).then(function(){return a.logger.info("pre-display action "+e+" executed by "+o);});}),i.catch(function(e){var n="not showing surface "+o+". failed to execute pre-display action "+r+". "+e;return a.logger.error(n),t.fail({message:n}),a.$q.reject(e);}),i;},e.prototype.executeFetchDataActions=function(e,t,n){var r=this;n=n||{now:moment(new Date()),moment:moment};var i={},s=[],c=(e.fetchDataKeys||[]).filter(function(e){return void 0===__WRAPPED_get(n,e);}).map(function(t){return r.esFetchDataHandler.fetchData(t).then(function(e){return i=a(a({},i),e);}).then(function(){return(e.trigger===o.Trigger.SurfaceShown||e.trigger===o.Trigger.Programmatic)&&r.logger.warn("Suboptimal configuration for chained surface "+e.id+": consider adding fetchedDataKey "+t+" to the first surface of the chain as well.");}).catch(function(e){var n="failed to execute fetchdata action "+t+": "+e;return s.push(n),r.$q.reject(e);});});return this.$q.all(c).then(function(){return i;}).catch(function(){var e="not showing surface. failed to execute one of the fetchdata actions:\n"+s.join("\n");return r.logger.error(e),t.fail({message:e}),r.$q.reject(e);});},e.prototype.evaluateDataCondition=function(e,t,n){n=n||{now:moment(new Date()),moment:moment};var r=e.dataCondition,a=r&&this.esParser.evaluateExpression(r,n),i=!r||!!a;return i||this.logger.warn("Data condition ("+r+") is false for "+e.id),i;},e.prototype.displaySurface=function(e,t,n){var r=this;n=n||{now:moment(new Date()),moment:moment},this.logger.info("displaying surface "+e.id);var a=function(){var e="engagement surfaces control group bi logging only";return t.stop({message:e}),r.logger.info(e),r.$q.resolve();},i=0;return this.executeFetchDataActions(e,t,n).then(function(e){return _.merge(n,e);}).then(function(){return r.evaluateDataCondition(e,t,n);}).then(function(e){return e||r.$q.reject({unsatisfiedDataCondition:!0});}).then(function(){return r.sendEligiblePanelView(e);}).then(function(){return e.isControlGroup?a():r.$q.resolve().then(function(){return r.esSurfaceStack.setCurrentSurface(e);}).then(function(){return r.executePreActions(e,t,n);}).then(function(){return i=Date.now();}).then(function(){return r.getSurfaceDisplayAction(e,t,n)();}).then(function(){return r.sendElapsedPanelView(e,i);}).catch(function(){return r.esSurfaceStack.unsetCurrentSurface(),r.$q.reject();}).then(function(){return e.displayed.push(moment(new Date()));}).then(function(){return r.esSurfaceStack.onSurfaceClosed();}).then(function(){r.esRepository.updateSurfaceAsDisplayed(e);}).then(function(){return r.esTriggers.fire(o.Trigger.SurfaceShown);});});},e.prototype.displayBanner=function(e,t,n){return this.esBannerService.displayBanner(e,t,n);},e.prototype.displayCoachmark=function(e,t,n){return this.esCoachmarkService.displayCoachmark(e,t,n);},e.prototype.displayModal=function(e,t,n){var r=this,a=this.$q.defer(),i=e.params,o=i&&i.closeByEscape?this.constants.dialogs.engagementSurfaceDialogCloseByEsc:this.constants.dialogs.engagementSurfaceDialog,s=function(){return r.dialogService.open(o,{id:e.id,treatment:e.treatment,uiControls:e.userInterfaceControls,params:i,context:n,scenario:t}).closePromise.then(a.resolve).catch(a.reject);};if(this.dialogService.isAnyDialogOpen()&&!i.displayAtopOtherModals){var c="waiting for existing dialog to close before showing engagement modal";t.pause({reason:c}),this.logger.warn(c),this.dialogService.onAllDialogsClosed().then(function(){t.resume(),s();});}else s();return a.promise;},e.prototype.displayCarousel=function(e,t,n){return this.esCarouselService.displayCards(e,t,n);},e.prototype.displayQuickGuide=function(e,t,n){return this.esQuickGuideService.displayQuickGuide(e,t,n);},e.prototype.displayMenu=function(e,t,n){return this.esMenuService.displayMenu(e,t,n,this.esConfig);},e.prototype.postProactiveMessage=function(e,t,n){return this.esHelpBotService.invokeMessage(e,t,n);},e.prototype.postActivityFeed=function(e,t,n){return this.esActivityService.postActivityFeed(e,t,n);},e.prototype.displayIrisSurface=function(e,t,n){return this.hybridContentVisibilityManager.enqueueEntityCommand({entity:{type:"esp",action:"create",id:"irisSurfaceHolder"},command:{visibilityState:"show",stateTransition:"none",correlation:{startTimestamp:Date.now(),source:"ExternalCommand-ESP-TSW"}}});},e.prototype.sendEligiblePanelView=function(e){return-1===e.recur||e.eligibleTimes.length<e.recur?(this.sendPanelView(e,teamspace.PanelType.eligibleEngagementSurface),this.sendPseudoSurfacePanelView(e),e.eligibleTimes.push(moment(new Date())),this.esRepository.updateEligiblePanelViewSent(e).then(function(){})):this.$q.resolve();},e.prototype.sendPseudoSurfacePanelView=function(e){var t;if(this.settingsService.valueAsBoolean(this.constants.settings.names.sendPseudoEngagementSurfacePanelViewInControl)&&e.isControlGroup){var n=(t={},__WRAPPED_set(t,o.EngagementSurface.Modal,'=',{panelRegion:teamspace.PanelRegion.modal,panelType:teamspace.PanelType.engagementSurfaceDialog}),__WRAPPED_set(t,o.EngagementSurface.Coachmark,'=',{panelRegion:teamspace.PanelRegion.popover,panelType:teamspace.PanelType.engagementSurfaceCoachmark}),__WRAPPED_set(t,o.EngagementSurface.Banner,'=',{panelRegion:teamspace.PanelRegion.banner,panelType:teamspace.PanelType.engagementSurfaceBanner}),__WRAPPED_set(t,o.EngagementSurface.HelpBot,'=',{panelRegion:teamspace.PanelRegion.main,panelType:teamspace.PanelType.engagementSurfaceProactiveMessage}),__WRAPPED_set(t,o.EngagementSurface.Carousel,'=',{panelRegion:teamspace.PanelRegion.modal,panelType:teamspace.PanelType.engagementSurfaceCarousel}),__WRAPPED_set(t,o.EngagementSurface.Activity,'=',{panelRegion:teamspace.PanelRegion.main,panelType:teamspace.PanelType.engagementSurfaceActivity}),t);this.sendPanelView(e,__WRAPPED_get(n,e.surface).panelType,__WRAPPED_get(n,e.surface).panelRegion);}},e.prototype.sendElapsedPanelView=function(e,t){this.sendPanelView(e,teamspace.PanelType.elapsedEngagementSurface,teamspace.PanelRegion.main,{elapsedMs:Date.now()-t});},e.prototype.sendPanelView=function(e,t,n,r){this.analyticsService.sendPanelView({panel:{launchMethod:__WRAPPED_get(teamspace.components.LaunchMethod,teamspace.components.LaunchMethod.direct),previousUri:void 0,previousUriParams:void 0,region:__WRAPPED_get(teamspace.PanelRegion,n||teamspace.PanelRegion.main),uri:this.$state.current.name,uriParams:this.loggingService.hashUriParamsPII(this.$state.params),viewId:this.utilityService.generateUUID(),type:__WRAPPED_get(teamspace.PanelType,t)},dataBag:a({id:e.id,treatment:e.treatment,isControlGroup:e.isControlGroup,pseudo:!0},r)});},e.onDemandSurfaceEcsMap=(r={},__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.CortanaConsentModal,'=',teamspace.Constants.Instance.settings.names.cortanaConsentModal),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.CustomerFeedbackBpsCoachmark,'=',teamspace.Constants.Instance.settings.names.customerFeedbackBpsCoachmark),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.CustomerFeedbackCfpsCoachmark,'=',teamspace.Constants.Instance.settings.names.customerFeedbackCfpsCoachmark),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.CustomerFeedbackChatFpsCoachmark,'=',teamspace.Constants.Instance.settings.names.customerFeedbackChatFpsCoachmark),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.CustomerFeedbackMfpsCoachmark,'=',teamspace.Constants.Instance.settings.names.customerFeedbackMfpsCoachmark),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.CustomerFeedbackNlqsCoachmark,'=',teamspace.Constants.Instance.settings.names.customerFeedbackNlqsCoachmark),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.CustomerFeedbackNpsCoachmark,'=',teamspace.Constants.Instance.settings.names.customerFeedbackNpsCoachmark),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.CustomerFeedbackSuiteNpsCoachmark,'=',teamspace.Constants.Instance.settings.names.customerFeedbackSuiteNpsCoachmark),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.DefaultFrePromptCards,'=',teamspace.Constants.Instance.settings.names.defaultFrePromptCards),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.ExternalCortanaConsentModal,'=',teamspace.Constants.Instance.settings.names.externalCortanaConsentModal),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreInviteMembersDialogV2,'=',teamspace.Constants.Instance.settings.names.freemiumFreInviteMembersDialogV2),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreOneClickJoinCoachmark,'=',teamspace.Constants.Instance.settings.names.freemiumFreOneClickJoinCoachmark),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreQuickGuideSurface,'=',teamspace.Constants.Instance.settings.names.freemiumFreQuickGuideSurface),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreQuickGuideSurfaceV2,'=',teamspace.Constants.Instance.settings.names.freemiumFreQuickGuideSurfaceV2),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreSweepCardSurface,'=',teamspace.Constants.Instance.settings.names.freemiumFreSweepCardSurface),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreSweepCardWithReadyCardSurface,'=',teamspace.Constants.Instance.settings.names.freemiumFreSweepCardWithReadyCardSurface),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreSweepCardWithVideoSurface,'=',teamspace.Constants.Instance.settings.names.freemiumFreSweepCardWithVideoSurface),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreVideoCoachmark,'=',teamspace.Constants.Instance.settings.names.freemiumFreVideoCoachmark),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumInviteMembersDialogFre,'=',teamspace.Constants.Instance.settings.names.freemiumInviteMembersDialogFre),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumJoinByUrlDialogFre,'=',teamspace.Constants.Instance.settings.names.freemiumJoinByUrlDialogFre),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumUpdateProfileDialogFre,'=',teamspace.Constants.Instance.settings.names.freemiumUpdateProfileDialogFre),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumUpdateProfileDialogFreV2,'=',teamspace.Constants.Instance.settings.names.freemiumUpdateProfileDialogFreV2),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.LongCortanaConsentModal,'=',teamspace.Constants.Instance.settings.names.longCortanaConsentModal),__WRAPPED_set(r,teamspace.services.engagementSurfaces.OnDemandSurface.PromoteMobileDownloadModal,'=',teamspace.Constants.Instance.settings.names.promoteMobileDownloadModal),r),e;}());t.EsDisplayManager=s,angular.module("teamspace.esDisplayManager",["teamspace.constants","teamspace.esRepository","teamspace.loggingService","teamspace.settingsService","teamspace.analyticsService","teamspace.esTriggers","teamspace.esSurfaceStack","teamspace.esBannerService","teamspace.esHelpBotService","teamspace.esCarouselService","teamspace.esCoachmarkService","teamspace.esQuickGuideService","teamspace.esActionHandler","teamspace.esFetchDataHandler","teamspace.esParser","teamspace.firstRunService","teamspace.esMenuService","teamspace.esActivityService"]).service("esDisplayManager",s);},2517:function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=__WRAPPED_get(arguments,t).length;for(var r=Array(e),a=0,t=0;t<n;t++)for(var i=__WRAPPED_get(arguments,t),o=0,s=i.length;o<s;o++,a++)__WRAPPED_set(r,a,'=',__WRAPPED_get(i,o));return r;};Object.defineProperty(t,"__esModule",{value:!0});var a=n(9),i=(function(){function e(e,t,n,r,a,i,o,s,c,u,l,p,g,h,d,f,m,v){this.$rootScope=e,this.$q=t,this.$timeout=n,this.$interval=r,this.esRepository=a,this.esTriggers=i,this.esParser=o,this.esDisplayManager=s,this.constants=u,this.loggingService=l,this.appStateService=p,this.settingsService=g,this.firstRunService=d,this.eventingService=f,this.esParseService=m,this.ecsFoundation=v,this.TEAMS_ESP_CONFIG_NAMESPACE="TeamsESPConfigs",this._syncCount=0,this.haveUserSeenNonFreSurface=!1,this._numOfPendingFirstRunSurfaces=0,this._configContainsFirstRunSurfaces=!1,this._enqueuedFirstRunSurface=!1,this._firstRunFired=!1,this._subscriptionComplete=!1,this.logger=c.newLogger("EsEngine"),this.initializeOnAppLaunchAndReinit(),h.registerForMtma(this);}return e.$inject=["$rootScope","$q","$timeout","$interval","esRepository","esTriggers","esParser","esDisplayManager","esLogger","constants","loggingService","appStateService","settingsService","orchestrationService","firstRunService","eventingService","esParseService","ecsFoundation"],e.prototype.cleanupOnAppTeardown=function(){this.resetFirstRunState(),this.config=void 0,this._hasStarted=!1,this._syncCount=0,this.esTriggers.clear(),this.initialConfigSyncDeferred=void 0,this.esDisplayManager.initialize(this.config),this.haveUserSeenNonFreSurface=!1;},e.prototype.initializeOnAppLaunchAndReinit=function(){var e=this;this.initialConfigSyncDeferred=this.$q.defer(),this.eventingService.$onWithTenantScope(this.$rootScope,this.constants.events.engagementSurfaces.onAction,function(t,n){e.config&&(e.config.userState.completedActions=_.uniq(r(e.config.userState.completedActions,n)));});},e.prototype.mtmaTelemetryIdentifier=function(){return"EsEngine";},e.prototype.getEspState=function(){return this._subscriptionComplete?this.esRepository.getEspState().then(function(e){return e;}):this.$q.reject();},e.prototype.updateSurfaceAsDisplayedOrEligible=function(e,t){return this.esRepository.updateSurfacesState(e,t).then(function(e){return e;});},e.prototype.onFirstRunFired=function(){return this._firstRunFired=!0,this.checkFirstRun(),this.$q.resolve();},e.prototype.resetFirstRunState=function(){this._numOfPendingFirstRunSurfaces=0,this._configContainsFirstRunSurfaces=!1,this._enqueuedFirstRunSurface=!1,this._firstRunFired=!1,this._subscriptionComplete=!1;},e.prototype.startUp=function(){var e=this;this._hasStarted||(this._hasStarted=!0,this.logger.info("starting up the engagement surface engine"),this.settingsService.valueAsBoolean(this.constants.settings.names.enableESPConfigFetching)&&(this.ecsFoundation.addNamespaceToFetch(this.TEAMS_ESP_CONFIG_NAMESPACE,null),this.ecsFoundation.onFetchCompleted(function(){e.esRepository.loadEcsPayloadOnSettingsUpdate(e.ecsFoundation.getEcsPayload());})),this.syncConfig(),this.$timeout(function(){e.shouldSyncDaily()&&e.syncConfig(),e.$interval(function(){e.shouldSyncDaily()&&e.syncConfig();},e.constants.timeInMiliseconds.day,0,!1);},this.getMillisecondsUntilTomorrowBetween1amAnd4am(),!1));},e.prototype.getUserCompletedActions=function(){var e=this;return this.initialConfigSyncDeferred.promise.then(function(){return _.cloneDeep(e.config.userState.completedActions);});},e.prototype.syncConfig=function(){var e=this;this._syncCount++,this.logger.info("syncing the engagement surface config");var t=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.startUp);this.resetFirstRunState(),this.esTriggers.clear(),this.esTriggers.subscribe(a.Trigger.FirstRun,void 0,void 0,function(){return e.onFirstRunFired();}),this._syncCount>1&&this.eventingService.$emit(this.constants.events.fre.evaluate),this.esRepository.getConfig().then(function(n){n||(t.stop({message:"no engagement surfaces defined"}),e.logger.warn("no engagement surfaces defined"),n={engagementSurfaces:[]}),e.config=n,e.initialConfigSyncDeferred.resolve(),e.logger.info("engagement surface configuration retrieved"),e.esDisplayManager.initialize(n);var r=[];e.haveUserSeenNonFreSurface=n.engagementSurfaces.some(function(e){return e.trigger!==a.Trigger.FirstRun&&e.displayed.length>0;}),n.engagementSurfaces.filter(function(e){return-1===e.recur||e.displayed.length<e.recur;}).forEach(function(t){if(!t.id||_.isUndefined(t.trigger)||_.isUndefined(t.surface)){o="invalid es config. id="+t.id+" trigger="+t.trigger+" surface="+__WRAPPED_get(a.EngagementSurface,t.surface);return r.push(o),void e.logger.error(o);}if(!e.haveUserSeenNonFreSurface||t.trigger!==a.Trigger.FirstRun)try{var i=e.esParser.parse(t.condition,n.engagementSurfaces);e.esTriggers.subscribe(t.trigger,t.triggerFilter,e.esParseService,function(r){return e.handleTriggerFire(t,n.userState,i,r);},t.delayInSeconds),t.trigger===a.Trigger.FirstRun&&e._numOfPendingFirstRunSurfaces++;}catch(n){var o="failed to parse ["+t.condition.toString()+"] or ["+t.triggerFilter.toString()+"]. "+n.message;r.push(o),e.logger.error(o);}}),e._subscriptionComplete=!0,e._configContainsFirstRunSurfaces=!e.haveUserSeenNonFreSurface&&e._numOfPendingFirstRunSurfaces>0,e.checkFirstRun(),r.length?t.fail({message:r.join(",")}):t.stop();}).catch(function(n){e.appStateService.isConnected?t.fail({message:"failed to retrieve configuration",statusCode:(n||{}).statusCode}):t.incomplete({message:"failed to retrieve configuration - app is not connected",statusCode:(n||{}).statusCode});});},e.prototype.onFirstRunWithNoSurfaces=function(){var e=this;if(this.haveUserSeenNonFreSurface)return this.logger.info("FirstRun triggered but user already saw non FRE surfaces! Not Displaying default FRE experience."),void this.setFreComplete();this.esRepository.hasSurfaceDisplayed(this.constants.settings.names.defaultFrePromptCards).then(function(t){t||(e.logger.error("FirstRun triggered with no applicable surfaces! Displaying default FRE experience."),e.showDefaultFRE());}).catch(function(t){e.logger.error("Failed to find if default FRE experience was displayed before."),e.logger.error("FirstRun triggered with no applicable surfaces! Displaying default FRE experience."),e.showDefaultFRE();});},e.prototype.showDefaultFRE=function(){var e=this;if(this.settingsService.valueAsBoolean(this.constants.settings.names.disableESPDefaultFRESurfaces))this.setFreComplete();else{var t=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.defaultFreFallback);this.esDisplayManager.display(teamspace.services.engagementSurfaces.OnDemandSurface.DefaultFrePromptCards,t).then(function(){e.setFreComplete();});}},e.prototype.setFreComplete=function(){this.firstRunService.setFreComplete(),this.esTriggers.onFirstRunComplete();},e.prototype.checkFirstRun=function(){this._firstRunFired&&this._subscriptionComplete&&(this._configContainsFirstRunSurfaces||this.onFirstRunWithNoSurfaces());},e.prototype.shouldSyncDaily=function(){return!this.settingsService.valueAsBoolean(this.constants.settings.names.disableEngagementSurfacesDailySync);},e.prototype.handleTriggerFire=function(e,t,n,r){var i=this,o="handling trigger "+__WRAPPED_get(a.Trigger,e.trigger)+" with condition "+e.condition+" for id="+e.id+" "+e.treatment;return this.logger.info(o),this.esRepository.getEcsSurfaceConfigurations().then(function(s){var c=e.trigger==a.Trigger.FirstRun;c&&i._numOfPendingFirstRunSurfaces--,s=s||[];var u=_.find(s,function(t){return t.id===e.id;});if(u){var l=moment(),p=u.startTime&&moment(new Date(u.startTime)),g=u.endTime&&moment(new Date(u.endTime));if(p&&l.isBefore(p))i.logger.warn(e.id+" will not display. now ("+l.toISOString()+") is before the configured start time of "+u.startTime);else if(g&&l.isAfter(g))i.logger.warn(e.id+" will not display. now ("+l.toISOString()+") is after the configured end time of "+u.endTime);else{if(n.invoke(t)){c&&(i._enqueuedFirstRunSurface=!0);var h=i.loggingService.newScenario(i.constants.scenarios.onboarding.engagementSurfaces.handleTriggerFire,null,null,i.constants.timeInMiliseconds.hour);return h.eventData={intent:o},i.esDisplayManager.enqueue(e,h,r);}var d=e.id+" not shown: condition not satisfied";i.logger.info(d),c&&0===i._numOfPendingFirstRunSurfaces&&!i._enqueuedFirstRunSurface&&i.onFirstRunWithNoSurfaces();}}else i.logger.warn(e.id+" no longer found in ECS configuration - will not display");});},e.prototype.getMillisecondsUntilTomorrowBetween1amAnd4am=function(){var e=moment(new Date()),t=moment(new Date()).add(1,this.constants.momentjs.unitOfTime.days);return t.hour(1),t.minute(0),t.second(0),t.millisecond(0),t.diff(e)+Math.ceil(3*this.constants.timeInMiliseconds.hour*Math.random());},e;}());t.EsEngine=i,angular.module("teamspace.esEngine",["teamspace.esRepository","teamspace.esTriggers","teamspace.esParser","teamspace.esDisplayManager","teamspace.constants","teamspace.loggingService","teamspace.appState","teamspace.settingsService","teamspace.esLogger","teamspace.orchestrationService","teamspace.firstRunService","teamspace.eventingService","teamspace.esParseService","teamspace.ecsFoundation"]).service("esEngine",i);},2518:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.$q=e,this.helpBotService=t,this.proactiveMessageService=n;}return e.$inject=["$q","helpBotService","proactiveMessageService"],e.prototype.invokeMessage=function(e,t,n){var r=this,a=e.params,i=a.messageId,o=a.action;return this.helpBotService.initialize().then(function(){return r.proactiveMessageService.postProactiveMessage(a);}).then(function(){return t.stop();}).catch(function(e){var n=e.errorCode,a=e.statusCode,s="Failed to post proactive message with messageId:"+i+" action: "+o;return t.fail({errorMessage:s,errorCode:n,statusCode:a}),r.$q.reject({errorMessage:s});});},e;}());t.EsHelpBotService=r,angular.module("teamspace.esHelpBotService",["teamspace.loggingService","teamspace.constants","teamspace.helpBotService","teamspace.proactiveMessageService"]).service("esHelpBotService",r);},2519:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.constants=e,this.settingsService=t,this.localizationService=n;}return e.$inject=["constants","settingsService","localizationService"],e.prototype.isUserInAffectedGeo=function(){var e=this.localizationService.getCountryCode(),t=this.settingsService.valueFor(this.constants.settings.names.particularEventAffectedCountries);return!!(e&&t&&t.length>0)&&void 0!=t.find(function(t){return t.toLowerCase()===e.toLowerCase();});},e;}());t.EsLocationAffiliationService=r,angular.module("teamspace.esLocationAffiliationService",["teamspace.constants","teamspace.settingsService","teamspace.localizationService"]).service("esLocationAffiliationService",r);},2520:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=__WRAPPED_get(arguments,n);for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&__WRAPPED_set(e,a,'=',__WRAPPED_get(t,a));}return e;}).apply(this,arguments);};Object.defineProperty(t,"__esModule",{value:!0});var a=n(9),i=(function(){function e(e,t,n,r,a,i,o,s,c,u,l,p,g,h,d,f){this.$window=e,this.$rootScope=t,this.$q=n,this.utilityService=r,this.constants=a,this.coachmarksService=i,this.esActionHandler=o,this.esSurfaceStack=s,this.esTranslate=c,this.esParser=u,this.$sce=p,this.resources=g,this.analyticsService=h,this.eventingService=d,this.ariaLiveService=f,this.logger=l.newLogger("EsMenuService");}return e.$inject=["$window","$rootScope","$q","utilityService","constants","coachmarksService","esActionHandler","esSurfaceStack","esTranslate","esParser","esLogger","$sce","resources","analyticsService","eventingService","ariaLiveService"],e.prototype.isMenuInProgress=function(e,t,n){if(e.surface!==a.EngagementSurface.Menu)return!1;if(!e.displayed.length)return!1;var r=e.params,i=e.id,o=e.treatment,s=this.getTasks(i,o,r,n,t);if(!s||0===s.length)return!1;var c=s.filter(function(e){return e.isComplete;}).length;return c>0&&c<s.length;},e.prototype.isMenuComplete=function(e,t,n){if(e.surface!==a.EngagementSurface.Menu)return!1;var r=e.params,i=e.id,o=e.treatment,s=this.getTasks(i,o,r,n,t);return!_.some(s,function(e){return!e.isComplete;});},e.prototype.displayMenu=function(e,t,n,a){var i=this,o=e.params,s=e.id,c=e.treatment,u=this.getElementAndPlacement(o),l=u.element,p=u.placement,g=this.getImage(o,n),h=this.getTasks(s,c,o,a,n);if(!h)return this.$q.reject();var d=h.filter(function(e){return e.isComplete;}).map(function(e){return e.associatedAction;}).join(),f=this.esTranslate.instant(o.resxKey,r(r({},o.resxParams||{}),{numTasks:h.length,numCompletedTasks:h.filter(function(e){return e.isComplete;}).length}),n),m=function(){i.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc);},v=function(e){var t=e.which||e.keyCode;if(t===i.constants.keyCodes.escape&&(m(),e.stopPropagation()),e.ctrlKey&&t===i.constants.keyCodes.m){var n=i.utilityService.stripHtml(f);i.ariaLiveService.update(n,!0),_.defer(function(){return $(".task-items button.menu-item:first").focus();}),e.stopPropagation();}},y=[];return this.coachmarksService.showAdHocCoachmark({element:l,placement:p,className:o.className,viewport:o.viewport,containedIn:o.containedIn,isSticky:o.isSticky,showStickyClose:o.showStickyClose,autoCloseInSeconds:o.autoCloseInSeconds,hideArrow:o.hideArrow,appendTo:o.appendTo,content:this.$sce.trustAsHtml(f),panelType:teamspace.PanelType.engagementSurfaceMenu,img:g,taskInfo:{tasks:h},trackData:{id:s,treatment:c,state:d},onClose:function(){return i.esSurfaceStack.setCurrentAction(i.constants.growth.engagementSurfaces.actionKey.xClose);},onTimeout:function(){return i.onTimeout(s,c);}},t).then(function(e){if(!e)return i.$q.reject();},function(e){return i.$q.reject(e);},function(){i.$window.addEventListener("keydown",v,!0),y=[i.eventingService.$on(i.$rootScope,i.constants.events.engagementSurfaces.killActive,function(){return m();}),function(){return i.$window.removeEventListener("keydown",v,!0);}],i.ariaLiveService.update(i.esTranslate.instant(i.resources.strings.esp_menu_surface_aria_announcement),!1);}).finally(function(){return y.forEach(function(e){return e();});});},e.prototype.getElementAndPlacement=function(e){var t=e.element,n=e.placement,r=0;return _.isArray(t)&&(t=_.find(t,function(e){return $(e).is(":visible");})||_.first(t),r=_.indexOf(e.element,t)),_.isArray(n)&&(n=__WRAPPED_get(n,r)),{element:t,placement:n};},e.prototype.getImage=function(e,t){var n=e.img||{src:void 0};return{src:n.src,altResxKey:n.altResxKey,headerContent:n.headerResxKey&&this.$sce.trustAsHtml(this.esTranslate.instant(n.headerResxKey,n.headerResxParams,t))};},e.prototype.getTasks=function(e,t,n,r,a){var i=this;n.tasks=n.tasks||[];var o=Math.max(n.minTasks||1,1),s=Math.max(n.maxTasks||n.tasks.length,o),c=n.tasks.filter(function(e){var t=_.trim(e.condition)||""+!0;return i.esParser.parse(t,r.engagementSurfaces).invoke(r.userState);}).slice(0,s);if(!(c.length<o))return this.convertTasks(e,t,c,r.userState,a);this.logger.warn("not showing "+e+" due to insufficient number of applicable tasks, tasks="+c.length+" min="+o+" max="+s);},e.prototype.convertTasks=function(e,t,n,i,o){var s=this,c=this.constants.growth.engagementSurfaces.actionKey.displaySurface.name,u={id:e,treatment:t,close:function(){}};return n.map(function(t,n){return{isComplete:i.completedActions.some(function(e){return __WRAPPED_get(a.EngagementSurfaceAction,t.associatedAction)===e;}),associatedAction:t.associatedAction,content:s.$sce.trustAsHtml(s.esTranslate.instant(t.resxKey,t.resxParams,o)),trackData:{currIndex:n,actionKey:s.esActionHandler.parseActionKey(t.actionKey).key},onClick:function(){s.esSurfaceStack.setCurrentAction(t.actionKey);var n=s.eventingService.$on(s.$rootScope,s.constants.events.engagementSurfaces.onAction,function(e,n){n.some(function(e){return __WRAPPED_get(a.EngagementSurfaceAction,t.associatedAction)===e;})&&s.eventingService.$emit(s.constants.events.engagementSurfaces.killActive);});s.esActionHandler.handleAction(t.actionKey,u,o).finally(function(){return n();}).finally(function(){return s.esActionHandler.handleAction(c+"('"+e+"')",r(r({},u),{id:""}),o);});}};});},e.prototype.onTimeout=function(e,t){var n=this,r={panelType:teamspace.PanelType.engagementSurfaceMenu,dataBag:{id:e,treatment:t,actionKey:this.constants.growth.engagementSurfaces.actionKey.timeout}};_.defer(function(){return n.analyticsService.sendPseudoPanelView(r);}),this.esSurfaceStack.setCurrentAction(this.constants.growth.engagementSurfaces.actionKey.timeout);},e;}());t.EsMenuService=i,angular.module("teamspace.esMenuService",["teamspace.esTranslate","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.coachmarksService","teamspace.analyticsService","teamspace.esLogger","teamspace.esParser","teamspace.eventingService","teamspace.ariaLiveService","teamspace.utilityService","teamspace.locales"]).service("esMenuService",i);},2521:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(){var e=this;this.debouncedOnResize=_.debounce(function(t){return e.hoistTargets(t.data.config);},100);}return e.prototype.init=function(e){this.removeBottomOverlay(),this.bottomOverlay=$("<div>",{id:"es-bottom-overlay"}).addClass("es-overlay-full").addClass("es-overlay-bottom"),!e.hideDisabledOverlay&&this.bottomOverlay.addClass("es-overlay-full-semiopaque"),_.isFunction(e.onOverlayClick)&&this.bottomOverlay.on("click",function(){return e.onOverlayClick();}),$("body").append(this.bottomOverlay);},e.prototype.next=function(e){$(window).off("resize",this.debouncedOnResize),this.hoistTargets(e),$(window).on("resize",{config:e},this.debouncedOnResize);},e.prototype.hide=function(){$(window).off("resize",this.debouncedOnResize),this.demoteTargets(),this.removeBottomOverlay();},e.prototype.removeBottomOverlay=function(){this.bottomOverlay&&this.bottomOverlay.remove(),this.bottomOverlay=null;},e.prototype.hoistTargets=function(e){if(this.demoteTargets(),this.primaryTarget=$(e.targetSelector),this.primaryTarget.length&&(this.primaryTarget.parents().addClass("es-overlay-target-parents-zfix"),this.primaryTarget=this.primaryTarget.first(),this.primaryTarget.is(":visible"))){this.primaryTarget.addClass("es-overlay-primary-target"),this.addRelativePositionIfNecessary(this.primaryTarget),this.primaryOverlay=$("<div>",{id:"es-top-overlay"}).addClass("es-overlay-top"),e.hideDisabledTargetOverlay||(this.primaryOverlay.addClass("es-overlay-primary-semiopaque"),this.primaryOverlay.css("background-color",this.findNearestBackgroundColor(this.primaryTarget))),e.allowTargetInteraction&&this.primaryOverlay.css("z-index",-1),_.isFunction(e.onTargetOverlayClick)&&this.primaryOverlay.on("click",function(){return e.onTargetOverlayClick();});var t=this.findNearestBackgroundColor(this.primaryTarget);if(t&&$("<style>").text(".es-overlay-primary-target { background-color: "+t+" }").appendTo(this.primaryOverlay),this.affixToTargetPosition(this.primaryOverlay,this.primaryTarget),this.primaryTarget.append(this.primaryOverlay),e.focusSelector&&(!(this.secondaryTarget=$(e.focusSelector))||this.secondaryTarget.length)&&(this.secondaryTarget=this.secondaryTarget.first(),this.secondaryTarget.is(":visible"))){this.secondaryTarget.addClass("es-overlay-secondary-target"),this.addRelativePositionIfNecessary(this.secondaryTarget),this.highlightBorder=$("<div>",{id:"es-highlight-border"}).addClass("es-overlay-highlight").addClass("shadow-level-3");var n=e.focusBorderPadding||{vertical:0,horizontal:0};0===n.vertical&&0===n.horizontal||(this.secondaryOverlay=$("<div>").addClass("es-overlay-secondary-overlay"),_.isFunction(e.onTargetOverlayClick)&&this.secondaryOverlay.on("click",function(){return e.onTargetOverlayClick();}),this.affixToTargetPosition(this.secondaryOverlay,this.secondaryTarget),$("body").append(this.secondaryOverlay)),this.affixToTargetPosition(this.highlightBorder,this.secondaryTarget,n.vertical,n.horizontal),$("body").append(this.highlightBorder);}}},e.prototype.demoteTargets=function(){this.primaryOverlay&&this.primaryOverlay.remove(),this.highlightBorder&&this.highlightBorder.remove(),this.secondaryOverlay&&this.secondaryOverlay.remove(),this.primaryTarget&&this.primaryTarget.removeClass("es-overlay-primary-target"),this.primaryTarget&&this.primaryTarget.parents().removeClass("es-overlay-target-parents-zfix"),this.secondaryTarget&&this.secondaryTarget.removeClass("es-overlay-secondary-target"),this.primaryTarget=this.secondaryTarget=this.primaryOverlay=this.highlightBorder=this.secondaryOverlay=null;},e.prototype.affixToTargetPosition=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var a=t.offset()||{top:0,left:0};e.css({position:"fixed",height:t.outerHeight()-2*n,width:t.outerWidth()-2*r,top:a.top+n,left:a.left+r});},e.prototype.addRelativePositionIfNecessary=function(e){var t=e.css("position");_.includes(["absolute","relative","fixed"],t)||e.addClass("es-overlay-relative");},e.prototype.findNearestBackgroundColor=function(e){for(var t=void 0;!t&&e&&!e.first().is(":root");){var n=(e=e.first()).css("background-color");n&&"rgba(0, 0, 0, 0)"!==n&&(t=n),e=e.parent();}return t;},e;}());t.EsOverlayService=r,angular.module("teamspace.esOverlayService",[]).service("esOverlayService",r);},2522:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),a=(function(){function e(e,t){this.id=e,this.parent=t;}return e.prototype.isCyclic=function(e){return!(!e||this.id!==e)||!!this.parent&&this.parent.isCyclic(e||this.id);},e.prototype.toString=function(){return this.parent?this.parent.toString()+" -> "+this.id:this.id;},e;}()),i=(function(){function e(e,t,n,r,a,i,o,s,c,u,l){this.esParseService=e,this.esSurfaceStack=t,this.constants=r,this.platformDetectService=a,this.desktopUtilityService=i,this.desktopHandlingService=o,this.aggregatedSettingsStore=s,this.settingsService=c,this.myUserPreferencesStore=u,this.$state=l,this.logger=n.newLogger("EsParser");}return e.$inject=["esParseService","esSurfaceStack","esLogger","constants","platformDetectService","desktopUtilityService","desktopHandlingService","aggregatedSettingsStore","settingsService","myUserPreferencesStore","$state"],e.prototype.parse=function(e,t){var n=this,i=/{\s*\$(\S+)\s*}/g,o=e.toString(),s=function(e,r){return e.replace(i,function(e,i){var o=_.find(t,function(e){return e.id===i;}),c=new a(i,r);return o?c.isCyclic()?(n.logger.error("Cycle found in condition references: "+c.toString()+"!"),"(false)"):s("("+o.condition.toString()+")",c):(n.logger.error("Unknown condition reference to surface id = "+i+"!"),"(false)");});};o=s(o);var c=this.esParseService.parse(o);return{invoke:function(e){var t=$("head"),a={moment:moment,user:_.clone(e),surfaces:n.esSurfaceStack.getSurfaceState(),now:moment(),os:{name:n.platformDetectService.getOS(),version:n.platformDetectService.getOSVersion(),supportsDesktopApp:n.platformDetectService.osSupportsDesktopApp()},client:{isDesktopAppInstalled:n.desktopHandlingService.getIsAppInstalled(),type:n.getClientType(),window:{width:window.innerWidth,height:window.innerHeight},theme:n.settingsService.getActiveTheme(),version:moment(t.data(n.constants.dataNames.versionDate)),build:moment(t.data(n.constants.dataNames.buildDate))},ecs:{moment:function(e){return moment(n.settingsService.valueFor(e));},boolean:function(e){return n.settingsService.valueAsBoolean(e);},value:function(e){return n.settingsService.valueFor(e);}},route:{stateName:_.cloneDeep(n.$state.current&&n.$state.current.name),params:_.cloneDeep(n.$state.params)},userAgent:navigator.userAgent,browser:{name:n.platformDetectService.getBrowser(),version:n.platformDetectService.getBrowserVersion()},hardware:{isAppleSilicon:n.desktopUtilityService.isAppleSilicon(),cpuArchitecture:n.desktopUtilityService.getCpuArchitecture()}};t=null,a.user.firstWebLogin=e.firstWebLogin.clone(),a.user.settings=n.aggregatedSettingsStore.getSettings(),a.user.firstLoginInfo={};var i=_.clone(n.myUserPreferencesStore.getUserPreferences().firstLoginInformation||{});return Object.keys(i).forEach(function(e){var t=__WRAPPED_get(i,e);t&&moment(t).isValid()&&__WRAPPED_set(a.user.firstLoginInfo,e,'=',moment(t));}),(e.completedActions||[]).forEach(function(e){var t=__WRAPPED_get(r.EngagementSurfaceAction,e),n=t.replace(/^\s*(.)/,function(e,t){return t.toLowerCase();});__WRAPPED_set(a.user,t,'=',__WRAPPED_set(a.user,n,'=',!0));}),!!c.evaluate(a);}};},e.prototype.evaluateExpressions=function(e,t){var n=this,r={};return Object.keys(e).forEach(function(a){var i=__WRAPPED_get(e,a);if(_.isNumber(i)&&(i=i.toString()),_.isString(i)){try{i=n.esParseService.parse(i);}catch(e){var o="failed to parse ["+i+"] in resx parameters. "+e.message;n.logger.error(o),i={evaluate:function(){}};}__WRAPPED_set(e,a,'=',i);}__WRAPPED_set(r,a,'=',i.evaluate(t));}),r;},e.prototype.evaluateExpression=function(e,t){var n;try{n=this.esParseService.parse(e).evaluate(t);}catch(t){var r="failed to parse ["+e+"] in parameter expression. "+t.message;this.logger.error(r);}return n;},e.prototype.parseFnCall=function(e){void 0===e&&(e="");var t=[e.indexOf("("),e.lastIndexOf(")")],n=t[0],r=t[1],a=e.substr(0,n).trim();if(n<0&&r<0)return{fnName:e.trim(),params:[]};if(n>0&&n+1==r)return{fnName:a,params:[]};if(n<=0||r<=0||n>r)return this.logger.error("Invalid parameter expression in "+e),{fnName:void 0,params:[]};var i=e.substring(n+1,r).trim();return 0==i.length?{fnName:a,params:[]}:{fnName:a,params:this.splitTerms(i).map(function(e){return e.trim()||"undefined";})};},e.prototype.getClientType=function(){return this.desktopUtilityService.isSurfaceHubUwp()?"surfaceHub":__WRAPPED_get(teamspace.services.ClientType,this.desktopUtilityService.getClientType());},e.prototype.splitTerms=function(e){var t={"(":")","[":"]","{":"}",'"':'"',"'":"'"},n=[],r=[],a=null,i=[];return(e||"").split("").forEach(function(e){void 0!=__WRAPPED_get(t,e)&&(a=__WRAPPED_get(t,e),r.push(a)),e===a&&(r.pop(),a=r.length>0?r[r.length-1]:null),null===a&&","===e?(n.push(i.join("")),i=[]):i.push(e);}),(i.length>0||","===e[e.length-1])&&n.push(i.join("")),n;},e;}());t.EsParser=i,angular.module("teamspace.esParser",["teamspace.constants","teamspace.loggingService","teamspace.esSurfaceStack","teamspace.esLogger","teamspace.platformDetectService","teamspace.desktopUtilityService","teamspace.desktopHandlingService","skypeX.aggregatedSettingsStore","teamspace.settingsService","teamspace.esParseService"]).service("esParser",i);},2523:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2524),a=(function(){function e(e){this.$parse=e;}return e.prototype.parse=function(e){var t=this.$parse(e);return{evaluate:function(e){return t(e);}};},e;}());t.EsAngularParseService=a;var i=(function(){function e(e){this.binaryOps={"||":function(e,t){return e||t;},"&&":function(e,t){return e&&t;},"|":function(e,t){return e|t;},"^":function(e,t){return e^t;},"&":function(e,t){return e&t;},"==":function(e,t){return e==t;},"!=":function(e,t){return e!=t;},"===":function(e,t){return e===t;},"!==":function(e,t){return e!==t;},"<":function(e,t){return e<t;},">":function(e,t){return e>t;},"<=":function(e,t){return e<=t;},">=":function(e,t){return e>=t;},"<<":function(e,t){return e<<t;},">>":function(e,t){return e>>t;},">>>":function(e,t){return e>>>t;},"+":function(e,t){return e+t;},"-":function(e,t){return e-t;},"*":function(e,t){return e*t;},"/":function(e,t){return e/t;},"%":function(e,t){return e%t;}},this.unaryOps={"-":function(e){return-e;},"+":function(e){return e;},"~":function(e){return~e;},"!":function(e){return!e;}},this.logger=e.newLogger("EsParseService");}return e.prototype.parse=function(e){var t=this,n=r(e);return{evaluate:function(e){return t.evaluateExpression(n,e);}};},e.prototype.isArrayExpression=function(e){return"ArrayExpression"===e.type;},e.prototype.isBinaryExpression=function(e){return"BinaryExpression"===e.type;},e.prototype.isCallExpression=function(e){return"CallExpression"===e.type;},e.prototype.isCompound=function(e){return"Compound"===e.type;},e.prototype.isConditionalExpression=function(e){return"ConditionalExpression"===e.type;},e.prototype.isIdentifier=function(e){return"Identifier"===e.type;},e.prototype.isLiteral=function(e){return"Literal"===e.type;},e.prototype.isLogicalExpression=function(e){return"LogicalExpression"===e.type;},e.prototype.isMemberExpression=function(e){return"MemberExpression"===e.type;},e.prototype.isThisExpression=function(e){return"ThisExpression"===e.type;},e.prototype.isUnaryExpression=function(e){return"UnaryExpression"===e.type;},e.prototype.evaluateMemberExpression=function(e,t){var n=this.evaluateExpression(e.object,t)||{},r=void 0;if(this.isIdentifier(e.property))r=__WRAPPED_get(n,e.property.name);else{var a=this.evaluateExpression(e.property,t);"string"==typeof a||"number"==typeof a?r=__WRAPPED_get(n,a):this.logger.warn("invalid object property index type. Expected string or number, but found type "+typeof a);}return{callingContext:n,value:r};},e.prototype.evaluateExpression=function(e,t){var n=this;if(this.isCompound(e)){if(0===e.body.length)return;return this.logger.warn("Compound expression detected - only evaluating last"),this.evaluateExpression(e.body[e.body.length-1],t);}if(this.isArrayExpression(e))return e.elements.map(function(e){return n.evaluateExpression(e,t);});if(this.isBinaryExpression(e)||this.isLogicalExpression(e))return __WRAPPED_call(this.binaryOps,e.operator)(this.evaluateExpression(e.left,t),this.evaluateExpression(e.right,t));if(this.isCallExpression(e)){var r=void 0,a=void 0;if(this.isMemberExpression(e.callee)){var i=this.evaluateMemberExpression(e.callee,t);r=i.callingContext,a=i.value;}else a=this.evaluateExpression(e.callee,t);if(!_.isFunction(a))return;return a.apply(r,e.arguments.map(function(e){return n.evaluateExpression(e,t);}));}return this.isConditionalExpression(e)?this.evaluateExpression(e.test,t)?this.evaluateExpression(e.consequent,t):this.evaluateExpression(e.alternate,t):this.isIdentifier(e)?__WRAPPED_get(t,e.name):this.isLiteral(e)?e.value:this.isMemberExpression(e)?this.evaluateMemberExpression(e,t).value:this.isThisExpression(e)?t:this.isUnaryExpression(e)?__WRAPPED_call(this.unaryOps,e.operator)(this.evaluateExpression(e.argument,t)):void 0;},e;}());t.EsParseService=i,angular.module("teamspace.esParseService",["teamspace.constants","teamspace.settingsService","teamspace.esLogger"]).factory("esParseService",["$parse","esLogger","constants","settingsService",function(e,t,n,r){return r.valueAsBoolean(n.settings.names.enableAngularEspParser)?new a(e):new i(t);}]);},2524:function(e,t,n){!(function(n){"use strict";var r=function(e,t){var n=new Error(e+" at character "+t);throw n.index=t,n.description=e,n;},a={"-":!0,"!":!0,"~":!0,"+":!0},i={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},o=function(e){var t,n=0;for(var r in e)(t=r.length)>n&&e.hasOwnProperty(r)&&(n=t);return n;},s=o(a),c=o(i),u={true:!0,false:!1,null:null},l=function(e){return __WRAPPED_get(i,e)||0;},p=function(e,t,n){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:n};},g=function(e){return e>=48&&e<=57;},h=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=128&&!__WRAPPED_get(i,String.fromCharCode(e));},d=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!__WRAPPED_get(i,String.fromCharCode(e));},f=function(e){for(var t,n,o=0,f=e.charAt,m=e.charCodeAt,v=function(t){return f.call(e,t);},y=function(t){return m.call(e,t);},S=e.length,A=function(){for(var e=y(o);32===e||9===e||10===e||13===e;)e=y(++o);},C=function(){var e,t,n=b();return A(),63!==y(o)?n:(o++,(e=C())||r("Expected expression",o),A(),58===y(o)?(o++,(t=C())||r("Expected expression",o),{type:"ConditionalExpression",test:n,consequent:e,alternate:t}):void r("Expected :",o));},T=function(){A();for(var t=e.substr(o,c),n=t.length;n>0;){if(i.hasOwnProperty(t)&&(!h(y(o))||o+t.length<e.length&&!d(y(o+t.length))))return o+=n,t;t=t.substr(0,--n);}return!1;},b=function(){var e,t,n,a,i,s,c,u,g;if(s=w(),!(t=T()))return s;for(i={value:t,prec:l(t)},(c=w())||r("Expected expression after "+t,o),a=[s,i,c];(t=T())&&0!==(n=l(t));){for(i={value:t,prec:n},g=t;a.length>2&&n<=a[a.length-2].prec;)c=a.pop(),t=a.pop().value,s=a.pop(),e=p(t,s,c),a.push(e);(e=w())||r("Expected expression after "+g,o),a.push(i,e);}for(e=__WRAPPED_get(a,u=a.length-1);u>1;)e=p(a[u-1].value,a[u-2],e),u-=2;return e;},w=function(){var t,n,r;if(A(),t=y(o),g(t)||46===t)return P();if(39===t||34===t)return E();if(91===t)return D();for(r=(n=e.substr(o,s)).length;r>0;){if(a.hasOwnProperty(n)&&(!h(y(o))||o+n.length<e.length&&!d(y(o+n.length))))return o+=r,{type:"UnaryExpression",operator:n,argument:w(),prefix:!0};n=n.substr(0,--r);}return!(!h(t)&&40!==t)&&$();},P=function(){for(var e,t,n="";g(y(o));)n+=v(o++);if(46===y(o))for(n+=v(o++);g(y(o));)n+=v(o++);if("e"===(e=v(o))||"E"===e){for(n+=v(o++),"+"!==(e=v(o))&&"-"!==e||(n+=v(o++));g(y(o));)n+=v(o++);g(y(o-1))||r("Expected exponent ("+n+v(o)+")",o);}return t=y(o),h(t)?r("Variable names cannot start with a number ("+n+v(o)+")",o):46===t&&r("Unexpected period",o),{type:"Literal",value:parseFloat(n),raw:n};},E=function(){for(var e,t="",n=v(o++),a=!1;o<S;){if((e=v(o++))===n){a=!0;break;}if("\\"===e)switch(e=v(o++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e;}else t+=e;}return a||r('Unclosed quote after "'+t+'"',o),{type:"Literal",value:t,raw:n+t+n};},k=function(){var t,n=y(o),a=o;for(h(n)?o++:r("Unexpected "+v(o),o);o<S&&(n=y(o),d(n));)o++;return t=e.slice(a,o),u.hasOwnProperty(t)?{type:"Literal",value:__WRAPPED_get(u,t),raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t};},H=function(e){for(var t,n,a=[],i=!1,s=0;o<S;){if(A(),(t=y(o))===e){i=!0,o++,41===e&&s&&s>=a.length&&r("Unexpected token "+String.fromCharCode(e),o);break;}if(44===t){if(o++,++s!==a.length)if(41===e)r("Unexpected token ,",o);else if(93===e)for(var c=a.length;c<s;c++)a.push(null);}else(n=C())&&"Compound"!==n.type||r("Expected comma",o),a.push(n);}return i||r("Expected "+String.fromCharCode(e),o),a;},$=function(){var e,t;for(t=40===(e=y(o))?O():k(),A(),e=y(o);46===e||91===e||40===e;)o++,46===e?(A(),t={type:"MemberExpression",computed:!1,object:t,property:k()}):91===e?(t={type:"MemberExpression",computed:!0,object:t,property:C()},A(),93!==(e=y(o))&&r("Unclosed [",o),o++):40===e&&(t={type:"CallExpression",arguments:H(41),callee:t}),A(),e=y(o);return t;},O=function(){o++;var e=C();if(A(),41===y(o))return o++,e;r("Unclosed (",o);},D=function(){return o++,{type:"ArrayExpression",elements:H(93)};},_=[];o<S;)59===(t=y(o))||44===t?o++:(n=C())?_.push(n):o<S&&r('Unexpected "'+v(o)+'"',o);return 1===_.length?_[0]:{type:"Compound",body:_};};f.version="0.3.5",f.toString=function(){return"JavaScript Expression Parser (JSEP) v"+f.version;},f.addUnaryOp=function(e){return s=Math.max(e.length,s),__WRAPPED_set(a,e,'=',!0),this;},f.addBinaryOp=function(e,t){return c=Math.max(e.length,c),__WRAPPED_set(i,e,'=',t),this;},f.addLiteral=function(e,t){return __WRAPPED_set(u,e,'=',t),this;},f.removeUnaryOp=function(e){return delete a[e],e.length===s&&(s=o(a)),this;},f.removeAllUnaryOps=function(){return a={},s=0,this;},f.removeBinaryOp=function(e){return delete i[e],e.length===c&&(c=o(i)),this;},f.removeAllBinaryOps=function(){return i={},c=0,this;},f.removeLiteral=function(e){return delete u[e],this;},f.removeAllLiterals=function(){return u={},this;};void 0!==e&&e.exports?t=e.exports=f:t.parse=f;}());},2525:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),a=(function(){function e(e,t,n,r,a,i,o,s,c,u,l,p,g,h,d,f,m){this.$window=e,this.$rootScope=t,this.$q=n,this.$timeout=r,this.constants=a,this.esActionHandler=i,this.coachmarksService=o,this.esSurfaceStack=s,this.esTranslate=c,this.esTriggers=u,this.esOverlayService=p,this.eventingService=g,this.resources=h,this.ariaLiveService=d,this.utilityService=f,this.esParseService=m,this.logger=l.newLogger("EsQuickGuideService");}return e.$inject=["$window","$rootScope","$q","$timeout","constants","esActionHandler","coachmarksService","esSurfaceStack","esTranslate","esTriggers","esLogger","esOverlayService","eventingService","resources","ariaLiveService","utilityService","esParseService"],e.prototype.displayQuickGuide=function(e,t,n){var a=this,i=this.$q.defer(),o=e.id,s=e.treatment,c=e.params,u=c.cards||[],l=$.noop,p=$.noop,g=$.noop,h=$.noop,d=function(){_.defer(function(){return $("#coachmark-tooltip").find("[tabbable]:visible:not(.invisible):first").focus();});},f=void 0,m=function(v,y,S){if(void 0===y&&(y=!1),void 0===S&&(S=1),v!==f){if(f=v,p(),(v=Math.max(v,0))>=u.length){var A=y?a.constants.growth.engagementSurfaces.actionKey.xClose:a.constants.growth.engagementSurfaces.actionKey.completedClose;return a.esSurfaceStack.setCurrentAction(A),angular.element(".outer-shell").attr("aria-hidden","false"),a.esOverlayService.hide(),t.stop(),void i.resolve();}t.pause({reason:"showing quick guide index "+v});var C=__WRAPPED_get(u,v),T=C.preActionKeys||[],b=C.ariaKey&&a.esTranslate.instant(C.ariaKey),w=a.$q.resolve();T.forEach(function(e){w=w.finally(function(){return a.esSurfaceStack.setCurrentAction(e),a.esActionHandler.handleAction(e,{id:o,treatment:s,close:function(){}},n);});});var P=Math.max(C.delayInSeconds?C.delayInSeconds*a.constants.timeInMiliseconds.second:1,1),E=function(e){return e&&e.split(",").map(function(e){return e.trim()+":visible:first";}).join(", ");},k=E(C.focusSelector),H=E(C.targetSelector),O=k||H,D=_.isBoolean(C.hideDisabledTargetOverlay)?C.hideDisabledTargetOverlay:!!C.nextOnBiEvent,q=_.isBoolean(C.allowTargetInteraction)?C.allowTargetInteraction:!!C.nextOnBiEvent,N=_.isBoolean(C.hideProgress)?C.hideProgress:!!c.hideProgress,F=_.isBoolean(C.hideArrowNavigation)?C.hideArrowNavigation:!!C.nextOnBiEvent,M=_.isBoolean(C.preventFocusGrab)?C.preventFocusGrab:!(!C.nextOnBiEvent&&!C.allowTargetInteraction),x=C.name?e.id+"->"+C.name:e.id,L=a.esTranslate.instant(C.resxKey,C.resxParams,n);q&&k&&(a.logger.error("card ["+(C.name||v)+"] interactive target with focus selector is not allowed"),a.logger.error("card ["+(C.name||v)+"] removing focus selector to allow target to be interactive!"),k=void 0,O=H),h=function(e){var t=$(O),n=$("#coachmark-tooltip");q&&t.is(e)||t.has(e).length||n.is(e)||n.has(e).length||d();},g=function(){if(q&&M){var e=$(O),t=document.activeElement;e.has(t).length||(e.is("button, input, [tabindex]")?e.focus():e.find("button, input, [tabindex]").filter(":visible:not([disabled]):not([tabindex=-1])").filter(function(){return $(this).width()&&$(this).height();}).first().focus());}},w.then(function(){return a.$timeout(P,!1);}).then(function(){return l=function(){a.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),m(v+1);};}).then(function(){return a.esOverlayService.next({targetSelector:H,focusSelector:k,focusBorderPadding:C.focusPadding,hideDisabledTargetOverlay:D,allowTargetInteraction:q});}).then(function(){return a.logger.info("displaying card "+(C.name?x:e.id+"->"+(v+1)));}).then(function(){var e=!1;return a.coachmarksService.showAdHocCoachmark({element:O,content:L,placement:C.placement,className:C.className,containedIn:C.containedIn,panelType:teamspace.PanelType.engagementSurfaceCoachmark,allowOnPopover:c.allowOnPopover,onClose:function(){return m(u.length,!0);},quickGuideInfo:{count:u.length,current:v+1,onPrevious:function(){return m(v-1,!1,-1);},onNext:function(){return m(v+1);},hideCloseBtn:c.hideCloseBtn,hideProgress:N,hideArrowNavigation:F,preventFocusGrab:M,ariaLabel:b,showPrevBtnOnLastCard:c.showPrevBtnOnLastCard},trackData:{currIndex:v,id:x,treatment:s},img:{src:C.imageSrc}}).then(function(n){if(!n&&!e)return a.logger.warn("skipping card "+(v+1)+" as "+H+" was not visible or moved"),c.recordSkippedCard&&t.mark("skipping card "+C.resxKey),m(v+S);},function(e){return a.$q.reject(e);},function(){var t=a.utilityService.stripHtml(L);a.ariaLiveService.update(t,!0),C.nextOnBiEvent&&(p=a.esTriggers.subscribe(r.Trigger.BIEvent,C.nextOnBiEvent,a.esParseService,function(){return e=!0,a.$q.resolve(l());})),g();});}).catch(function(e){return e=e||{},a.logger.error("skipping index "+v+". Exception thrown "+e.message),c.recordSkippedCard&&t.mark("skipping card "+C.resxKey),m(v+S);}).finally(function(){return f=void 0;});}},v=function(){a.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),m(u.length);},y={hideDisabledOverlay:c.hideDisabledOverlay,onOverlayClick:function(){c.nextOnOverlayClick&&l&&l();}};angular.element(".outer-shell").attr("aria-hidden","true"),this.esOverlayService.init(y),this.ariaLiveService.update(this.esTranslate.instant(this.resources.strings.esp_quickguides_aria_anouncement),!0),m(0);var S=function(e){e.target&&h(e.target);},A=function(e){var t=e.which||e.keyCode;t===a.constants.keyCodes.escape&&(v(),e.stopPropagation()),e.ctrlKey&&e.altKey&&e.shiftKey&&t===a.constants.keyCodes.t&&g(),e.ctrlKey&&e.altKey&&e.shiftKey&&t===a.constants.keyCodes.g&&d();};this.$window.addEventListener("focus",S,!0),this.$window.addEventListener("keydown",A,!0);var C=[this.eventingService.$on(this.$rootScope,this.constants.events.engagementSurfaces.killActive,function(){return v();}),this.eventingService.$on(this.$rootScope,this.constants.events.calling.callConnecting,function(){return v();}),function(){return a.$window.removeEventListener("focus",S,!0);},function(){return a.$window.removeEventListener("keydown",A,!0);}];return i.promise.finally(function(){return C.forEach(function(e){return e();});}),i.promise;},e;}());t.EsQuickGuideService=a,angular.module("teamspace.esQuickGuideService",["teamspace.constants","teamspace.esTranslate","teamspace.coachmarksService","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.esOverlayService","teamspace.esTriggers","teamspace.eventingService","teamspace.ariaLiveService","teamspace.utilityService","teamspace.locales","teamspace.esParseService"]).service("esQuickGuideService",a);},2526:function(e,t,n){"use strict";var r=this&&this.__extends||(function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&__WRAPPED_set(e,n,'=',__WRAPPED_get(t,n));})(t,n);};return function(t,n){function r(){this.constructor=t;}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r());};}()),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=__WRAPPED_get(arguments,n);for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&__WRAPPED_set(e,a,'=',__WRAPPED_get(t,a));}return e;}).apply(this,arguments);},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=__WRAPPED_get(arguments,t).length;for(var r=Array(e),a=0,t=0;t<n;t++)for(var i=__WRAPPED_get(arguments,t),o=0,s=i.length;o<s;o++,a++)__WRAPPED_set(r,a,'=',__WRAPPED_get(i,o));return r;};Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),s=n(2527),c=n(2528),u=n(2529),l=n(2530),p=(function(){function e(e){this.expression=e;}return e.prototype.toString=function(){return this.expression;},e;}()),g=(function(e){function t(t,n,r,a,i,o,s,c,u,l,p,g,h,d,f,m,v,y,S,A,C,T,b,w,P,E,k,H,$,O,D,_,q,N,F,M,x,L,j,I){var B=e.call(this,t.middleTierConstants.newEndpointAddress,i,c,r,n,a,l,s)||this;return B.appConfig=t,B.$q=n,B.$http=r,B.$qNoApply=a,B.settingsService=i,B.loggingService=o,B.appStateService=s,B.constants=c,B.resources=u,B.authenticationService=l,B.myUserPreferencesStore=p,B.eventingService=g,B.channelService=h,B.tenantService=d,B.userAppsStore=f,B.utilityService=m,B.userResourcesSettingsStore=v,B.identityService=y,B.helpBotService=S,B.sfbTeamsUpgradeService=A,B.esSurfaceStack=C,B.esPortalComms=b,B.storageService=w,B.downloadAppService=P,B.callingService=E,B.callingSupportService=k,B.cortanaConfigurationService=H,B.firstRunService=$,B.desktopUtilityService=O,B.peopleTargetingService=D,B.esLocationAffiliationService=_,B.callingMultiWindowService=q,B.ecsFoundation=N,B.experienceContainerFeatureService=F,B.localizationService=M,B.audioConfService=x,B.ageConsentPolicySettingsStore=L,B.ageConsentPolicyService=j,B.workerDataLayerClientHandler=I,B.logger=T.newLogger("EsRepository"),B.getEngagementSurfacesDeferred=a.defer(),B;}return r(t,e),t.$inject=["appConfig","$q","$http","$qNoApply","settingsService","loggingService","appStateService","constants","resources","authenticationService","myUserPreferencesStore","eventingService","channelService","tenantService","userAppsStore","utilityService","userResourcesSettingsStore","identityService","helpBotService","sfbTeamsUpgradeService","esSurfaceStack","esLogger","esPortalComms","storageService","downloadAppService","callingService","callingSupportService","cortanaConfigurationService","firstRunService","desktopUtilityService","peopleTargetingService","esLocationAffiliationService","callingMultiWindowService","ecsFoundation","experienceContainerFeatureService","localizationService","audioConfService","ageConsentPolicySettingsStore","ageConsentPolicyService","workerDataLayerClientHandler"],Object.defineProperty(t.prototype,"enableEspDebugOverride",{get:function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableEspDebugOverride);},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableESPConfigFetching",{get:function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableESPConfigFetching);},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var e=this,n=this.settingsService.valueAsBoolean(this.constants.settings.names.enableEngagementSurfaces),r=this.settingsService.valueAsBoolean(this.constants.settings.names.enableEspInWorker),a=this.$q.resolve();return this.enableESPConfigFetching&&(a=this.initialEspConfigsloadFromEcs().then(function(){e.logger.info("Fetched ESP configuration from TeamsESPConfigs namespace");})),a.then(function(){return e.getEcsSurfaceConfigurations().then(function(a){if(!n||!a||!a.length)return e.$qNoApply.resolve(void 0);var i={retryOn:["5xx","404","429"],maxRetries:3},o=e.shouldFetchEngagementProfile();e.firstRunService.isFRESession()&&(i={retryOn:[],maxRetries:0});var s=function(t){return e.convert(t,a).then(function(t){return e.esSurfaceStack.setSurfaces(t.engagementSurfaces),t;});},c=e.getEspConfigUrl(o);return e.getEspState(r,c,i).then(function(e){return s(e);}).then(function(t){return e.syncCache(),t;}).catch(function(n){if(e.getEngagementSurfacesDeferred.reject("GET engagementSurfaces failed"),e.firstRunService.isFRESession())return e.logger.warn("GET engagementSurfaces failed for FRE user, falling back to naked implementation"),e.applyCache(t.NAKED_DTO).then(function(e){return s(e);});throw n;});});});},t.prototype.getEspState=function(e,n,r){var a=this,i=e||this.settingsService.valueAsBoolean(this.constants.settings.names.enableEspInWorker),o=this.shouldFetchEngagementProfile(),s=n||this.getEspConfigUrl(o),u=r||{retryOn:["5xx","404","429"],maxRetries:3};return this.workerDataLayerClientHandler.enabled&&i?this.toNgPromise(this.workerDataLayerClientHandler.executeWithSingleResult(c,null,"espState")).then(function(e){var t=__WRAPPED_get(e,a.constants.queries.esp.espState);return a.getEngagementSurfacesDeferred.resolve(t),t;}):this.withRetry(function(){return a.performApiGet(s,{callType:t.CALL_TYPE}).toNgPromise(a.$qNoApply).then(function(e){return a.applyCache(e);}).then(function(e){return a.getEngagementSurfacesDeferred.resolve(e),e;});},null,u.retryOn,u.maxRetries);},t.prototype.updateSurfacesState=function(e,n){var r=this,a=this.settingsService.valueAsBoolean(this.constants.settings.names.enableEspInWorker);if(this.workerDataLayerClientHandler.enabled&&a)return n?this.toNgPromise(this.workerDataLayerClientHandler.executeWithSingleResult(l,{surfaceId:e},"recordEligibleSurface")).then(function(e){return __WRAPPED_get(e,r.constants.queries.esp.recordEligibleSurface);}):this.toNgPromise(this.workerDataLayerClientHandler.executeWithSingleResult(u,{surfaceId:e},"recordDisplayedSurface")).then(function(e){return __WRAPPED_get(e,r.constants.queries.esp.recordDisplayedSurface);});var i={id:e,isControlGroup:n};return this.withRetry(function(){return r.performApiPut(t.API_ENDPOINT+"/displayed",{callType:t.CALL_TYPE},i).toNgPromise(r.$qNoApply);}).then(function(){return{id:e,displayedTimestamps:[],controlGroupTimestamps:[]};});},t.prototype.updateSurfaceAsDisplayed=function(e){return this.updateSurfaceAsDisplayedOrEligible(e,!1);},t.prototype.updateEligiblePanelViewSent=function(e){return this.updateSurfaceAsDisplayedOrEligible(e,!0);},t.prototype.resetSurfaces=function(){var e=this;return this.withRetry(function(){return e.performApiDelete(t.API_ENDPOINT,{callType:t.CALL_TYPE}).toNgPromise(e.$qNoApply);});},t.prototype.addEngagemetSurfaceActions=function(e){var n=this;if(!e||!e.length)return this.$q.resolve();this.eventingService.$emit(this.constants.events.engagementSurfaces.onAction,e);var r={items:e.map(function(e){return{action:e};})};return this.withRetry(function(){return n.performApiPut(t.API_ENDPOINT+"/actions",{callType:t.CALL_TYPE},r).toNgPromise(n.$qNoApply);}).catch(function(){var t=e.map(function(e){return __WRAPPED_get(o.EngagementSurfaceAction,e);}).join(",");n.logger.warn("failed to update engagement surface actions: "+t+". cacheing locally."),n.esCache.addActions(r);});},t.prototype.expandOnDemandSurfaceConfig=function(e,t){var n=a(a({},e),{id:t,treatment:"",trigger:"Programmatic",isSettled:!1,eligibleTimes:[],condition:"",order:0,priority:-1});return this.convertSurfaceConfig(n);},t.prototype.convertToProgrammaticSurface=function(e,t){return a(a({},e),{id:t?t+"->"+e.id:e.id,trigger:o.Trigger.Programmatic,priority:-1,order:0});},t.prototype.getRelevantContacts=function(){var e=this;return this.withRetry(function(){return e.performApiGet(t.RELEVANTCONTACTS_ENDPOINT,{callType:t.CALL_TYPE}).toNgPromise(e.$qNoApply).then(function(t){return e.logger.info("Retrieved "+t.value.length+" relevant contacts"),t.value;});},null,["5xx"]);},t.prototype.hasSurfaceDisplayed=function(e){return this.getEngagementSurfacesDeferred.promise.then(function(t){return _.some(t.displayed,function(t){return t.id===e;});});},t.prototype._getAuthHeaders=function(e,t){var n=this;return void 0===e&&(e=!1),this.authenticationService.getSkypeTokens(e).then(function(e){var r={};return __WRAPPED_set(r,n.constants.headers.accept,'=',n.constants.headers.jsonContent),__WRAPPED_set(r,n.constants.headers.tokens.xSkypeToken,'=',e.skypeToken),n.authenticationService.getAuthHeaders(r,void 0,[t]);});},t.prototype.getAuthConfig=function(){var e;return{needSkypeToken:!0,headers:(e={},__WRAPPED_set(e,this.constants.headers.accept,'=',this.constants.headers.jsonContent),e)};},t.prototype.getEspConfigUrl=function(e){var n=t.API_ENDPOINT,r="?";return n.indexOf(r)>=0&&(r="&"),e&&(n+=r+t.FETCH_ENGAGEMENT_PROFILE_QSP),n;},t.prototype.updateSurfaceAsDisplayedOrEligible=function(e,t){var n=this;if(this.esPortalComms.isUsingEspPortal())return this.$qNoApply.resolve();if(e.trigger===o.Trigger.Programmatic&&e.id!==this.constants.settings.names.defaultFrePromptCards||e.trigger===o.Trigger.SurfaceShown)return this.$qNoApply.resolve();var r={id:e.id,priority:e.priority,isControlGroup:t};return this.updateSurfacesState(e.id,t).then(function(){}).catch(function(t){n.logger.warn("unable to update surface "+e.id+" as displayed. cacheing locally."),n.esCache.addDisplayed(r);});},t.prototype.convert=function(e,t){var n=this;return this.convertUserState(e).then(function(r){return{engagementSurfaces:n.getSurfaceConfigurations(t,e.displayed,e.engagementSurfaces),userState:r,priorityThrottlesInMinutes:e.priorityThrottlesInMinutes};});},t.prototype.convertUserState=function(e){var t=this,n=e.userState,r=i(n.completedActions||[]),s=[];return this.myUserPreferencesStore.waitForPreferenceStoreToInitialize().then(function(){var n=t.myUserPreferencesStore.getUserPreferences(),i=n&&n.firstLoginInformation||{};[{isActive:!!(i.android||i.ios||i.wp),action:o.EngagementSurfaceAction.LoginTeamsMobileApp},{isActive:!!i.electron,action:o.EngagementSurfaceAction.LoginElectron},{isActive:!!i.desktopHwa,action:o.EngagementSurfaceAction.LoginDesktopHwa},{isActive:!!i.surfaceHub,action:o.EngagementSurfaceAction.LoginSurfaceHub}].forEach(function(e){return e.isActive&&r.push({action:__WRAPPED_get(o.EngagementSurfaceAction,e.action)});}),(r=_.uniqBy(r,function(e){return e.action;})).length&&(s=_(r).map(function(e){return _.isString(e.action)?__WRAPPED_get(o.EngagementSurfaceAction,e.action):_.isNumber(e.action)?e.action:void 0;}).without(void 0).value(),t.eventingService.$emit(t.constants.events.engagementSurfaces.onAction,s));var c=t.convertEngagementProfile(e.userEngagementProfile);return t.getEnhancedUserStateParams().then(function(e){var n=a(a({},e),{completedActions:s,engagementProfile:c});return t.applyUserStateDebugOverrides(n);});});},t.prototype.convertEngagementProfile=function(e){if(!e)return null;var t=[];return t=e.actions.map(function(e){return{action:e.action,updatedAt:moment.utc(e.updatedAt),actionCounts:e.actionCounts.split("|").map(function(e){return parseInt(e,10);})};}),new s.EsEngagementProfile(t,e.churnScore);},t.prototype.isEmptyEngagementProfile=function(e){return!e||_.isEmpty(e.actions)&&(_.isEmpty(e.churnScore)||"NA"===e.churnScore);},t.prototype.withTimeout=function(e,t,n){var r=this;return this.settingsService.valueAsBoolean(this.constants.settings.names.disableEngagementSurfacesStartUpDependencyTimeout)?e:(n=n||this.settingsService.valueFor(this.constants.settings.names.engagementSurfacesStartUpDependencyTimeout)||30*this.constants.timeInMiliseconds.second,this.utilityService.getPromiseWithTimeout(e,n,this.$q,t,!0).catch(function(e){if(e===t){var a=r.loggingService.newScenario(r.constants.scenarios.onboarding.engagementSurfaces.dependencyTimeout),i=t+" exceeded "+n+"ms";a.fail({message:i});}return r.$q.reject(e);}));},t.prototype.getEnhancedUserStateParams=function(){var e=this,t=this.settingsService.valueAsBoolean(this.constants.settings.names.enableSfbSpecificFre),n=this.settingsService.valueAsBoolean(this.constants.settings.names.enableDiscoverySettingEs),r=this.settingsService.valueAsBoolean(this.constants.settings.names.optInAudioConfLicense),a=this.myUserPreferencesStore.getFirstWebLogin()||moment(),i=this.authenticationService.getLoggedInUser().profile||{},o=this.userResourcesSettingsStore.waitForSettingAndGetValue(SkypeX.Services.UserResourcesStorageKey.licenseType),s=this.channelService.getTeams(),c=n?this.channelService.getNonDiscoverableTeams():this.$qNoApply.resolve([]),u=t?this.sfbTeamsUpgradeService.getUpgradePolicyV2():this.$qNoApply.resolve(void 0),l=this.identityService.isTenantAdmin(),p=this.identityService.isServiceAdmin(),g=this.settingsService.valueAsBoolean(this.constants.settings.names.enableCallingCanCreateTenantWideTeam),h=l&&g?this.tenantService.canCreateTenantWide():this.$q.resolve({canCreate:!1}),d=this.settingsService.valueAsBoolean(this.constants.settings.names.disableEspWaitForPstnFlag)?this.$q.resolve(this.callingSupportService.isPSTNCallingAllowed()):this.callingSupportService.isPstnCallingAllowedAsync(),f=this.callingSupportService.getPhoneNumberAsync("esRepository"),m=this.desktopUtilityService.isProPlus(),v=this.desktopUtilityService.wasPromptShown(),y=this.identityService.isTrialUserPromise(),S=this.authenticationService.getUserDetails().then(function(e){return e.licenseDetails.isAudioConf;}),A=r?this.audioConfService.isEligible():this.$q.resolve(!1),C=this.esLocationAffiliationService.isUserInAffectedGeo();return this.utilityService.whenAllAllowFailures([this.withTimeout(o,"userLicensePromise"),this.withTimeout(s,"getTeamsPromise"),this.withTimeout(c,"getNonDiscoverableTeamsPromise"),this.withTimeout(u,"sfbUpgradePolicyPromise"),this.withTimeout(h,"canCreatePromise"),this.withTimeout(d,"isPstnCallingAllowedPromise"),this.withTimeout(f,"getPhoneNumberPromise"),this.withTimeout(y,"isTrialUserPromise"),this.withTimeout(S,"hasAudioConfLicensePromise"),this.withTimeout(A,"audioConfEligibilityPromise")]).then(function(t){var n=t[0].result,r=t[1].result,o=t[2].result,s=t[3].result,c=t[4].result&&t[4].result.canCreate,u=t[5].result,g=!!t[6].result,h=t[7].result,d=t[8].result,f=t[9].result,y=r.some(function(e){return e.isTenantWide;}),S=r.some(function(e){return 2==e.teamType;});return{id:i.oid,upn:i.upn,tenantId:i.tid,locale:e.localizationService.getLocale(),teamsCount:(r||[]).length,licenseType:n,firstWebLogin:a,hasChatApp:e.userAppsStore.hasApp(e.constants.appId.chat),hasCallsApp:e.userAppsStore.hasApp(e.constants.appId.calling),hasCalendarApp:e.userAppsStore.hasApp(e.constants.appId.calendar),hasPhoneNumber:g,hasClassTeam:S,isAnonymous:e.authenticationService.isAnonymous(),isGuest:e.identityService.isGuestUserType(),isTrialUser:h,isFreemiumTenant:e.identityService.isFreemiumTenant(),isSfbUpgrade:s&&e.sfbTeamsUpgradeService.isUpgradedUserPolicy(s),isHelpBotConversationEmpty:e.helpBotService.isEmptyConversation,isTenantAdmin:l,isServiceAdmin:p,hasTWTInTenant:y,canCreateTWT:c,isHealthcareUser:e.settingsService.valueAsBoolean(e.constants.settings.names.enableHealthcareFre),earlyDesktopPromotedTimes:(e.storageService.get(e.constants.growth.earlyDesktopPromo.storageKey,!1)||[]).map(function(e){return moment(e);}),earlyMobilePromotedTimes:(e.storageService.get(e.constants.growth.earlyMobilePromo.storageKey,!1)||[]).map(function(e){return moment(e);}),canPromoteDesktop:e.downloadAppService.isDownloadSupported(),canPromoteMobile:e.settingsService.valueAsBoolean(e.constants.settings.names.promoteMobile),nonDiscoverableTeamsCount:(o||[]).length,isInCall:function(){return!!e.callingService.getActiveCall();},hasShortCortanaConsent:e.cortanaConfigurationService.getUserConsent(teamspace.services.ConsentType.Short),isSMBVoiceUser:("SmbBusinessVoice"==n||"SmallMediumBusiness"==n)&&u&&g,isProPlusUser:m,hasSeenProPlusPrompt:v,areTagsEnabled:e.peopleTargetingService.tagsEnabled(),inEventAffectedGeo:C,hasMultiWindowEnabled:e.callingMultiWindowService.getCallingMWEnabledUserPreference(),isChatHybridArchitectureEnabled:e.experienceContainerFeatureService.isChatHybridAppExperienceContainerEnabled(),hasAudioConfLicense:d,isEligibleForAudioConfTrial:f,isMinor:e.ageConsentPolicyService.isMinor(e.ageConsentPolicySettingsStore.getSettingValue(SkypeX.Services.AgeConsentPolicySettingsStorageKey.ageGroup)),isFreemiumTenantMixedMode:e.identityService.isFreemiumTenantMixedModeUser()};});},t.prototype.getEcsSurfaceConfigurations=function(){var e=this,t=[];if(this.enableESPConfigFetching?(this.engagementSurfacesConfig=this.engagementSurfacesConfig||[],t=this._getEcsSurfaceConfigurations(function(t){return __WRAPPED_get(e.engagementSurfacesConfig,t);})):t=this._getEcsSurfaceConfigurations(function(t){return e.settingsService.valueFor(t);}),this.esPortalComms.isUsingEspPortal())return this.esPortalComms.getSurfacesFromPortal().then(function(t){return e.logger.info("retrieved config from ESP Portal, using --\x3e"),e.logger.info(JSON.stringify(t,null,2)),t;}).catch(function(n){return e.logger.error("failed retrieving config from ESP portal"+n.message),t;});var n=this.settingsService.valueFor(this.constants.settings.names.engagementSurfacesSTOverride);if(n){try{n=atob(n);}catch(e){}var r=JSON.parse(n);return this.logger.info("retrieved config from ST Override, using --\x3e"),this.logger.info(JSON.stringify(r,null,2)),this.$q.resolve(r);}return this.$q.resolve(t);},t.prototype.initialEspConfigsloadFromEcs=function(){var e=this,t=this.$q.defer();return this.ecsFoundation.fetchImmediately().then(function(n){n?t.resolve():(e.logger.warn("ESP direct configuration fetching failed"),t.reject());}).catch(function(){e.logger.warn("ESP direct configuration fetching failed"),t.reject();}),t.promise;},t.prototype.loadEcsPayloadOnSettingsUpdate=function(e){var t=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.espConfigSync);if(!e||!e.TeamsESPConfigs){var n="no ESP Configuration found in TeamsESPConfigs namespace";return this.logger.warn(n),t.fail({message:n}),!1;}return this.logger.info("Fetched ESP Surface configurations from TeamsESPConfigs namespace"),this.engagementSurfacesConfig=e.TeamsESPConfigs,t.stop(),!0;},t.prototype._getEcsSurfaceConfigurations=function(e){var t=this,n=[],r=[this.constants.settings.names.engagementSurfaces,this.constants.settings.names.engagementSurfacesFre];r.forEach(function(r){var a=e(r);a?((a=_.isString(a)?JSON.parse(a):a).forEach(function(e,t){e.isSettled=!0,e.order=t;}),n.push.apply(n,a)):t.logger.warn("no value found for engagement surfaces key '"+r+"'");});var a=e(this.constants.settings.names.engagementSurfacesExpManifest)||[];return _.without.apply(_,i([a],r)).forEach(function(r){var a=e(r)||[];a.forEach(function(e,t){e.isSettled=!1,e.order=t;}),t.addOrReplaceSurfaces(n,a);}),n;},t.prototype.addOrReplaceSurfaces=function(e,t){var n=this;(t||[]).forEach(function(t){var r=_.findIndex(e,function(e){return e.id===t.id;});r>-1?(__WRAPPED_set(e,r,'=',t),n.logger.info("overwrote surface "+t.id+" from experiment config")):e.push(t);});},t.prototype.getSurfaceConfigurations=function(e,t,n){var r=this,a=_.keyBy(t,function(e){return e.id;}),i=e.map(function(e){return r.convertSurfaceConfig(e,__WRAPPED_get(a,e.id));}),s=_.keyBy(n,function(e){return e.id;}),c=i.filter(function(e){return!!__WRAPPED_get(s,e.id)||e.trigger===o.Trigger.SurfaceShown||e.trigger===o.Trigger.Programmatic;});if(!n.length&&this.firstRunService.isFRESession()&&(c=i),i.length!==c.length&&this.esPortalComms.isUsingEspPortal()){var u=i.filter(function(e){return!__WRAPPED_get(s,e.id)&&e.trigger!==o.Trigger.SurfaceShown&&e.trigger!==o.Trigger.Programmatic;}).map(function(e){return e.id;});this.logger.warn("non-deployed surface ids detected. ensure MT is deployed prior to using these ids in production: "+u.join()),c=i;}return this.applySurfaceDisplayDebugOverrides(c);},t.prototype.convertSurfaceConfig=function(e,t){var n=a(a({},e),{treatment:e.treatment||"",isControlGroup:e.isControlGroup||!1,isSettled:e.isSettled||!1,trigger:__WRAPPED_get(o.Trigger,e.trigger),surface:__WRAPPED_get(o.EngagementSurface,e.surface),recur:Math.max(-1,e.recur||1),displayed:[],eligibleTimes:[],condition:new p(e.condition),triggerFilter:new p(e.triggerFilter),startTime:void 0,endTime:void 0});return t&&(n.eligibleTimes=_.map(t.controlGroupTimestamps,function(e){return moment(new Date(e));}),n.displayed=e.isControlGroup?n.eligibleTimes:_.map(t.displayedTimestamps,function(e){return moment(new Date(e));})),this.esPortalComms.isUsingEspPortal()&&(n.displayed=[]),e.startTime&&(n.startTime=moment(new Date(e.startTime))),e.endTime&&(n.endTime=moment(new Date(e.endTime))),_.isUndefined(n.trigger)&&this.logger.error("unknown trigger: "+e.trigger),_.isUndefined(n.surface)&&this.logger.error("unknown surface: "+e.surface),_.isNaN(n.recur)&&(this.logger.error("unknown recurrence: "+e.recur),n.recur=1),n;},t.prototype.applyUserStateDebugOverrides=function(e){var t=this;if(!this.enableEspDebugOverride)return e;var n=this.storageService.get(this.constants.growth.engagementSurfaces.debugHook.userStateOverrideStorageKey,!0)||{};return _.forOwn(n,function(n,r){var a=moment(n,moment.ISO_8601,!0);a.isValid()?__WRAPPED_set(e,r,'=',a):__WRAPPED_set(e,r,'=',"true"===n||"false"===n?t.utilityService.convertStringToBoolean(n):n);}),e;},t.prototype.applySurfaceDisplayDebugOverrides=function(e){if(!this.enableEspDebugOverride)return e;var t=this.storageService.get(this.constants.growth.engagementSurfaces.debugHook.displayedOverrideStorageKey,!0)||{};return _.forEach(e,function(e){if(t.hasOwnProperty(e.id))if(__WRAPPED_get(t,e.id)){var n=moment(__WRAPPED_get(t,e.id),moment.ISO_8601,!0);n.isValid()&&(e.displayed=[n]);}else e.displayed=[];}),e;},t.prototype.withRetry=function(e,t,n,r,a){void 0===t&&(t=null),void 0===n&&(n=["5xx","404"]),void 0===r&&(r=3),void 0===a&&(a=1e3);var i=this.$q.defer(),o=function(s){void 0===s&&(s=0),t&&t.resume(),e().then(i.resolve).catch(function(e){var c=(e||{}).statusCode;if(!n.map(function(e){return new RegExp(e.replace(/x/gi,"\\d"));}).some(function(e){return e.test(c);}))return i.reject(e);s<r?(s++,t&&t.pause({reason:"failed. will retry after delay. status="+c+" count="+s}),setTimeout(function(){return o(s);},Math.pow(s,2)*a)):i.reject(e);});};return o(0),i.promise;},t.prototype.shouldFetchEngagementProfile=function(){if(!this.settingsService.valueAsBoolean(this.constants.settings.names.enableEngagementProfileInESP))return!1;var e=this.settingsService.valueFor(this.constants.settings.names.engagementProfileInESPCacheTTLInDays),n=this.storageService.get(t.ENGAGEMENT_PROFILE_CACHE_KEY);if(n&&""!==n.timestamp){var r=moment.utc(new Date()),a=moment.utc(n.timestamp),i=moment.duration(r.diff(a)).asDays()>=e;return i||(this.cachedEngagementProfile=n),i;}return!0;},t.prototype.toNgPromise=function(e){return this.$qNoApply(function(t,n){return e.then(t,n);});},t.prototype.syncCache=function(){var e=this;if(this.esCache.needsSync()){this.esCache.startSync();var n=this.$qNoApply.resolve(),r=this.esCache.cache;if(r.actions.length){var a={items:r.actions.map(function(e){return{action:e};})};n=n.finally(function(){return e.performApiPut(t.API_ENDPOINT+"/actions",{callType:t.CALL_TYPE},a).toNgPromise(e.$qNoApply).then(function(){return e.esCache.clearActions();});});}return r.displayed.forEach(function(r){n=n.finally(function(){return e.performApiPut(t.API_ENDPOINT+"/displayed",{callType:t.CALL_TYPE},r).toNgPromise(e.$qNoApply).then(function(){return e.esCache.clearDisplayed(r.id);});});}),n.finally(function(){return e.esCache.endSync();}),n;}},t.prototype.applyCache=function(e){if(this.esCache.cache.displayed.forEach(function(t){var n=e.displayed.find(function(e){return e.id===t.id;});if(n)t.isControlGroup?n.controlGroupTimestamps.push(t.timestamp):n.displayedTimestamps.push(t.timestamp);else{var r={id:t.id,priority:t.priority,displayedTimestamps:[],controlGroupTimestamps:[]};t.isControlGroup?r.controlGroupTimestamps.push(t.timestamp):r.displayedTimestamps.push(t.timestamp),e.displayed.push(r);}}),e.userState.completedActions=e.userState.completedActions||[],this.esCache.cache.actions.forEach(function(t){e.userState.completedActions.push({action:__WRAPPED_get(o.EngagementSurfaceAction,t)});}),this.settingsService.valueAsBoolean(this.constants.settings.names.enableEngagementProfileInESP))if(this.isEmptyEngagementProfile(e.userEngagementProfile))this.cachedEngagementProfile?e.userEngagementProfile=this.cachedEngagementProfile.profile:this.logger.warn("Engagement profile was neither retrieved nor found in the cache");else{var n={timestamp:moment.utc(new Date()).toString(),profile:e.userEngagementProfile};this.storageService.set(t.ENGAGEMENT_PROFILE_CACHE_KEY,n);}return this.$qNoApply.resolve(e);},Object.defineProperty(t.prototype,"esCache",{get:function(){var e=this,n=function(){return e.storageService.get(t.ES_CACHE_KEY)||{isSyncing:!1,actions:[],displayed:[]};},r=function(n){return e.storageService.set(t.ES_CACHE_KEY,n);},a=function(){return e.storageService.remove(t.ES_CACHE_KEY);};return{needsSync:function(){var e=n();return(e.actions.length||e.displayed.length)&&!e.isSyncing;},startSync:function(){var e=n();e.isSyncing=!0,r(e);},endSync:function(){var e=n();e.isSyncing=!1,!e.actions.length&&!e.displayed.length?a():r(e);},addDisplayed:function(e){var t=n();e.timestamp=new Date().toISOString(),t.displayed.push(e),r(t);},addActions:function(e){var t=n(),a=e.items.map(function(e){return e.action;});t.actions=_.uniq(t.actions.concat(a)),r(t);},clearActions:function(){var e=n();e.actions=[],r(e);},clearDisplayed:function(e){var t=n();t.displayed=t.displayed.filter(function(t){return t.id!==e;}),r(t);},get cache(){return n();}};},enumerable:!0,configurable:!0}),t.CALL_TYPE="engagement_surfaces",t.API_ENDPOINT="/me/engagementSurfaces",t.RELEVANTCONTACTS_ENDPOINT="/users/relevantcontacts",t.ES_CACHE_KEY="esp-local-cache",t.FETCH_ENGAGEMENT_PROFILE_QSP="fetchEngagementProfile=true",t.ENGAGEMENT_PROFILE_CACHE_KEY="esp-engagement-profile-cache",t.NAKED_DTO={displayed:[],engagementSurfaces:[],lastDisplayedByPriority:[],priorityThrottlesInMinutes:[30,60,720,1440,10080],userState:{completedActions:[]}},t;}(SkypeX.Services.GenericRestClient));t.EsRepository=g,angular.module("teamspace.esRepository",["teamspace.loggingService","skypeX.myUserPreferencesStore","teamspace.eventingService","teamspace.channelService","teamspace.tenantService","teamspace.userAppsStore","teamspace.authenticationService","skypeX.userResourcesSettingsStore","teamspace.utilityService","teamspace.identityService","teamspace.sfbTeamsUpgradeService","teamspace.esSurfaceStack","teamspace.esLogger","teamspace.esPortalComms","teamspace.storageService","teamspace.downloadAppService","teamspace.callingService","teamspace.callingSupportService","teamspace.cortanaConfigurationService","teamspace.firstRunService","teamspace.desktopUtilityService","teamspace.esLocationAffiliationService","teamspace.callingMultiWindowService","teamspace.ecsFoundation","teamspace.experienceContainerFeatureService","teamspace.localizationService","teamspace.ageConsentPolicyService","teamspace.audioConfService"]).service("esRepository",g);},2527:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t){void 0===e&&(e=[]),void 0===t&&(t=""),this.actionProfile=e,this.churnScore=t;}return e.prototype.hasPerformedAction=function(e,t,n){var r=_.find(this.actionProfile,{action:e});if(_.isEmpty(r))return!1;var a=moment.utc(new Date()).startOf("day").diff(r.updatedAt.startOf("day"),"days")-1;if(a>=t)return!1;var i=t-a;i=Math.min(r.actionCounts.length,i);for(var o=0,s=0;i;)o+=__WRAPPED_get(r.actionCounts,s),i--,s++;return o>=n;},e;}());t.EsEngagementProfile=r;},2528:function(e,t){e.exports="query espState {\n  espState {\n    ...espState\n  }\n}\n\nfragment espState on EspState {\n  displayed {\n    ...espDisplayedSurface\n  }\n  engagementSurfaces {\n    id\n  }\n  userState {\n    completedActions {\n      action\n    }\n  }\n  priorityThrottlesInMinutes\n}\n\nfragment espDisplayedSurface on EspDisplayedSurface {\n  id\n  controlGroupTimestamps\n  displayedTimestamps\n}\n";},2529:function(e,t){e.exports="mutation recordDisplayedSurface($surfaceId: String!) {\n  recordDisplayedSurface(surfaceId: $surfaceId) {\n    id\n    controlGroupTimestamps\n    displayedTimestamps\n  }\n}\n";},2530:function(e,t){e.exports="mutation recordEligibleSurface($surfaceId: String!) {\n  recordEligibleSurface(surfaceId: $surfaceId) {\n    id\n    controlGroupTimestamps\n    displayedTimestamps\n  }\n}\n";},2531:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=__WRAPPED_get(arguments,n);for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&__WRAPPED_set(e,a,'=',__WRAPPED_get(t,a));}return e;}).apply(this,arguments);};Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(){this.surfaces={};}return e.prototype.setSurfaces=function(e){this.surfaces=_.keyBy(e,function(e){return e.id;});},e.prototype.setCurrentSurface=function(e){this.current&&(this.previous=this.current),this.current=r({},e);},e.prototype.unsetCurrentSurface=function(){this.current=void 0;},e.prototype.setCurrentAction=function(e){_.isNil(this.current)||(this.current.action=e);},e.prototype.onSurfaceClosed=function(){this.previous=this.current,this.current=void 0;},e.prototype.getSurfaceState=function(){var e=_.cloneDeep({prev:this.previous,curr:this.current,all:this.surfaces});return e.prev&&(e.prev.displayed=_.map(e.prev.displayed,function(e){return e.clone();})),e.curr&&(e.curr.displayed=_.map(e.curr.displayed,function(e){return e.clone();})),Object.keys(e.all||{}).forEach(function(t){var n=__WRAPPED_get(e.all,t);n.displayed=_.map(n.displayed,function(e){return e.clone();});}),e;},e;}());t.EsSurfaceStack=a,angular.module("teamspace.esSurfaceStack",[]).service("esSurfaceStack",a);},2532:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a){this.$translate=e,this.esParser=t,this.settingsService=n,this.constants=r,this.locale=a.getLocale().replace("-","_");}return e.$inject=["$translate","esParser","settingsService","constants","localizationService"],e.prototype.instant=function(e,t,n,r){var a=this.settingsService.valueFor(this.constants.settings.names.engagementSurfacesResx)||{};if(!t)return __WRAPPED_get(a,this.locale)&&__WRAPPED_get(__WRAPPED_get(a,this.locale),e)?__WRAPPED_get(__WRAPPED_get(a,this.locale),e):this.$translate.instant(e);var i=this.esParser.evaluateExpressions(t,n);if(__WRAPPED_get(a,this.locale)&&__WRAPPED_get(__WRAPPED_get(a,this.locale),e)){var o=__WRAPPED_get(__WRAPPED_get(a,this.locale),e);return t&&Object.keys(t).forEach(function(e){var t=new RegExp("{{"+e+"}}","g");o=o.replace(t,__WRAPPED_get(i,e));}),o;}var s=i.html;i.html="{{html}}";var c=this.$translate.instant(e,i,r);return s&&(c=c.replace(/{{html}}/g,s)),c;},e;}());t.EsTranslate=r,angular.module("teamspace.esTranslate",["pascalprecht.translate","teamspace.esParser","teamspace.settingsService","teamspace.constants","teamspace.localizationService"]).service("esTranslate",r);},2533:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i,o,s,c,u,l,p,g,h,d,f,m){var v=this;this.$q=e,this.fetchRelevantContactsHandler=t,this.fetchWhatsNewHandler=n,this.fetchAggregateFilesHandler=r,this.fetchJoinTenantUrlHandler=a,this.fetchAudioConfLicenseTimestampHandler=i,this.fetchTflUserEmailVisibilityHandler=o,this.fetchUserPhoneNumberHandler=s,this.fetchPendingJoinRequestsHandler=c,this.fetchOneClickJoinSettingHandler=u,this.fetchTeamRecommendationHandler=l,this.fetchEduNotebookTypeHandler=p,this.fetchSmbWelcomeHandler=g,this.fetchAppsRecommendationHandler=h,this.fetchBiometricEnrollmentStatusHandler=d,this.fetchLaunchingAppHandler=f,this.fetchFreemiumDecommissionDetailsHandler=m,this.dataHandlers={};var y=Array.from(arguments);this.dataHandlers={},y.forEach(function(e){v.isDataHandler(e)&&__WRAPPED_set(v.dataHandlers,e.dataKey,'=',e);});}return e.$inject=["$q","fetchRelevantContactsHandler","fetchWhatsNewHandler","fetchAggregateFilesHandler","fetchJoinTenantUrlHandler","fetchAudioConfLicenseTimestampHandler","fetchTflUserEmailVisibilityHandler","fetchUserPhoneNumberHandler","fetchPendingJoinRequestsHandler","fetchOneClickJoinSettingHandler","fetchTeamRecommendationHandler","fetchEduNotebookTypeHandler","fetchSmbWelcomeHandler","fetchAppsRecommendationHandler","fetchBiometricEnrollmentStatusHandler","fetchLaunchingAppHandler","fetchFreemiumDecommissionDetailsHandler"],e.prototype.isDataHandler=function(e){return e&&e.dataKey&&e.fetchData;},e.prototype.hasRegisteredData=function(e){return!!__WRAPPED_get(this.dataHandlers,e);},e.prototype.fetchData=function(e){return this.hasRegisteredData(e)?__WRAPPED_get(this.dataHandlers,e).fetchData():this.$q.reject(e+" is not a registered data key");},e;}());t.EsFetchDataHandler=r,angular.module("teamspace.esFetchDataHandler",["teamspace.fetchRelevantContactsHandler","teamspace.fetchWhatsNewHandler","teamspace.fetchAggregateFilesHandler","teamspace.fetchJoinTenantUrlHandler","teamspace.fetchAudioConfLicenseTimestampHandler","teamspace.fetchTflUserEmailVisibilityHandler","teamspace.fetchUserPhoneNumberHandler","teamspace.fetchPendingJoinRequestsHandler","teamspace.fetchOneClickJoinSettingHandler","teamspace.fetchTeamRecommendationHandler","teamspace.fetchEduNotebookTypeHandler","teamspace.fetchSmbWelcomeHandler","teamspace.fetchAppsRecommendationHandler","teamspace.fetchBiometricEnrollmentStatusHandler","teamspace.fetchLaunchingAppHandler","teamspace.fetchFreemiumDecommissionDetailsHandler"]).service("esFetchDataHandler",r);},2534:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i){this.$qNoApply=e,this.constants=t,this.authenticationService=n,this.aggregateFilesRepository=r,this.filesProviderFactory=a,this.logger=i.newLogger("FetchAggregateFilesHandler");}return e.$inject=["$qNoApply","constants","authenticationService","aggregateFilesRepository","filesProviderFactory","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.teamFiles;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("fetching aggregate files");var t={};return this.getAggregateFiles().then(function(n){var r=n.filter(function(e){return e.files.length;});__WRAPPED_set(t,e.dataKey,'=',r);}).then(function(){return t;});},e.prototype.getAggregateFiles=function(){var e=this,t=this.authenticationService.getLoggedInUser().profile||{},n={serviceName:this.constants.files.serviceName.aggregate,provider:this.filesProviderFactory.create(teamspace.services.files.FilesProviderType.Aggregate)};return this.aggregateFilesRepository.getItems(n).then(function(n){return e.convertAggregateResponseToTeamFilesData(n,t.upn);}).catch(function(t){return e.logger.error("Couldn't fetch aggregate files with "+t),e.$qNoApply.reject(t);});},e.prototype.convertAggregateResponseToTeamFilesData=function(e,t){var n=[];return e.items.forEach(function(e){var r=[];r=e.files.map(function(n){return{siteUrl:e.siteUrl,objectId:n.objectId,objectUrl:n.objectUrl,title:n.title,isFolder:n.isFolder,createdByUser:n.createdByUser,type:n.type,teamId:e.teamId,teamDisplayName:n.teamDisplayName,createdByCurrentUser:t==n.createdByUser.email};});var a={siteUrl:e.siteUrl,teamId:e.teamId,isSuccess:e.isSuccess,files:r};n.push(a);}),n;},e;}());t.FetchAggregateFilesHandler=r,angular.module("teamspace.fetchAggregateFilesHandler",["teamspace.constants","teamspace.authenticationService","teamspace.services.files.modules.aggregate.aggregateFilesRepository","teamspace.services.files.filesProviderFactory","teamspace.esLogger"]).service("fetchAggregateFilesHandler",r);},2535:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i,o){this.$qNoApply=e,this.constants=t,this.loggingService=n,this.mruServiceV2=r,this.appsSuggestionService=a,this.appsService=i,this.logger=o.newLogger("FetchAppsRecommendationHandler");}return e.$inject=["$qNoApply","constants","loggingService","mruServiceV2","appsSuggestionService","appsService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.appsRecommendation;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching popular apps");var t={};return this.getAppsSuggestionDetails().then(function(n){return __WRAPPED_set(t,e.dataKey,'=',n),t;});},e.prototype.getAllowedSuggestedApps=function(){var e=this,t=this.constants.scenarios.discoverApps,n=t.scenarioName,r=t.marks,a=r.suggestedApps_allResults,i=r.suggestedApps_withoutBlockedApps,o=this.loggingService.newScenario(n);return this.appsService.getUserAppDefinitions("fetch-apps-recommendation-handler").then(function(e){return e.map(function(e){return e.id;});}).then(function(t){return e.appsSuggestionService.getSuggestedApps().then(function(e){return o.mark(a,{suggestedApps:JSON.stringify(e)}),e.filter(function(e){return t.includes(e);});}).then(function(e){return o.mark(i,{appDefsIds:JSON.stringify(t),filteredApps:JSON.stringify(e)}),o.stop(),e;}).catch(function(t){return e.logger.error("Couldn't fetch suggested apps with "+t),o.fail(),e.$qNoApply.reject(t);});}).catch(function(t){return e.logger.error("Couldn't fetch user app definitions apps with "+t),o.fail(),e.$qNoApply.reject(t);});},e.prototype.getAppsSuggestionDetails=function(){var e=this;return this.mruServiceV2.getAppsUsage().then(function(t){return e.getAllowedSuggestedApps().then(function(e){return{popularAppsInTenant:e,numberOfUsedApps:t.apps.length};});}).catch(function(t){return e.logger.error("Couldn't fetch app usage for the user with "+t),e.$qNoApply.reject(t);});},e;}());t.FetchAppsRecommendationHandler=r,angular.module("teamspace.fetchAppsRecommendationHandler",["teamspace.constants","teamspace.mruServiceV2","teamspace.appsSuggestionService","teamspace.appsService","teamspace.esLogger"]).service("fetchAppsRecommendationHandler",r);},2536:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.constants=e,this.audioConfService=t,this.logger=n.newLogger("fetchAudioConfLicenseTimestampHandler");}return e.$inject=["constants","audioConfService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.audioConfLicenseTimestamp;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching audio conf license timestamp");var t={};return this.audioConfService.getAudioConfPromoDetails().then(function(n){return __WRAPPED_set(t,e.dataKey,'=',n),t;});},e;}());t.FetchAudioConfLicenseTimestampHandler=r,angular.module("teamspace.fetchAudioConfLicenseTimestampHandler",["teamspace.constants","teamspace.audioConfService","teamspace.esLogger"]).service("fetchAudioConfLicenseTimestampHandler",r);},2537:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.constants=e,this.oneNoteService=t,this.logger=n.newLogger("FetchEduNotebookTypeHandler");}return e.$inject=["constants","oneNoteService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.eduNotebookType;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching notebook type");var t={};return this.oneNoteService.getOneNoteNotebookType().then(function(n){return __WRAPPED_set(t,e.dataKey,'=',n),t;});},e;}());t.FetchEduNotebookTypeHandler=r,angular.module("teamspace.fetchEduNotebookTypeHandler",["teamspace.constants","teamspace.esLogger","teamspace.oneNoteService"]).service("fetchEduNotebookTypeHandler",r);},2538:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i,o){this.$qNoApply=e,this.$translate=t,this.resources=n,this.constants=r,this.identityService=a,this.settingsService=i,this.logger=o.newLogger("FetchFreemiumDeprecationDetailsHandler");}return e.$inject=["$qNoApply","$translate","resources","constants","identityService","settingsService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.freemiumDecommissionDetails;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e;this.logger.info("defining freemium deprecation banner strings");var t=this.settingsService.valueAsObject(this.constants.settings.names.freemiumDecommissionConfig),n=this.getBannerInfo(),r=n[0],a=n[1],i=moment(t.decommissionDate).format("MMM Do, YYYY"),o={bannerText:this.$translate.instant(r,{deprecationDate:i}),buttonText:this.$translate.instant(a)},s=(e={},__WRAPPED_set(e,this.dataKey,'=',o),e);return this.$qNoApply.resolve(s);},e.prototype.getBannerInfo=function(){if(this.identityService.isTenantAdmin())return[this.resources.strings.es_freemium_decommission_banner_text_admin,this.resources.strings.es_freemium_decommission_button_admin];var e=this.identityService.isFreemiumTenantMixedModeUser();return[this.resources.strings.es_freemium_decommission_banner_text_user,e?this.resources.strings.es_freemium_decommission_button_user_mixed_mode:this.resources.strings.es_freemium_decommission_button_user];},e;}());t.FetchFreemiumDecommissionDetailsHandler=r,angular.module("teamspace.fetchFreemiumDecommissionDetailsHandler",["teamspace.locales","teamspace.constants","teamspace.qNoApply","teamspace.esLogger","teamspace.identityService","teamspace.settingsService"]).service("fetchFreemiumDecommissionDetailsHandler",r);},2539:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a,i){this.constants=e,this.manageTenantService=t,this.identityService=n,this.esTranslate=r,this.resources=a,this.logger=i.newLogger("fetchJoinTenantUrlHandler");}return e.$inject=["constants","manageTenantService","identityService","esTranslate","resources","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.joinTenantUrl;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching join tenant url");var t={};return this.manageTenantService.getJoinTenantUrl().then(function(t){return t&&t.joinUrl||!e.identityService.isTenantAdmin()?t:e.manageTenantService.generateJoinTenantUrl();}).then(function(n){return __WRAPPED_set(t,e.dataKey,'=',{url:n&&n.joinUrl,isOneClickJoinEnabled:n&&n.autoApproveJoinRequestsEnabled,tooltipText:n&&n.autoApproveJoinRequestsEnabled?e.esTranslate.instant(e.resources.strings.freemium_invite_copy_link_tooltip_one_click_join_enabled):e.esTranslate.instant(e.resources.strings.freemium_invite_copy_link_tooltip_one_click_join_disabled)});}).then(function(){return t;});},e;}());t.FetchJoinTenantUrlHandler=r,angular.module("teamspace.fetchJoinTenantUrlHandler",["teamspace.constants","teamspace.esLogger"]).service("fetchJoinTenantUrlHandler",r);},2540:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r,a){this.$qNoApply=e,this.constants=t,this.$location=n,this.appsService=r,this.logger=a.newLogger("FetchLaunchingAppHandler");}return e.$inject=["$qNoApply","constants","$location","appsService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.launchingApp;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching launching apps");var t={};return this.getLaunchingAppDetails().then(function(n){return __WRAPPED_set(t,e.dataKey,'=',n),t;});},e.prototype.getLaunchingAppDetails=function(){var e=this,t=this.$location.url();if(this.logger.info("Fetching launching app details with url "+t),t.split("/")[1]===this.constants.navigation.context.apps){var n=t.split("/")[2];return this.logger.info("Fetching launching app details with "+n),this.appsService.getUserAppDefinition(n,"FetchLaunchingAppHandler").then(function(t){return e.logger.info("Fetching app definition"),{appName:t.name,appId:t.id};}).catch(function(t){return e.logger.error("Couldn't fetch launching app for the user with "+t),e.$qNoApply.reject(t);});}return this.$qNoApply.reject();},e;}());t.FetchLaunchingAppHandler=r,angular.module("teamspace.fetchLaunchingAppHandler",["teamspace.constants","teamspace.appsService","teamspace.esLogger"]).service("fetchLaunchingAppHandler",r);},2541:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.constants=e,this.manageTenantService=t,this.logger=n.newLogger("fetchOneClickJoinSettingHandler");}return e.$inject=["constants","manageTenantService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.oneClickJoinSetting;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching one click join setting");var t={};return this.manageTenantService.getJoinTenantUrl().then(function(n){return __WRAPPED_set(t,e.dataKey,'=',{url:n&&n.joinUrl,isOneClickJoinEnabled:n&&n.autoApproveJoinRequestsEnabled}),t;});},e;}());t.FetchOneClickJoinSettingHandler=r,angular.module("teamspace.fetchOneClickJoinSettingHandler",["teamspace.constants","teamspace.esLogger"]).service("fetchOneClickJoinSettingHandler",r);},2542:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.constants=e,this.tenantMembershipService=t,this.logger=n.newLogger("fetchPendingJoinRequestsHandler");}return e.$inject=["constants","tenantMembershipService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.pendingJoinRequests;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching pending join requests");var t={};return this.tenantMembershipService.getTenantJoinRequests().then(function(n){return __WRAPPED_set(t,e.dataKey,'=',{joinRequests:n});}).then(function(){return t;});},e;}());t.FetchPendingJoinRequestsHandler=r,angular.module("teamspace.fetchPendingJoinRequestsHandler",["teamspace.constants","teamspace.tenantMembershipService","teamspace.esLogger"]).service("fetchPendingJoinRequestsHandler",r);},2543:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.constants=e,this.esRepository=t,this.logger=n.newLogger("FetchRelevantContactsHandler");}return e.$inject=["constants","esRepository","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.relevantContacts;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("fetching data");var t={};return this.esRepository.getRelevantContacts().then(function(n){return __WRAPPED_set(t,e.dataKey,'=',n);}).then(function(){return t;});},e;}());t.FetchRelevantContactsHandler=r,angular.module("teamspace.fetchRelevantContactsHandler",["teamspace.constants","teamspace.esLogger"]).service("fetchRelevantContactsHandler",r);},2544:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.constants=e,this.authenticationService=t,this.logger=n.newLogger("FetchSmbWelcomeHandler");}return e.$inject=["constants","authenticationService","esLogger"],Object.defineProperty(e.prototype,"activityParamsDataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.activityParams;},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.smbWelcome;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching user's name for welcome text");var t={};return this.authenticationService.getUserInformation().then(function(n){return __WRAPPED_set(t,e.activityParamsDataKey,'=',{templateParameters:[{name:"userName",value:n.profile.given_name}]}),t;});},e;}());t.FetchSmbWelcomeHandler=r,angular.module("teamspace.fetchSmbWelcomeHandler",["teamspace.constants","teamspace.esLogger","teamspace.authenticationService"]).service("fetchSmbWelcomeHandler",r);},2545:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){function a(e){return e instanceof n?e:new n(function(t){t(e);});}return new(n||(n=Promise))(function(n,i){function o(e){try{c(r.next(e));}catch(e){i(e);}}function s(e){try{c(r.throw(e));}catch(e){i(e);}}function c(e){e.done?n(e.value):a(e.value).then(o,s);}c((r=r.apply(e,t||[])).next());});},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t]);};}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue;}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break;}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break;}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break;}o[2]&&c.ops.pop(),c.trys.pop();continue;}n=t.call(e,c);}catch(e){n=[6,e],i=0;}finally{a=o=0;}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0};}var a,i,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1];},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&__WRAPPED_set(s,Symbol.iterator,'=',function(){return this;}),s;};Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e,t,n,r,a){this.$qNoApply=e,this.constants=t,this.discoverService=n,this.peopleService=r,this.logger=a.newLogger("FetchTeamRecommendationHandler");}return e.$inject=["$qNoApply","constants","discoverService","peopleService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.teamRecommendation;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching suggested teams");var t={};return this.getSuggestedTeam().then(function(n){__WRAPPED_set(t,e.dataKey,'=',n);}).then(function(){return t;});},e.prototype.getSuggestedTeam=function(){var e=this;return this.discoverService.getSuggestedTeams().then(function(t){return r(e,void 0,void 0,function(){var e,n,r,i,o,s;return a(this,function(a){switch(a.label){case 0:return!t||t.length<1||t[0].relevantMembers.length<1?(this.logger.warn("No valid suggested teams retrieved."),[2,this.$qNoApply.resolve({})]):(e=t[0],[4,this.peopleService.getAllPeopleProfile(e.relevantMembers,"fetch-suggested-team",!0,!0)]);case 1:return n=a.sent(),r=_.map(n,function(e){return e.displayName.split(" ")[0];}).filter(function(e){return!_.isNil(e);}),i=2,o=r.slice(0,i),s=o.join(", "),i<r.length&&(s+=", +"+(r.length-i)),[2,{teamName:e.teamName,teamId:e.teamId,joinState:e.joinState,usersInTeam:s,firstUser:r[0],secondUser:r[1],restOfUsersCount:r.length-i,totalUsersCount:r.length}];}});});}).catch(function(t){return e.logger.error("Couldn't fetch suggested team with "+t),e.$qNoApply.reject(t);});},e;}());t.FetchTeamRecommendationHandler=i,angular.module("teamspace.fetchTeamRecommendationHandler",["teamspace.constants","teamspace.esLogger","teamspace.discoverService","teamspace.peopleService"]).service("fetchTeamRecommendationHandler",i);},2546:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=teamspace.services.AliasVisibility,a=(function(){function e(e,t,n){this.constants=e,this.peopleService=t,this.logger=n.newLogger("FetchTflUserEmailVisibilityHandler");}return e.$inject=["constants","peopleService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.emailVisibility;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching TFL user email visibility");var t={};return this.peopleService.getMeMSAProfile("fetch-tfl-user-email-visibility-handler",!1,!0).then(function(n){var a=null===n||void 0===n?void 0:n.emailsInfo,i={noVisibleEmail:a&&a.length&&a.every(function(e){return e.visibility==r.Private;})};return(null===n||void 0===n?void 0:n.email)&&(i.primaryEmail=n.email),__WRAPPED_set(t,e.dataKey,'=',i),t;});},e;}());t.FetchTflUserEmailVisibilityHandler=a,angular.module("teamspace.fetchTflUserEmailVisibilityHandler",["teamspace.constants","teamspace.esLogger"]).service("fetchTflUserEmailVisibilityHandler",a);},2547:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.constants=e,this.callingSupportService=t,this.logger=n.newLogger("FetchUserPhoneNumberHandler");}return e.$inject=["constants","callingSupportService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.userPhoneNumber;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("fetching user phone number from CallingSupportService");var t={};return this.callingSupportService.getPhoneNumberAsync("fetch-user-phone-number-handler").then(function(n){return __WRAPPED_set(t,e.dataKey,'=',n);}).then(function(){return t;});},e;}());t.FetchUserPhoneNumberHandler=r,angular.module("teamspace.fetchUserPhoneNumberHandler",["teamspace.constants","teamspace.esLogger","teamspace.callingSupportService"]).service("fetchUserPhoneNumberHandler",r);},2548:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2549),a=((function(){}()),(function(){}()),(function(){}()),(function(){}()),(function(){function e(e,t,n,r,a,i,o,s,c,u,l,p){this.$rootScope=e,this.$qNoApply=t,this.$timeout=n,this.$compile=r,this.constants=a,this.htmlSanitizer=i,this.tenantSettingsStore=o,this.loggingService=s,this.prefix="/api/teamsgrowth/",this.view="/json/whatsnew/",this.suffix="whats-new",this.logger=p.newLogger("fetchWhatsNewHandler"),this.locale=l.getLocale();var g=u.valueFor(a.settings.names.cxcsDomain);this.whatsNewUrl=g+this.getWhatsNewUrl();var h=new teamspace.services.DataManagerOptions(a.urls.whatsNewDataManager.type,function(e){return e.content.title;});h.useTeamspaceTokens=!1,this.whatsNewDataManager=c.registerManager(h);}return e.$inject=["$rootScope","$qNoApply","$timeout","$compile","constants","htmlSanitizer","tenantSettingsStore","loggingService","dataManagerService","settingsService","localizationService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.whatsNew;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching whats new data");var t={};return this.getWhatsNew().then(function(n){return __WRAPPED_set(t,e.dataKey,'=',n);}).then(function(){return t;});},e.prototype.getWhatsNewUrl=function(){var e=this.getTenantSkuAndUserType();switch(e.tenantSKU){case"edu":return this.prefix+this.locale+this.view+"edu/"+e.userType+"/"+this.suffix;case"enterprise":case"free":return this.prefix+this.locale+this.view+e.tenantSKU+"/"+this.suffix;default:return this.prefix+this.locale+this.view+this.suffix;}},e.prototype.getWhatsNew=function(){var e=this,t=this.$qNoApply.defer(),n=this.loggingService.newScenario(this.constants.scenarios.extensibility.whatsNewDataManager.getContentNetwork),r={dataSource:"CXCS"},a=new teamspace.services.DataManagerRequestOptions();a.skipApply=!0,a.scenario=n;var i={method:"GET",url:this.whatsNewUrl,skipCommonHeaders:!0};return this.whatsNewDataManager.invoke(i,a).then(function(a){if(a)e.logger.info("Fetched whats new data"),n.stop(r),e.parseCxcsResponse(a).then(function(e){t.resolve(e);});else{var i="Empty response for whats new call.";e.logger.error(i),r.cxcsError=i,n.fail(r),t.reject(i);}}).catch(function(a){var i="Error: "+JSON.stringify(e.sanitizeError(a));e.logger.error("Failed to fetch what's new data. "+i),r.cxcsError=i,r.cxcsStatus=a&&a.status,n.fail(r),t.reject(a);}),t.promise;},e.prototype.parseCxcsResponse=function(e){var t=e.content,n=e.metadata;if(n&&n.updateDate&&t&&t.title&&t.features&&t.features.length>0&&!t.features.includes(void 0)){var r=moment(n.updateDate),a={title:t.title,features:t.features};return this.compileCoachmarkHtml(a).then(function(e){return{html:e,updateDate:r};});}this.$qNoApply.reject("Invalid 'what's new' content");},e.prototype.compileCoachmarkHtml=function(e){var t=this,n=this.$rootScope.$new(!0);n.data=e;var a=this.$compile(r)(n);return this.$timeout(function(){return n.$destroy(),t.htmlSanitizer.sanitizeHtml(a.html());});},e.prototype.sanitizeError=function(e){return e=e||{},{status:e.statusCode||e.status,errorCode:e.errorCode,code:e.code,errorSubCode:e.errorSubCode};},e.prototype.getTenantSkuAndUserType=function(){for(var e={tenantSKU:this.constants.skuType.unknown,userType:""},t=this.tenantSettingsStore.getSettings(),n=t&&t.licenseCategorySettingsMap&&Object.keys(t.licenseCategorySettingsMap)||[],r=0;r<n.length;r++){var a=__WRAPPED_get(n,r).toLowerCase();if(a===this.constants.tenantCategoryType.EducationFaculty){e.tenantSKU=this.constants.skuType.edu,e.userType="teacher";break;}if(a===this.constants.tenantCategoryType.EducationStudent){e.tenantSKU=this.constants.skuType.edu,e.userType="student";break;}if(a===this.constants.tenantCategoryType.BusinessEnterprise){e.tenantSKU=this.constants.skuType.enterprise;break;}if(a===this.constants.tenantCategoryType.Free){e.tenantSKU=this.constants.skuType.free;break;}}return e;},e;}()));t.FetchWhatsNewHandler=a,angular.module("teamspace.fetchWhatsNewHandler",["teamspace.constants","teamspace.esLogger","teamspace.htmlSanitizer","teamspace.settingsService","teamspace.loggingService","teamspace.dataManagerService","teamspace.localizationService"]).service("fetchWhatsNewHandler",a);},2549:function(e,t){e.exports='<div class="whats-new-promotion-coachmark-content">\n  <div class="whats-new-promotion-coachmark-title">\n    <span>{{data.title}}</span>\n  </div>\n  <div class="whats-new-promotion-coachmark-features">\n    <ul ng-if="data.features.length > 1">\n      <li ng-repeat="feature in data.features">\n        <span>{{feature}}</span>\n      </li>\n    </ul>\n    <span ng-if="data.features.length == 1">\n      {{data.features[0]}}\n    </span>\n  </div>\n</div>';},2550:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n,r){this.$qNoApply=e,this.constants=t,this.biometricEnrollmentService=n,this.logger=r.newLogger("FetchBiometricEnrollmentStatusHandler");}return e.$inject=["$qNoApply","constants","biometricEnrollmentService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.biometricEnrollmentStatus;},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){this.logger.info("Fetching biometric enrollment status");var e={},t=this.getBiometricEnrollmentStatus();return t?(__WRAPPED_set(e,this.dataKey,'=',t),this.$qNoApply.resolve(e)):this.$qNoApply.reject();},e.prototype.getBiometricEnrollmentStatus=function(){try{return{isEnabled:this.biometricEnrollmentService.isCurrentConfigurationSupportedForBiometricEnrollment,isUserAlreadyEnrolled:this.biometricEnrollmentService.isUserVoiceEnrolled};}catch(e){return void this.logger.error("Couldn't fetch biometric enrollment status with "+e);}},e;}());t.FetchBiometricEnrollmentStatusHandler=r,angular.module("teamspace.fetchBiometricEnrollmentStatusHandler",["teamspace.constants","teamspace.biometricEnrollmentService","teamspace.esLogger"]).service("fetchBiometricEnrollmentStatusHandler",r);}},[2470]);